From 0d6f9c12a85427c0d2a925d26b6553068c1bf9be Mon Sep 17 00:00:00 2001
From: Romain Rigaux <romain@cloudera.com>
Date: Fri, 6 Mar 2015 18:50:47 -0800
Subject: [PATCH 1006/1173] [oozie] Support deploying the workflow of a
 subworkflow

---
 desktop/libs/liboozie/src/liboozie/submission2.py |   12 +++++++++---
 1 file changed, 9 insertions(+), 3 deletions(-)

diff --git a/desktop/libs/liboozie/src/liboozie/submission2.py b/desktop/libs/liboozie/src/liboozie/submission2.py
index 0fe8e7c..3bf0462 100644
--- a/desktop/libs/liboozie/src/liboozie/submission2.py
+++ b/desktop/libs/liboozie/src/liboozie/submission2.py
@@ -27,11 +27,16 @@ from desktop.lib.i18n import smart_str
 from hadoop import cluster
 from hadoop.fs.hadoopfs import Hdfs
 
+from desktop.models import Document2
+
+from jobsub.parameterization import find_variables
+
 from liboozie.oozie_api import get_oozie
 from liboozie.conf import REMOTE_DEPLOYMENT_DIR
-from jobsub.parameterization import find_variables
 from liboozie.credentials import Credentials
 
+
+
 LOG = logging.getLogger(__name__)
 
 
@@ -148,11 +153,12 @@ class Submission(object):
     oozie_xml = self.job.to_xml(self.properties)
     self._do_as(self.user.username , self._copy_files, deployment_dir, oozie_xml, self.properties)
 
-    if hasattr(self.job, 'actions'):
-      for action in self.job.actions:
+    if hasattr(self.job, 'nodes'):
+      for action in self.job.nodes:
         # Make sure XML is there
         # Don't support shared sub-worfklow, ore more than one level sub-workflow
         if action.data['type'] == 'subworkflow':
+          from oozie.models2 import Workflow
           workflow = Workflow(document=Document2.objects.get(uuid=action.data['properties']['workflow']))
           sub_deploy = Submission(self.user, workflow, self.fs, self.jt, self.properties)
           sub_deploy.deploy()
-- 
1.7.9.5

