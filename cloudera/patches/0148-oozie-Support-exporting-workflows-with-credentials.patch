From b10472439e0e13ce9275c6a359c68ccf60bd5b75 Mon Sep 17 00:00:00 2001
From: Romain Rigaux <romain@cloudera.com>
Date: Fri, 12 Dec 2014 10:09:28 -0800
Subject: [PATCH 0148/1173] [oozie] Support exporting workflows with
 credentials

---
 apps/oozie/src/oozie/views/editor.py |    9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/apps/oozie/src/oozie/views/editor.py b/apps/oozie/src/oozie/views/editor.py
index 3727bdc..86d4c0e 100644
--- a/apps/oozie/src/oozie/views/editor.py
+++ b/apps/oozie/src/oozie/views/editor.py
@@ -237,7 +237,14 @@ def import_coordinator(request):
 
 @check_job_access_permission()
 def export_workflow(request, workflow):
-  zip_file = workflow.compress(mapping=dict([(param['name'], param['value']) for param in workflow.find_all_parameters()]))
+  mapping = dict([(param['name'], param['value']) for param in workflow.find_all_parameters()])
+
+  api = get_oozie(request.user)
+  credentials = Credentials()
+  credentials.fetch(api)
+  mapping['credentials'] = credentials.get_properties()
+
+  zip_file = workflow.compress(mapping=mapping)
 
   response = HttpResponse(mimetype="application/zip")
   response["Last-Modified"] = http_date(time.time())
-- 
1.7.9.5

