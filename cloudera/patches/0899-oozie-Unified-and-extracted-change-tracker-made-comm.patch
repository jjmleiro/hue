From dc845c84a347eb9c5262a6cd27fd396bfa7adef2 Mon Sep 17 00:00:00 2001
From: Enrico Berti <hello@enricoberti.com>
Date: Tue, 24 Feb 2015 14:50:13 +0100
Subject: [PATCH 0899/1173] [oozie] Unified and extracted change tracker, made
 common submit modal code

---
 .../src/oozie/templates/editor2/bundle_editor.mako |   11 +-
 .../templates/editor2/coordinator_editor.mako      |   10 +-
 .../templates/editor2/list_editor_bundles.mako     |    8 +-
 .../editor2/list_editor_coordinators.mako          |    9 +-
 .../templates/editor2/list_editor_workflows.mako   |    9 +-
 .../oozie/templates/editor2/submit_job_popup.mako  |   12 +-
 .../oozie/templates/editor2/workflow_editor.mako   |   44 ++---
 apps/oozie/static/css/common-editor.css            |    4 +-
 apps/oozie/static/css/coordinator-editor.css       |    4 -
 apps/oozie/static/js/bundle-editor.ko.js           |   79 ++++----
 apps/oozie/static/js/coordinator-editor.ko.js      |  189 +++++++++-----------
 apps/oozie/static/js/editor2-utils.js              |   27 +++
 apps/oozie/static/js/workflow-editor.ko.js         |  157 +++++++---------
 desktop/core/static/js/ko.common-dashboard.js      |   36 +++-
 14 files changed, 275 insertions(+), 324 deletions(-)
 create mode 100644 apps/oozie/static/js/editor2-utils.js

diff --git a/apps/oozie/src/oozie/templates/editor2/bundle_editor.mako b/apps/oozie/src/oozie/templates/editor2/bundle_editor.mako
index 07600b3..38cb81f 100644
--- a/apps/oozie/src/oozie/templates/editor2/bundle_editor.mako
+++ b/apps/oozie/src/oozie/templates/editor2/bundle_editor.mako
@@ -193,7 +193,7 @@ ${ commonheader(_("Bundle Editor"), "Oozie", user) | n,unicode }
 </div>
 
 
-<div id="submit-modal" class="modal hide"></div>
+<div class="submit-modal modal hide"></div>
 
 
 </div>
@@ -218,7 +218,7 @@ ${ commonshare() | n,unicode }
 ${ dashboard.import_bindings() }
 
 <script src="/oozie/static/js/bundle-editor.ko.js" type="text/javascript" charset="utf-8"></script>
-
+<script src="/oozie/static/js/editor2-utils.js" type="text/javascript" charset="utf-8"></script>
 
 <script type="text/javascript">
   var viewModel = new BundleEditorViewModel(${ bundle_json | n,unicode }, ${ coordinators_json | n,unicode }, ${ can_edit_json | n,unicode });
@@ -248,13 +248,6 @@ ${ dashboard.import_bindings() }
     $("#chooseCoordinatorDemiModal").modal("hide");
   }
 
-  $(document).on("showSubmitPopup", function(event, data){
-    if (! viewModel.bundle.isDirty()){
-      $('#submit-modal').html(data);
-      $('#submit-modal').modal('show');
-    }
-  });
-
   $(document).ready(function() {
     $("#chooseCoordinatorDemiModal").modal({
       show: false
diff --git a/apps/oozie/src/oozie/templates/editor2/coordinator_editor.mako b/apps/oozie/src/oozie/templates/editor2/coordinator_editor.mako
index 9fceaa9..8c1debe 100644
--- a/apps/oozie/src/oozie/templates/editor2/coordinator_editor.mako
+++ b/apps/oozie/src/oozie/templates/editor2/coordinator_editor.mako
@@ -465,7 +465,7 @@ ${ commonheader(_("Coordinator Editor"), "Oozie", user) | n,unicode }
 </div>
 
 
-<div id="submit-coord-modal" class="modal hide"></div>
+<div class="submit-modal modal hide"></div>
 
 <div id="chooseFile" class="modal hide fade">
   <div class="modal-header">
@@ -510,6 +510,7 @@ ${ commonshare() | n,unicode }
 ${ dashboard.import_bindings() }
 
 <script src="/oozie/static/js/coordinator-editor.ko.js" type="text/javascript" charset="utf-8"></script>
+<script src="/oozie/static/js/editor2-utils.js" type="text/javascript" charset="utf-8"></script>
 
 
 <script type="text/javascript">
@@ -571,13 +572,6 @@ ${ dashboard.import_bindings() }
     $("#chooseWorkflowDemiModal").modal("hide");
   }
 
-  $(document).on("showSubmitPopup", function(event, data){
-    if (! viewModel.coordinator.isDirty()){
-      $('#submit-coord-modal').html(data);
-      $('#submit-coord-modal').modal('show');
-    }
-  });
-
   var firstToggled = true;
   $(document).on("editingToggled", function(){
     if (firstToggled){
diff --git a/apps/oozie/src/oozie/templates/editor2/list_editor_bundles.mako b/apps/oozie/src/oozie/templates/editor2/list_editor_bundles.mako
index f4590b6..dd39005 100644
--- a/apps/oozie/src/oozie/templates/editor2/list_editor_bundles.mako
+++ b/apps/oozie/src/oozie/templates/editor2/list_editor_bundles.mako
@@ -108,7 +108,7 @@ ${ layout.menubar(section='bundles', is_editor=True) }
   <!-- <![endif]-->
 </div>
 
-<div id="submit-wf-modal" class="modal hide"></div>
+<div class="submit-modal modal hide"></div>
 
 <div id="deleteWf" class="modal hide fade">
   <form id="deleteWfForm" method="POST" data-bind="submit: delete2">
@@ -135,6 +135,7 @@ ${ commonshare() | n,unicode }
 <script src="/static/ext/js/knockout-min.js" type="text/javascript" charset="utf-8"></script>
 <script src="/static/ext/js/knockout.mapping-2.3.2.js" type="text/javascript" charset="utf-8"></script>
 <script src="/static/js/share.vm.js"></script>
+<script src="/oozie/static/js/editor2-utils.js" type="text/javascript" charset="utf-8"></script>
 
 
 <script type="text/javascript" charset="utf-8">
@@ -220,11 +221,6 @@ ${ commonshare() | n,unicode }
     shareViewModel = initSharing("#documentShareModal");
     shareViewModel.setDocId(-1);
 
-    $(document).on("showSubmitPopup", function(event, data){
-      $('#submit-wf-modal').html(data);
-      $('#submit-wf-modal').modal('show');
-    });
-
     var oTable = $("#workflowTable").dataTable({
       "sPaginationType":"bootstrap",
       'iDisplayLength':50,
diff --git a/apps/oozie/src/oozie/templates/editor2/list_editor_coordinators.mako b/apps/oozie/src/oozie/templates/editor2/list_editor_coordinators.mako
index 148e8df..9820fa0 100644
--- a/apps/oozie/src/oozie/templates/editor2/list_editor_coordinators.mako
+++ b/apps/oozie/src/oozie/templates/editor2/list_editor_coordinators.mako
@@ -108,7 +108,7 @@ ${ layout.menubar(section='coordinators', is_editor=True) }
   <!-- <![endif]-->
 </div>
 
-<div id="submit-wf-modal" class="modal hide"></div>
+<div class="submit-modal modal hide"></div>
 
 <div id="deleteWf" class="modal hide fade">
   <form id="deleteWfForm" method="POST" data-bind="submit: delete2">
@@ -135,7 +135,7 @@ ${ commonshare() | n,unicode }
 <script src="/static/ext/js/knockout-min.js" type="text/javascript" charset="utf-8"></script>
 <script src="/static/ext/js/knockout.mapping-2.3.2.js" type="text/javascript" charset="utf-8"></script>
 <script src="/static/js/share.vm.js"></script>
-
+<script src="/oozie/static/js/editor2-utils.js" type="text/javascript" charset="utf-8"></script>
 
 <script type="text/javascript" charset="utf-8">
   var Editor = function () {
@@ -219,11 +219,6 @@ ${ commonshare() | n,unicode }
     shareViewModel = initSharing("#documentShareModal");
     shareViewModel.setDocId(-1);
 
-    $(document).on("showSubmitPopup", function(event, data){
-      $('#submit-wf-modal').html(data);
-      $('#submit-wf-modal').modal('show');
-    });
-
     var oTable = $("#workflowTable").dataTable({
       "sPaginationType":"bootstrap",
       'iDisplayLength':50,
diff --git a/apps/oozie/src/oozie/templates/editor2/list_editor_workflows.mako b/apps/oozie/src/oozie/templates/editor2/list_editor_workflows.mako
index 69ef88d..0d4e3fe 100644
--- a/apps/oozie/src/oozie/templates/editor2/list_editor_workflows.mako
+++ b/apps/oozie/src/oozie/templates/editor2/list_editor_workflows.mako
@@ -109,7 +109,7 @@ ${ layout.menubar(section='workflows', is_editor=True) }
   <!-- <![endif]-->
 </div>
 
-<div id="submit-wf-modal" class="modal hide"></div>
+<div class="submit-modal modal hide"></div>
 
 <div id="deleteWf" class="modal hide fade">
   <form id="deleteWfForm" method="POST" data-bind="submit: delete2">
@@ -136,7 +136,7 @@ ${ commonshare() | n,unicode }
 <script src="/static/ext/js/knockout-min.js" type="text/javascript" charset="utf-8"></script>
 <script src="/static/ext/js/knockout.mapping-2.3.2.js" type="text/javascript" charset="utf-8"></script>
 <script src="/static/js/share.vm.js"></script>
-
+<script src="/oozie/static/js/editor2-utils.js" type="text/javascript" charset="utf-8"></script>
 
 <script type="text/javascript" charset="utf-8">
   var Editor = function () {
@@ -221,11 +221,6 @@ ${ commonshare() | n,unicode }
     shareViewModel = initSharing("#documentShareModal");
     shareViewModel.setDocId(-1);
 
-    $(document).on("showSubmitPopup", function(event, data){
-      $('#submit-wf-modal').html(data);
-      $('#submit-wf-modal').modal('show');
-    });
-
     var oTable = $("#workflowTable").dataTable({
       "sPaginationType":"bootstrap",
       'iDisplayLength':50,
diff --git a/apps/oozie/src/oozie/templates/editor2/submit_job_popup.mako b/apps/oozie/src/oozie/templates/editor2/submit_job_popup.mako
index 63fe2da..a7fc2c3 100644
--- a/apps/oozie/src/oozie/templates/editor2/submit_job_popup.mako
+++ b/apps/oozie/src/oozie/templates/editor2/submit_job_popup.mako
@@ -29,7 +29,7 @@
     <h3>${ _('Submit %(job)s?') % {'job': name} }</h3>
   </div>
   <div class="modal-body">
-    
+
       <div id="param-container">
 
        ${ params_form.management_form | n,unicode }
@@ -43,7 +43,7 @@
             % if form['name'].form.initial.get('name') == 'oozie.use.system.libpath':
                 style="display: none"
             % endif
-          ">
+          >
             <label class="control-label">${ form['name'].form.initial.get('name') }</label>
             <div class="controls">
               ${ utils.render_field(form['value'], show_label=False, extra_attrs={'class': 'filechooser-input input-xlarge'}) }
@@ -68,7 +68,7 @@
 
          % endfor
       </div>
-
+      <div class="clearfix"></div>
   </div>
   <div class="modal-footer">
     <a href="#" class="btn" data-dismiss="modal">${ _('Cancel') }</a>
@@ -99,7 +99,7 @@
     z-index: 4999;
   }
   #param-container input[type="text"].filechooser-input.input-xlarge {
-    width: 450px;
+    width: 430px;
   }
   #param-container .control-group {
     float: left;
@@ -107,7 +107,6 @@
   #param-container .btn-group {
     margin-left: 10px;
   }
-}
 </style>
 
 <script src="/static/ext/js/moment-with-locales.min.js" type="text/javascript" charset="utf-8"></script>
@@ -133,6 +132,5 @@
       _el.val(_el.val() + "T00:00Z");
     });
    _el.datepicker('show');
-  }); 
+  });
 </script>
-
diff --git a/apps/oozie/src/oozie/templates/editor2/workflow_editor.mako b/apps/oozie/src/oozie/templates/editor2/workflow_editor.mako
index 841fe4d..3bf1ef8 100644
--- a/apps/oozie/src/oozie/templates/editor2/workflow_editor.mako
+++ b/apps/oozie/src/oozie/templates/editor2/workflow_editor.mako
@@ -153,7 +153,7 @@ ${ commonheader(_("Workflow Editor"), "Oozie", user, "40px") | n,unicode }
     </a>
 
     &nbsp;&nbsp;&nbsp;
-    
+
     <a title="${ _('Edit') }" rel="tooltip" data-placement="bottom" data-bind="click: toggleEditing, css: {'btn': true, 'btn-inverse': isEditing}, visible: canEdit">
       <i class="fa fa-fw fa-pencil"></i>
     </a>
@@ -462,7 +462,7 @@ ${ commonheader(_("Workflow Editor"), "Oozie", user, "40px") | n,unicode }
     <div class="big-icon" data-bind="visible: ! $root.isEditing()"><i class="fa fa-magic"></i></div>
 
     <div data-bind="visible: $root.isEditing" style="padding: 10px">
-      <a class="custom-popover pull-right" href="javascript:void(0)" target="_blank" data-trigger="click" data-toggle="popover" data-placement="right" rel="popover" 
+      <a class="custom-popover pull-right" href="javascript:void(0)" target="_blank" data-trigger="click" data-toggle="popover" data-placement="right" rel="popover"
         data-html="true" data-content="<strong>${ _('Examples of predicates:') }</strong><br/>
                 <br/>${'${'} fs:fileSize(secondjobOutputDir) gt 10 * GB }
                 <br/>
@@ -470,7 +470,7 @@ ${ commonheader(_("Workflow Editor"), "Oozie", user, "40px") | n,unicode }
                 <br/>
                 <a href='http://oozie.apache.org/docs/4.1.0/WorkflowFunctionalSpec.html#a4.2_Expression_Language_Functions'>${ _('Click for more') }</a>">
           <i class="fa fa-question-circle" title="${ _('Click for more info') }"></i>
-      </a>    
+      </a>
       <ul data-bind="foreach: children" class="unstyled">
         <li>
           ${ _('If') } <input type="text" data-bind="value: $data['condition']" />
@@ -733,7 +733,7 @@ ${ commonheader(_("Workflow Editor"), "Oozie", user, "40px") | n,unicode }
 
         &nbsp;&nbsp;
 
-        <span data-bind="text: $root.workflow_properties.hive_xml.label"></span>      
+        <span data-bind="text: $root.workflow_properties.hive_xml.label"></span>
         <input type="text" style="width:25%" class="input-large filechooser-input" data-bind="filechooser: properties.hive_xml, filechooserOptions: globalFilechooserOptions, attr: { placeholder: $root.workflow_properties.hive_xml.help_text }"/>
 
         <div class="row-fluid">
@@ -1039,7 +1039,7 @@ ${ commonheader(_("Workflow Editor"), "Oozie", user, "40px") | n,unicode }
             </a>
           </li>
         </ul>
-        
+
         <div class="span12" data-bind="template: { name: 'common-properties-files' }"></div>
       </div>
     </div>
@@ -1075,12 +1075,12 @@ ${ commonheader(_("Workflow Editor"), "Oozie", user, "40px") | n,unicode }
 		    <a class="pointer" data-bind="click: function(){ properties.prepares.push({'type': 'delete', 'value': ''}); $(document).trigger('drawArrows') }">
 		      ${ _('Delete') } <i class="fa fa-plus"></i>
 		    </a>
-		
+
 		    <!-- ko if: properties.job_xml -->
 		      <h6>${ _('Job XML') }</h6>
 		      <input type="text" class="input-xlarge filechooser-input" data-bind="filechooser: properties.job_xml, filechooserOptions: globalFilechooserOptions, attr: { placeholder: $root.workflow_properties.job_xml.help_text }"/>
 		    <!-- /ko -->
-		
+
 		    <h6>
 		      <a class="pointer" data-bind="click: function(){ properties.archives.push(ko.mapping.fromJS({'name': ''})); $(document).trigger('drawArrows') }">
 		        ${ _('Archives') } <i class="fa fa-plus"></i>
@@ -1581,7 +1581,7 @@ ${ commonheader(_("Workflow Editor"), "Oozie", user, "40px") | n,unicode }
         <span data-bind="text: $root.workflow_properties.reducer.label"></span
         <input type="text" data-bind="value: properties.reducer" />
         <span data-bind='template: { name: "common-fs-link", data: {path: properties.reducer(), with_label: false} }'></span>
-        
+
         <div data-bind="template: { name: 'common-properties-files' }"></div>
       </div>
     </div>
@@ -1647,7 +1647,7 @@ ${ commonheader(_("Workflow Editor"), "Oozie", user, "40px") | n,unicode }
 
       </div>
     </div>
-    
+
     <div data-bind="visible: ! $root.isEditing()">
       ${ _('Parameters') }
       <ul data-bind="foreach: properties.distcp_parameters" class="unstyled">
@@ -1684,7 +1684,7 @@ ${ commonheader(_("Workflow Editor"), "Oozie", user, "40px") | n,unicode }
 		   <a class="pointer" data-bind="click: function(){ properties.prepares.push({'type': 'delete', 'value': ''}); $(document).trigger('drawArrows') }">
 		     ${ _('Delete') } <i class="fa fa-plus"></i>
 		   </a>
-		
+
 		   <h6>
 		     <a class="pointer" data-bind="click: function(){ properties.job_properties.push({'name': '', 'value': ''}); $(document).trigger('drawArrows') }">
 		       ${ _('Properties') } <i class="fa fa-plus"></i>
@@ -1701,8 +1701,8 @@ ${ commonheader(_("Workflow Editor"), "Oozie", user, "40px") | n,unicode }
            </ul>
            <em data-bind="visible: properties.job_properties().length == 0">${ _('No properties defined.') }</em>
 
-           <h6>             
-             <span data-bind="text: $root.workflow_properties.java_opts.label"></span>             
+           <h6>
+             <span data-bind="text: $root.workflow_properties.java_opts.label"></span>
            </h6>
            <input type="text" class="input-xlarge" data-bind="value: properties.java_opts, attr: { placeholder: $root.workflow_properties.java_opts.help_text }" />
         </div>
@@ -1813,7 +1813,7 @@ ${ commonheader(_("Workflow Editor"), "Oozie", user, "40px") | n,unicode }
         <i class="fa fa-plus"></i> ${ _('Add property') }
       </a>
 
-      <h4>${ _("Show graph arrows") }</h4>      
+      <h4>${ _("Show graph arrows") }</h4>
       <input type="checkbox" data-bind="checked: $root.workflow.properties.show_arrows" title="${ _('Toggle arrow showing') }" rel="tooltip" data-placement="bottom" />
 
       <h4>${ _("Version") }</h4>
@@ -1831,7 +1831,7 @@ ${ commonheader(_("Workflow Editor"), "Oozie", user, "40px") | n,unicode }
 </div>
 
 
-<div id="submit-wf-modal" class="modal hide"></div>
+<div class="submit-modal modal hide"></div>
 
 <div id="chooseFile" class="modal hide fade">
   <div class="modal-header">
@@ -1873,18 +1873,19 @@ ${ dashboard.import_bindings() }
 
 <script src="/oozie/static/js/workflow-editor.ko.js" type="text/javascript" charset="utf-8"></script>
 <script src="/static/ext/js/jquery/plugins/jquery.curvedarrow.js" type="text/javascript" charset="utf-8"></script>
-
+<script src="/oozie/static/js/editor2-utils.js" type="text/javascript" charset="utf-8"></script>
 
 <script type="text/javascript">
   ${ utils.slaGlobal() }
 
-  var viewModel = new WorkflowEditorViewModel(${ layout_json | n,unicode }, ${ workflow_json | n,unicode }, ${ credentials_json | n,unicode }, ${ workflow_properties_json | n,unicode }, ${ subworkflows_json | n,unicode }, ${ can_edit_json | n,unicode }); 
+  var viewModel = new WorkflowEditorViewModel(${ layout_json | n,unicode }, ${ workflow_json | n,unicode }, ${ credentials_json | n,unicode }, ${ workflow_properties_json | n,unicode }, ${ subworkflows_json | n,unicode }, ${ can_edit_json | n,unicode });
   ko.applyBindings(viewModel, $("#editor")[0]);
 
   var shareViewModel = initSharing("#documentShareModal");
   shareViewModel.setDocId(${ doc1_id });
 
   viewModel.init();
+  viewModel.workflow.tracker().markCurrentStateAsClean();
   fullLayout(viewModel);
 
   var globalFilechooserOptions = {
@@ -1921,15 +1922,6 @@ ${ dashboard.import_bindings() }
     }
   }
 
-
-  $(document).on("showSubmitPopup", function(event, data){
-    if (! viewModel.workflow.isDirty()){
-      $('#submit-wf-modal').html(data);
-      $('#submit-wf-modal').modal('show');
-    }
-  });
-
-
   function showAddActionDemiModal(widget) {
     viewModel.newAction(widget);
     $("#exposeOverlay").fadeIn(300);
@@ -2084,7 +2076,7 @@ ${ dashboard.import_bindings() }
           "width": _width
         });
         _el.width(500);
-        $("#exposeOverlay").fadeIn(300);  
+        $("#exposeOverlay").fadeIn(300);
         widget.oozieExpanded(true);
       }
       else {
diff --git a/apps/oozie/static/css/common-editor.css b/apps/oozie/static/css/common-editor.css
index 697efb7..ac159af 100644
--- a/apps/oozie/static/css/common-editor.css
+++ b/apps/oozie/static/css/common-editor.css
@@ -162,4 +162,6 @@ ul.with-margin li {
   margin-bottom: 4px;
 }
 
-
+.submit-modal .dropdown-menu {
+  box-shadow: 0 5px 10px rgba(0,0,0,0.2) !important;
+}
\ No newline at end of file
diff --git a/apps/oozie/static/css/coordinator-editor.css b/apps/oozie/static/css/coordinator-editor.css
index d6da9ad..1dab80f 100644
--- a/apps/oozie/static/css/coordinator-editor.css
+++ b/apps/oozie/static/css/coordinator-editor.css
@@ -28,10 +28,6 @@
   display: inline-block;
 }
 
-#submit-coord-modal .modal-body {
-  overflow: visible;
-}
-
 .datepicker {
   z-index: 1300;
 }
diff --git a/apps/oozie/static/js/bundle-editor.ko.js b/apps/oozie/static/js/bundle-editor.ko.js
index 59a1370..3a7a31d 100644
--- a/apps/oozie/static/js/bundle-editor.ko.js
+++ b/apps/oozie/static/js/bundle-editor.ko.js
@@ -16,21 +16,6 @@
 
 
 var Bundle = function (vm, bundle) {
-  function changeTracker(objectToTrack, hashFunction) {    
-      hashFunction = hashFunction || ko.toJSON;
-      var lastCleanState = ko.observable(hashFunction(objectToTrack));
-      
-      var result = {
-          somethingHasChanged : ko.dependentObservable(function() {
-              return hashFunction(objectToTrack) != lastCleanState()
-          }),
-          markCurrentStateAsClean : function() {
-              lastCleanState(hashFunction(objectToTrack));   
-          }
-      };
-      
-      return function() { return result }
-  }
 
   var self = this;
 
@@ -41,27 +26,27 @@ var Bundle = function (vm, bundle) {
   self.coordinators = ko.mapping.fromJS(typeof bundle.coordinators != "undefined" && bundle.coordinators != null ? bundle.coordinators : []);
   self.properties = ko.mapping.fromJS(typeof bundle.properties != "undefined" && bundle.properties != null ? bundle.properties : {});
 
-  self.tracker = new changeTracker(self);
-  
+  self.tracker = new ChangeTracker(self);  // from ko.common-dashboard.js
+
   self.isDirty = ko.computed(function () {
     return self.tracker().somethingHasChanged();
   });
-  
-  self.addCoordinator = function(coordinator_uuid) {
-    self.getCoordinatorParameters(coordinator_uuid);	  
+
+  self.addCoordinator = function (coordinator_uuid) {
+    self.getCoordinatorParameters(coordinator_uuid);
   };
-  
-  self.getCoordinatorParameters = function(uuid) {
-	$.get("/oozie/editor/coordinator/parameters/", {
-	  "uuid": uuid,
-	}, function (data) {
-	   var _var = {       
-           'coordinator': uuid,
-		   'properties': data.parameters
-	   };
+
+  self.getCoordinatorParameters = function (uuid) {
+    $.get("/oozie/editor/coordinator/parameters/", {
+      "uuid": uuid,
+    }, function (data) {
+      var _var = {
+        'coordinator': uuid,
+        'properties': data.parameters
+      };
 
       self.coordinators.push(ko.mapping.fromJS(_var));
-	}).fail(function (xhr, textStatus, errorThrown) {
+    }).fail(function (xhr, textStatus, errorThrown) {
       $(document).trigger("error", xhr.responseText);
     });
   };
@@ -73,35 +58,35 @@ var BundleEditorViewModel = function (bundle_json, coordinators_json, can_edit_j
 
   self.canEdit = ko.mapping.fromJS(can_edit_json);
   self.isEditing = ko.observable(bundle_json.id == null);
-  self.isEditing.subscribe(function(newVal){
+  self.isEditing.subscribe(function (newVal) {
     $(document).trigger("editingToggled");
   });
   self.toggleEditing = function () {
-    self.isEditing(! self.isEditing());
+    self.isEditing(!self.isEditing());
   };
 
   self.bundle = new Bundle(self, bundle_json);
-  
+
   self.coordinators = ko.mapping.fromJS(coordinators_json);
 
   self.coordinatorModalFilter = ko.observable("");
-  self.filteredModalCoordinators = ko.computed(function() {
+  self.filteredModalCoordinators = ko.computed(function () {
     var _filter = self.coordinatorModalFilter().toLowerCase();
     if (!_filter) {
       return self.coordinators();
     }
     else {
-      return ko.utils.arrayFilter(self.coordinators(), function(coord) {
+      return ko.utils.arrayFilter(self.coordinators(), function (coord) {
         return coord.name().toLowerCase().indexOf(_filter.toLowerCase()) > -1;
       });
     }
   }, self);
 
   self.getCoordinatorById = function (uuid) {
-    var _coords = ko.utils.arrayFilter(self.coordinators(), function(coord) {
+    var _coords = ko.utils.arrayFilter(self.coordinators(), function (coord) {
       return coord.uuid() == uuid;
     });
-    if (_coords.length > 0){
+    if (_coords.length > 0) {
       return _coords[0];
     }
     return null;
@@ -111,10 +96,10 @@ var BundleEditorViewModel = function (bundle_json, coordinators_json, can_edit_j
     self.bundle.addCoordinator(uuid);
   };
 
-  
+
   self.save = function () {
     $.post("/oozie/editor/bundle/save/", {
-        "bundle": ko.mapping.toJSON(self.bundle)
+      "bundle": ko.mapping.toJSON(self.bundle)
     }, function (data) {
       if (data.status == 0) {
         self.bundle.id(data.id);
@@ -126,22 +111,22 @@ var BundleEditorViewModel = function (bundle_json, coordinators_json, can_edit_j
       }
       else {
         $(document).trigger("error", data.message);
-     }
-   }).fail(function (xhr, textStatus, errorThrown) {
+      }
+    }).fail(function (xhr, textStatus, errorThrown) {
       $(document).trigger("error", xhr.responseText);
     });
   };
-  
+
   self.showSubmitPopup = function () {
     // If self.bundle.id() == null, need to save wf for now
-	  $(".jHueNotify").hide();
-    if (! self.bundle.isDirty()){
+    $(".jHueNotify").hide();
+    if (!self.bundle.isDirty()) {
       logGA('submit');
       $.get("/oozie/editor/bundle/submit/" + self.bundle.id(), {
-        }, function (data) {
-          $(document).trigger("showSubmitPopup", data);
+      }, function (data) {
+        $(document).trigger("showSubmitPopup", data);
       }).fail(function (xhr, textStatus, errorThrown) {
-          $(document).trigger("error", xhr.responseText);
+        $(document).trigger("error", xhr.responseText);
       });
     }
   };
diff --git a/apps/oozie/static/js/coordinator-editor.ko.js b/apps/oozie/static/js/coordinator-editor.ko.js
index 45a3c33..d385ae7 100644
--- a/apps/oozie/static/js/coordinator-editor.ko.js
+++ b/apps/oozie/static/js/coordinator-editor.ko.js
@@ -15,21 +15,6 @@
 // limitations under the License.
 
 var Coordinator = function (vm, coordinator) {
-  function changeTracker(objectToTrack, hashFunction) {    
-      hashFunction = hashFunction || ko.toJSON;
-      var lastCleanState = ko.observable(hashFunction(objectToTrack));
-      
-      var result = {
-          somethingHasChanged : ko.dependentObservable(function() {
-              return hashFunction(objectToTrack) != lastCleanState()
-          }),
-          markCurrentStateAsClean : function() {
-              lastCleanState(hashFunction(objectToTrack));   
-          }
-      };
-      
-      return function() { return result }
-  }
 
   var self = this;
 
@@ -39,19 +24,19 @@ var Coordinator = function (vm, coordinator) {
 
   self.properties = ko.mapping.fromJS(typeof coordinator.properties != "undefined" && coordinator.properties != null ? coordinator.properties : {});
   self.variables = ko.mapping.fromJS(typeof coordinator.variables != "undefined" && coordinator.variables != null ? coordinator.variables : []);
-  
+
   self.variablesUI = ko.observableArray(['parameter', 'input_path', 'output_path']);
   self.showAdvancedFrequencyUI = ko.observable(typeof coordinator.showAdvancedFrequencyUI != "undefined" && coordinator.showAdvancedFrequencyUI != null ? coordinator.showAdvancedFrequencyUI : false);
   self.workflowParameters = ko.mapping.fromJS(typeof coordinator.workflowParameters != "undefined" && coordinator.workflowParameters != null ? coordinator.workflowParameters : []);
 
-  self.tracker = new changeTracker(self);
-  
+  self.tracker = new ChangeTracker(self);  // from ko.common-dashboard.js
+
   self.isDirty = ko.computed(function () {
     return self.tracker().somethingHasChanged();
   });
-  
-  self._get_parameter = function(name) {
-    var _param = $.grep(self.properties.parameters(), function(param) {
+
+  self._get_parameter = function (name) {
+    var _param = $.grep(self.properties.parameters(), function (param) {
       return param.name() == name;
     });
 
@@ -61,90 +46,90 @@ var Coordinator = function (vm, coordinator) {
       return null;
     }
   }
-  
+
   self.start_date = self._get_parameter('start_date');
   self.end_date = self._get_parameter('end_date');
-  
+
   self.properties.startDateUI = ko.observable(typeof self.start_date.value() != "undefined" && self.start_date.value().indexOf("T") > -1 ? self.start_date.value().split("T")[0] : "");
   self.properties.startTimeUI = ko.observable(typeof self.start_date.value() != "undefined" && self.start_date.value().indexOf("T") > -1 ? self.start_date.value().split("T")[1] : "");
   self.properties.endDateUI = ko.observable(typeof self.end_date.value() != "undefined" && self.end_date.value().indexOf("T") > -1 ? self.end_date.value().split("T")[0] : "");
   self.properties.endTimeUI = ko.observable(typeof self.end_date.value() != "undefined" && self.end_date.value().indexOf("T") > -1 ? self.end_date.value().split("T")[1] : "");
 
-  self.properties.startDateUI.subscribe(function(newVal){
+  self.properties.startDateUI.subscribe(function (newVal) {
     self.setStartDate();
   });
-  self.properties.startTimeUI.subscribe(function(newVal){
+  self.properties.startTimeUI.subscribe(function (newVal) {
     self.setStartDate();
   });
-  self.properties.endDateUI.subscribe(function(newVal){
+  self.properties.endDateUI.subscribe(function (newVal) {
     self.setEndDate();
   });
-  self.properties.endTimeUI.subscribe(function(newVal){
+  self.properties.endTimeUI.subscribe(function (newVal) {
     self.setEndDate();
   });
 
-  self.setStartDate = function() {
+  self.setStartDate = function () {
     self.start_date.value(self.properties.startDateUI() + "T" + self.properties.startTimeUI());
   }
-  self.setEndDate = function() {
+  self.setEndDate = function () {
     self.end_date.value(self.properties.endDateUI() + "T" + self.properties.endTimeUI());
   }
 
 
-  self.properties.workflow.subscribe(function(newVal) {
+  self.properties.workflow.subscribe(function (newVal) {
     if (newVal) {
-	  $.get("/oozie/editor/workflow/parameters/", {
-		"uuid": self.properties.workflow(),
-	   }, function (data) {
-		 self.workflowParameters(data.parameters);
-		 // Pre-add the variables
-		 $.each(data.parameters, function(index, param) {
-		   if (self.variables().length < data.parameters.length) {
-		     self.addVariable();
-		   }
-		   self.variables()[self.variables().length - 1].workflow_variable(param['name']);
-		 });
-	  }).fail(function (xhr, textStatus, errorThrown) {
-	    $(document).trigger("error", xhr.responseText);
-	  });
-	}
+      $.get("/oozie/editor/workflow/parameters/", {
+        "uuid": self.properties.workflow(),
+      }, function (data) {
+        self.workflowParameters(data.parameters);
+        // Pre-add the variables
+        $.each(data.parameters, function (index, param) {
+          if (self.variables().length < data.parameters.length) {
+            self.addVariable();
+          }
+          self.variables()[self.variables().length - 1].workflow_variable(param['name']);
+        });
+      }).fail(function (xhr, textStatus, errorThrown) {
+        $(document).trigger("error", xhr.responseText);
+      });
+    }
   });
 
-  self.properties.cron_advanced.subscribe(function(value) {
-    if (value || ! vm.isEditing()) {
+  self.properties.cron_advanced.subscribe(function (value) {
+    if (value || !vm.isEditing()) {
       coordCron.disable();
     } else {
       coordCron.enable();
     }
   });
-  
-  self.addVariable = function() {
-    var _var = {       
-       'workflow_variable': '', // Variable we want to fill in the workflow
-       
-       'dataset_type': 'parameter',
-       
-       'uuid': UUID(), // Dataset
-       'dataset_variable': '', // Aka property or URI       
-       'show_advanced': false,
-       'use_done_flag': false,
-       'done_flag': '_SUCCESS',
-       'timezone': 'America/Los_Angeles',
-       'same_timezone': true,
-       'instance_choice': 'default',
-       'is_advanced_start_instance': false,
-       'start_instance': '0',
-       'advanced_start_instance': '${coord:current(0)}',
-       'is_advanced_end_instance': false,
-       'advanced_end_instance': '${coord:current(0)}',
-       'end_instance': '0',
-       'same_frequency': true,       
-       'frequency_number': 1,
-       'frequency_unit': 'days',
-       'start': new Date(),
-       'same_start': true,
-
-       'shared_dataset_uuid': '' // If reusing a shared dataset
+
+  self.addVariable = function () {
+    var _var = {
+      'workflow_variable': '', // Variable we want to fill in the workflow
+
+      'dataset_type': 'parameter',
+
+      'uuid': UUID(), // Dataset
+      'dataset_variable': '', // Aka property or URI
+      'show_advanced': false,
+      'use_done_flag': false,
+      'done_flag': '_SUCCESS',
+      'timezone': 'America/Los_Angeles',
+      'same_timezone': true,
+      'instance_choice': 'default',
+      'is_advanced_start_instance': false,
+      'start_instance': '0',
+      'advanced_start_instance': '${coord:current(0)}',
+      'is_advanced_end_instance': false,
+      'advanced_end_instance': '${coord:current(0)}',
+      'end_instance': '0',
+      'same_frequency': true,
+      'frequency_number': 1,
+      'frequency_unit': 'days',
+      'start': new Date(),
+      'same_start': true,
+
+      'shared_dataset_uuid': '' // If reusing a shared dataset
     };
     var _koVar = ko.mapping.fromJS(_var);
     for (key in _koVar) {
@@ -152,7 +137,7 @@ var Coordinator = function (vm, coordinator) {
         _koVar[key].extend({ trackChange: true });
       }
     }
-	  self.variables.push(_koVar);
+    self.variables.push(_koVar);
   };
 }
 
@@ -161,53 +146,53 @@ var CoordinatorEditorViewModel = function (coordinator_json, credentials_json, w
 
   self.canEdit = ko.mapping.fromJS(can_edit_json);
   self.isEditing = ko.observable(coordinator_json.id == null);
-  self.isEditing.subscribe(function(newVal){
+  self.isEditing.subscribe(function (newVal) {
     $(document).trigger("editingToggled");
     self.coordinator.properties.cron_advanced.valueHasMutated();
   });
   self.toggleEditing = function () {
-    self.isEditing(! self.isEditing());
+    self.isEditing(!self.isEditing());
   };
 
   self.workflows = ko.mapping.fromJS(workflows_json);
   self.coordinator = new Coordinator(self, coordinator_json);
   self.credentials = ko.mapping.fromJS(credentials_json);
 
-  self.availableTimezones = ko.observableArray(["Africa/Abidjan","Africa/Accra","Africa/Addis_Ababa","Africa/Algiers","Africa/Asmara","Africa/Asmera","Africa/Bamako","Africa/Bangui","Africa/Banjul","Africa/Bissau","Africa/Blantyre","Africa/Brazzaville","Africa/Bujumbura","Africa/Cairo","Africa/Casablanca","Africa/Ceuta","Africa/Conakry","Africa/Dakar","Africa/Dar_es_Salaam","Africa/Djibouti","Africa/Douala","Africa/El_Aaiun","Africa/Freetown","Africa/Gaborone","Africa/Harare","Africa/Johannesburg","Africa/Juba","Africa/Kampala","Africa/Khartoum","Africa/Kigali","Africa/Kinshasa","Africa/Lagos","Africa/Libreville","Africa/Lome","Africa/Luanda","Africa/Lubumbashi","Africa/Lusaka","Africa/Malabo","Africa/Maputo","Africa/Maseru","Africa/Mbabane","Africa/Mogadishu","Africa/Monrovia","Africa/Nairobi","Africa/Ndjamena","Africa/Niamey","Africa/Nouakchott","Africa/Ouagadougou","Africa/Porto-Novo","Africa/Sao_Tome","Africa/Timbuktu","Africa/Tripoli","Africa/Tunis","Africa/Windhoek","America/Adak","America/Anchorage","America/Anguilla","America/Antigua","America/Araguaina","America/Argentina/Buenos_Aires","America/Argentina/Catamarca","America/Argentina/ComodRivadavia","America/Argentina/Cordoba","America/Argentina/Jujuy","America/Argentina/La_Rioja","America/Argentina/Mendoza","America/Argentina/Rio_Gallegos","America/Argentina/Salta","America/Argentina/San_Juan","America/Argentina/San_Luis","America/Argentina/Tucuman","America/Argentina/Ushuaia","America/Aruba","America/Asuncion","America/Atikokan","America/Atka","America/Bahia","America/Bahia_Banderas","America/Barbados","America/Belem","America/Belize","America/Blanc-Sablon","America/Boa_Vista","America/Bogota","America/Boise","America/Buenos_Aires","America/Cambridge_Bay","America/Campo_Grande","America/Cancun","America/Caracas","America/Catamarca","America/Cayenne","America/Cayman","America/Chicago","America/Chihuahua","America/Coral_Harbour","America/Cordoba","America/Costa_Rica","America/Creston","America/Cuiaba","America/Curacao","America/Danmarkshavn","America/Dawson","America/Dawson_Creek","America/Denver","America/Detroit","America/Dominica","America/Edmonton","America/Eirunepe","America/El_Salvador","America/Ensenada","America/Fort_Wayne","America/Fortaleza","America/Glace_Bay","America/Godthab","America/Goose_Bay","America/Grand_Turk","America/Grenada","America/Guadeloupe","America/Guatemala","America/Guayaquil","America/Guyana","America/Halifax","America/Havana","America/Hermosillo","America/Indiana/Indianapolis","America/Indiana/Knox","America/Indiana/Marengo","America/Indiana/Petersburg","America/Indiana/Tell_City","America/Indiana/Vevay","America/Indiana/Vincennes","America/Indiana/Winamac","America/Indianapolis","America/Inuvik","America/Iqaluit","America/Jamaica","America/Jujuy","America/Juneau","America/Kentucky/Louisville","America/Kentucky/Monticello","America/Knox_IN","America/Kralendijk","America/La_Paz","America/Lima","America/Los_Angeles","America/Louisville","America/Lower_Princes","America/Maceio","America/Managua","America/Manaus","America/Marigot","America/Martinique","America/Matamoros","America/Mazatlan","America/Mendoza","America/Menominee","America/Merida","America/Metlakatla","America/Mexico_City","America/Miquelon","America/Moncton","America/Monterrey","America/Montevideo","America/Montreal","America/Montserrat","America/Nassau","America/New_York","America/Nipigon","America/Nome","America/Noronha","America/North_Dakota/Beulah","America/North_Dakota/Center","America/North_Dakota/New_Salem","America/Ojinaga","America/Panama","America/Pangnirtung","America/Paramaribo","America/Phoenix","America/Port-au-Prince","America/Port_of_Spain","America/Porto_Acre","America/Porto_Velho","America/Puerto_Rico","America/Rainy_River","America/Rankin_Inlet","America/Recife","America/Regina","America/Resolute","America/Rio_Branco","America/Rosario","America/Santa_Isabel","America/Santarem","America/Santiago","America/Santo_Domingo","America/Sao_Paulo","America/Scoresbysund","America/Shiprock","America/Sitka","America/St_Barthelemy","America/St_Johns","America/St_Kitts","America/St_Lucia","America/St_Thomas","America/St_Vincent","America/Swift_Current","America/Tegucigalpa","America/Thule","America/Thunder_Bay","America/Tijuana","America/Toronto","America/Tortola","America/Vancouver","America/Virgin","America/Whitehorse","America/Winnipeg","America/Yakutat","America/Yellowknife","Antarctica/Casey","Antarctica/Davis","Antarctica/DumontDUrville","Antarctica/Macquarie","Antarctica/Mawson","Antarctica/McMurdo","Antarctica/Palmer","Antarctica/Rothera","Antarctica/South_Pole","Antarctica/Syowa","Antarctica/Vostok","Arctic/Longyearbyen","Asia/Aden","Asia/Almaty","Asia/Amman","Asia/Anadyr","Asia/Aqtau","Asia/Aqtobe","Asia/Ashgabat","Asia/Ashkhabad","Asia/Baghdad","Asia/Bahrain","Asia/Baku","Asia/Bangkok","Asia/Beijing","Asia/Beirut","Asia/Bishkek","Asia/Brunei","Asia/Calcutta","Asia/Choibalsan","Asia/Chongqing","Asia/Chungking","Asia/Colombo","Asia/Dacca","Asia/Damascus","Asia/Dhaka","Asia/Dili","Asia/Dubai","Asia/Dushanbe","Asia/Gaza","Asia/Harbin","Asia/Hebron","Asia/Ho_Chi_Minh","Asia/Hong_Kong","Asia/Hovd","Asia/Irkutsk","Asia/Istanbul","Asia/Jakarta","Asia/Jayapura","Asia/Jerusalem","Asia/Kabul","Asia/Kamchatka","Asia/Karachi","Asia/Kashgar","Asia/Kathmandu","Asia/Katmandu","Asia/Kolkata","Asia/Krasnoyarsk","Asia/Kuala_Lumpur","Asia/Kuching","Asia/Kuwait","Asia/Macao","Asia/Macau","Asia/Magadan","Asia/Makassar","Asia/Manila","Asia/Muscat","Asia/Nicosia","Asia/Novokuznetsk","Asia/Novosibirsk","Asia/Omsk","Asia/Oral","Asia/Phnom_Penh","Asia/Pontianak","Asia/Pyongyang","Asia/Qatar","Asia/Qyzylorda","Asia/Rangoon","Asia/Riyadh","Asia/Riyadh87","Asia/Riyadh88","Asia/Riyadh89","Asia/Saigon","Asia/Sakhalin","Asia/Samarkand","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Taipei","Asia/Tashkent","Asia/Tbilisi","Asia/Tehran","Asia/Tel_Aviv","Asia/Thimbu","Asia/Thimphu","Asia/Tokyo","Asia/Ujung_Pandang","Asia/Ulaanbaatar","Asia/Ulan_Bator","Asia/Urumqi","Asia/Vientiane","Asia/Vladivostok","Asia/Yakutsk","Asia/Yekaterinburg","Asia/Yerevan","Atlantic/Azores","Atlantic/Bermuda","Atlantic/Canary","Atlantic/Cape_Verde","Atlantic/Faeroe","Atlantic/Faroe","Atlantic/Jan_Mayen","Atlantic/Madeira","Atlantic/Reykjavik","Atlantic/South_Georgia","Atlantic/St_Helena","Atlantic/Stanley","Australia/ACT","Australia/Adelaide","Australia/Brisbane","Australia/Broken_Hill","Australia/Canberra","Australia/Currie","Australia/Darwin","Australia/Eucla","Australia/Hobart","Australia/LHI","Australia/Lindeman","Australia/Lord_Howe","Australia/Melbourne","Australia/NSW","Australia/North","Australia/Perth","Australia/Queensland","Australia/South","Australia/Sydney","Australia/Tasmania","Australia/Victoria","Australia/West","Australia/Yancowinna","Brazil/Acre","Brazil/DeNoronha","Brazil/East","Brazil/West","CET","CST6CDT","Canada/Atlantic","Canada/Central","Canada/East-Saskatchewan","Canada/Eastern","Canada/Mountain","Canada/Newfoundland","Canada/Pacific","Canada/Saskatchewan","Canada/Yukon","Chile/Continental","Chile/EasterIsland","Cuba","EET","EST","EST5EDT","Egypt","Eire","Etc/GMT","Etc/GMT+0","Etc/GMT+1","Etc/GMT+10","Etc/GMT+11","Etc/GMT+12","Etc/GMT+2","Etc/GMT+3","Etc/GMT+4","Etc/GMT+5","Etc/GMT+6","Etc/GMT+7","Etc/GMT+8","Etc/GMT+9","Etc/GMT-0","Etc/GMT-1","Etc/GMT-10","Etc/GMT-11","Etc/GMT-12","Etc/GMT-13","Etc/GMT-14","Etc/GMT-2","Etc/GMT-3","Etc/GMT-4","Etc/GMT-5","Etc/GMT-6","Etc/GMT-7","Etc/GMT-8","Etc/GMT-9","Etc/GMT0","Etc/Greenwich","Etc/UCT","Etc/UTC","Etc/Universal","Etc/Zulu","Europe/Amsterdam","Europe/Andorra","Europe/Athens","Europe/Belfast","Europe/Belgrade","Europe/Berlin","Europe/Bratislava","Europe/Brussels","Europe/Bucharest","Europe/Budapest","Europe/Chisinau","Europe/Copenhagen","Europe/Dublin","Europe/Gibraltar","Europe/Guernsey","Europe/Helsinki","Europe/Isle_of_Man","Europe/Istanbul","Europe/Jersey","Europe/Kaliningrad","Europe/Kiev","Europe/Lisbon","Europe/Ljubljana","Europe/London","Europe/Luxembourg","Europe/Madrid","Europe/Malta","Europe/Mariehamn","Europe/Minsk","Europe/Monaco","Europe/Moscow","Europe/Nicosia","Europe/Oslo","Europe/Paris","Europe/Podgorica","Europe/Prague","Europe/Riga","Europe/Rome","Europe/Samara","Europe/San_Marino","Europe/Sarajevo","Europe/Simferopol","Europe/Skopje","Europe/Sofia","Europe/Stockholm","Europe/Tallinn","Europe/Tirane","Europe/Tiraspol","Europe/Uzhgorod","Europe/Vaduz","Europe/Vatican","Europe/Vienna","Europe/Vilnius","Europe/Volgograd","Europe/Warsaw","Europe/Zagreb","Europe/Zaporozhye","Europe/Zurich","Factory","GB","GB-Eire","GMT","GMT+0","GMT+1","GMT+10","GMT+11","GMT+12","GMT+13","GMT+14","GMT+2","GMT+3","GMT+4","GMT+5","GMT+6","GMT+7","GMT+8","GMT+9","GMT-0","GMT-1","GMT-10","GMT-11","GMT-12","GMT-2","GMT-3","GMT-4","GMT-5","GMT-6","GMT-7","GMT-8","GMT-9","GMT0","Greenwich","HST","Hongkong","Iceland","Indian/Antananarivo","Indian/Chagos","Indian/Christmas","Indian/Cocos","Indian/Comoro","Indian/Kerguelen","Indian/Mahe","Indian/Maldives","Indian/Mauritius","Indian/Mayotte","Indian/Reunion","Iran","Israel","Jamaica","Japan","Kwajalein","Libya","MET","MST","MST7MDT","Mexico/BajaNorte","Mexico/BajaSur","Mexico/General","Mideast/Riyadh87","Mideast/Riyadh88","Mideast/Riyadh89","NZ","NZ-CHAT","Navajo","PRC","PST8PDT","Pacific/Apia","Pacific/Auckland","Pacific/Chatham","Pacific/Chuuk","Pacific/Easter","Pacific/Efate","Pacific/Enderbury","Pacific/Fakaofo","Pacific/Fiji","Pacific/Funafuti","Pacific/Galapagos","Pacific/Gambier","Pacific/Guadalcanal","Pacific/Guam","Pacific/Honolulu","Pacific/Johnston","Pacific/Kiritimati","Pacific/Kosrae","Pacific/Kwajalein","Pacific/Majuro","Pacific/Marquesas","Pacific/Midway","Pacific/Nauru","Pacific/Niue","Pacific/Norfolk","Pacific/Noumea","Pacific/Pago_Pago","Pacific/Palau","Pacific/Pitcairn","Pacific/Pohnpei","Pacific/Ponape","Pacific/Port_Moresby","Pacific/Rarotonga","Pacific/Saipan","Pacific/Samoa","Pacific/Tahiti","Pacific/Tarawa","Pacific/Tongatapu","Pacific/Truk","Pacific/Wake","Pacific/Wallis","Pacific/Yap","Poland","Portugal","ROC","ROK","Singapore","Turkey","UCT","US/Alaska","US/Aleutian","US/Arizona","US/Central","US/East-Indiana","US/Eastern","US/Hawaii","US/Indiana-Starke","US/Michigan","US/Mountain","US/Pacific","US/Pacific-New","US/Samoa","Universal","W-SU","WET","Zulu"]);
+  self.availableTimezones = ko.observableArray(["Africa/Abidjan", "Africa/Accra", "Africa/Addis_Ababa", "Africa/Algiers", "Africa/Asmara", "Africa/Asmera", "Africa/Bamako", "Africa/Bangui", "Africa/Banjul", "Africa/Bissau", "Africa/Blantyre", "Africa/Brazzaville", "Africa/Bujumbura", "Africa/Cairo", "Africa/Casablanca", "Africa/Ceuta", "Africa/Conakry", "Africa/Dakar", "Africa/Dar_es_Salaam", "Africa/Djibouti", "Africa/Douala", "Africa/El_Aaiun", "Africa/Freetown", "Africa/Gaborone", "Africa/Harare", "Africa/Johannesburg", "Africa/Juba", "Africa/Kampala", "Africa/Khartoum", "Africa/Kigali", "Africa/Kinshasa", "Africa/Lagos", "Africa/Libreville", "Africa/Lome", "Africa/Luanda", "Africa/Lubumbashi", "Africa/Lusaka", "Africa/Malabo", "Africa/Maputo", "Africa/Maseru", "Africa/Mbabane", "Africa/Mogadishu", "Africa/Monrovia", "Africa/Nairobi", "Africa/Ndjamena", "Africa/Niamey", "Africa/Nouakchott", "Africa/Ouagadougou", "Africa/Porto-Novo", "Africa/Sao_Tome", "Africa/Timbuktu", "Africa/Tripoli", "Africa/Tunis", "Africa/Windhoek", "America/Adak", "America/Anchorage", "America/Anguilla", "America/Antigua", "America/Araguaina", "America/Argentina/Buenos_Aires", "America/Argentina/Catamarca", "America/Argentina/ComodRivadavia", "America/Argentina/Cordoba", "America/Argentina/Jujuy", "America/Argentina/La_Rioja", "America/Argentina/Mendoza", "America/Argentina/Rio_Gallegos", "America/Argentina/Salta", "America/Argentina/San_Juan", "America/Argentina/San_Luis", "America/Argentina/Tucuman", "America/Argentina/Ushuaia", "America/Aruba", "America/Asuncion", "America/Atikokan", "America/Atka", "America/Bahia", "America/Bahia_Banderas", "America/Barbados", "America/Belem", "America/Belize", "America/Blanc-Sablon", "America/Boa_Vista", "America/Bogota", "America/Boise", "America/Buenos_Aires", "America/Cambridge_Bay", "America/Campo_Grande", "America/Cancun", "America/Caracas", "America/Catamarca", "America/Cayenne", "America/Cayman", "America/Chicago", "America/Chihuahua", "America/Coral_Harbour", "America/Cordoba", "America/Costa_Rica", "America/Creston", "America/Cuiaba", "America/Curacao", "America/Danmarkshavn", "America/Dawson", "America/Dawson_Creek", "America/Denver", "America/Detroit", "America/Dominica", "America/Edmonton", "America/Eirunepe", "America/El_Salvador", "America/Ensenada", "America/Fort_Wayne", "America/Fortaleza", "America/Glace_Bay", "America/Godthab", "America/Goose_Bay", "America/Grand_Turk", "America/Grenada", "America/Guadeloupe", "America/Guatemala", "America/Guayaquil", "America/Guyana", "America/Halifax", "America/Havana", "America/Hermosillo", "America/Indiana/Indianapolis", "America/Indiana/Knox", "America/Indiana/Marengo", "America/Indiana/Petersburg", "America/Indiana/Tell_City", "America/Indiana/Vevay", "America/Indiana/Vincennes", "America/Indiana/Winamac", "America/Indianapolis", "America/Inuvik", "America/Iqaluit", "America/Jamaica", "America/Jujuy", "America/Juneau", "America/Kentucky/Louisville", "America/Kentucky/Monticello", "America/Knox_IN", "America/Kralendijk", "America/La_Paz", "America/Lima", "America/Los_Angeles", "America/Louisville", "America/Lower_Princes", "America/Maceio", "America/Managua", "America/Manaus", "America/Marigot", "America/Martinique", "America/Matamoros", "America/Mazatlan", "America/Mendoza", "America/Menominee", "America/Merida", "America/Metlakatla", "America/Mexico_City", "America/Miquelon", "America/Moncton", "America/Monterrey", "America/Montevideo", "America/Montreal", "America/Montserrat", "America/Nassau", "America/New_York", "America/Nipigon", "America/Nome", "America/Noronha", "America/North_Dakota/Beulah", "America/North_Dakota/Center", "America/North_Dakota/New_Salem", "America/Ojinaga", "America/Panama", "America/Pangnirtung", "America/Paramaribo", "America/Phoenix", "America/Port-au-Prince", "America/Port_of_Spain", "America/Porto_Acre", "America/Porto_Velho", "America/Puerto_Rico", "America/Rainy_River", "America/Rankin_Inlet", "America/Recife", "America/Regina", "America/Resolute", "America/Rio_Branco", "America/Rosario", "America/Santa_Isabel", "America/Santarem", "America/Santiago", "America/Santo_Domingo", "America/Sao_Paulo", "America/Scoresbysund", "America/Shiprock", "America/Sitka", "America/St_Barthelemy", "America/St_Johns", "America/St_Kitts", "America/St_Lucia", "America/St_Thomas", "America/St_Vincent", "America/Swift_Current", "America/Tegucigalpa", "America/Thule", "America/Thunder_Bay", "America/Tijuana", "America/Toronto", "America/Tortola", "America/Vancouver", "America/Virgin", "America/Whitehorse", "America/Winnipeg", "America/Yakutat", "America/Yellowknife", "Antarctica/Casey", "Antarctica/Davis", "Antarctica/DumontDUrville", "Antarctica/Macquarie", "Antarctica/Mawson", "Antarctica/McMurdo", "Antarctica/Palmer", "Antarctica/Rothera", "Antarctica/South_Pole", "Antarctica/Syowa", "Antarctica/Vostok", "Arctic/Longyearbyen", "Asia/Aden", "Asia/Almaty", "Asia/Amman", "Asia/Anadyr", "Asia/Aqtau", "Asia/Aqtobe", "Asia/Ashgabat", "Asia/Ashkhabad", "Asia/Baghdad", "Asia/Bahrain", "Asia/Baku", "Asia/Bangkok", "Asia/Beijing", "Asia/Beirut", "Asia/Bishkek", "Asia/Brunei", "Asia/Calcutta", "Asia/Choibalsan", "Asia/Chongqing", "Asia/Chungking", "Asia/Colombo", "Asia/Dacca", "Asia/Damascus", "Asia/Dhaka", "Asia/Dili", "Asia/Dubai", "Asia/Dushanbe", "Asia/Gaza", "Asia/Harbin", "Asia/Hebron", "Asia/Ho_Chi_Minh", "Asia/Hong_Kong", "Asia/Hovd", "Asia/Irkutsk", "Asia/Istanbul", "Asia/Jakarta", "Asia/Jayapura", "Asia/Jerusalem", "Asia/Kabul", "Asia/Kamchatka", "Asia/Karachi", "Asia/Kashgar", "Asia/Kathmandu", "Asia/Katmandu", "Asia/Kolkata", "Asia/Krasnoyarsk", "Asia/Kuala_Lumpur", "Asia/Kuching", "Asia/Kuwait", "Asia/Macao", "Asia/Macau", "Asia/Magadan", "Asia/Makassar", "Asia/Manila", "Asia/Muscat", "Asia/Nicosia", "Asia/Novokuznetsk", "Asia/Novosibirsk", "Asia/Omsk", "Asia/Oral", "Asia/Phnom_Penh", "Asia/Pontianak", "Asia/Pyongyang", "Asia/Qatar", "Asia/Qyzylorda", "Asia/Rangoon", "Asia/Riyadh", "Asia/Riyadh87", "Asia/Riyadh88", "Asia/Riyadh89", "Asia/Saigon", "Asia/Sakhalin", "Asia/Samarkand", "Asia/Seoul", "Asia/Shanghai", "Asia/Singapore", "Asia/Taipei", "Asia/Tashkent", "Asia/Tbilisi", "Asia/Tehran", "Asia/Tel_Aviv", "Asia/Thimbu", "Asia/Thimphu", "Asia/Tokyo", "Asia/Ujung_Pandang", "Asia/Ulaanbaatar", "Asia/Ulan_Bator", "Asia/Urumqi", "Asia/Vientiane", "Asia/Vladivostok", "Asia/Yakutsk", "Asia/Yekaterinburg", "Asia/Yerevan", "Atlantic/Azores", "Atlantic/Bermuda", "Atlantic/Canary", "Atlantic/Cape_Verde", "Atlantic/Faeroe", "Atlantic/Faroe", "Atlantic/Jan_Mayen", "Atlantic/Madeira", "Atlantic/Reykjavik", "Atlantic/South_Georgia", "Atlantic/St_Helena", "Atlantic/Stanley", "Australia/ACT", "Australia/Adelaide", "Australia/Brisbane", "Australia/Broken_Hill", "Australia/Canberra", "Australia/Currie", "Australia/Darwin", "Australia/Eucla", "Australia/Hobart", "Australia/LHI", "Australia/Lindeman", "Australia/Lord_Howe", "Australia/Melbourne", "Australia/NSW", "Australia/North", "Australia/Perth", "Australia/Queensland", "Australia/South", "Australia/Sydney", "Australia/Tasmania", "Australia/Victoria", "Australia/West", "Australia/Yancowinna", "Brazil/Acre", "Brazil/DeNoronha", "Brazil/East", "Brazil/West", "CET", "CST6CDT", "Canada/Atlantic", "Canada/Central", "Canada/East-Saskatchewan", "Canada/Eastern", "Canada/Mountain", "Canada/Newfoundland", "Canada/Pacific", "Canada/Saskatchewan", "Canada/Yukon", "Chile/Continental", "Chile/EasterIsland", "Cuba", "EET", "EST", "EST5EDT", "Egypt", "Eire", "Etc/GMT", "Etc/GMT+0", "Etc/GMT+1", "Etc/GMT+10", "Etc/GMT+11", "Etc/GMT+12", "Etc/GMT+2", "Etc/GMT+3", "Etc/GMT+4", "Etc/GMT+5", "Etc/GMT+6", "Etc/GMT+7", "Etc/GMT+8", "Etc/GMT+9", "Etc/GMT-0", "Etc/GMT-1", "Etc/GMT-10", "Etc/GMT-11", "Etc/GMT-12", "Etc/GMT-13", "Etc/GMT-14", "Etc/GMT-2", "Etc/GMT-3", "Etc/GMT-4", "Etc/GMT-5", "Etc/GMT-6", "Etc/GMT-7", "Etc/GMT-8", "Etc/GMT-9", "Etc/GMT0", "Etc/Greenwich", "Etc/UCT", "Etc/UTC", "Etc/Universal", "Etc/Zulu", "Europe/Amsterdam", "Europe/Andorra", "Europe/Athens", "Europe/Belfast", "Europe/Belgrade", "Europe/Berlin", "Europe/Bratislava", "Europe/Brussels", "Europe/Bucharest", "Europe/Budapest", "Europe/Chisinau", "Europe/Copenhagen", "Europe/Dublin", "Europe/Gibraltar", "Europe/Guernsey", "Europe/Helsinki", "Europe/Isle_of_Man", "Europe/Istanbul", "Europe/Jersey", "Europe/Kaliningrad", "Europe/Kiev", "Europe/Lisbon", "Europe/Ljubljana", "Europe/London", "Europe/Luxembourg", "Europe/Madrid", "Europe/Malta", "Europe/Mariehamn", "Europe/Minsk", "Europe/Monaco", "Europe/Moscow", "Europe/Nicosia", "Europe/Oslo", "Europe/Paris", "Europe/Podgorica", "Europe/Prague", "Europe/Riga", "Europe/Rome", "Europe/Samara", "Europe/San_Marino", "Europe/Sarajevo", "Europe/Simferopol", "Europe/Skopje", "Europe/Sofia", "Europe/Stockholm", "Europe/Tallinn", "Europe/Tirane", "Europe/Tiraspol", "Europe/Uzhgorod", "Europe/Vaduz", "Europe/Vatican", "Europe/Vienna", "Europe/Vilnius", "Europe/Volgograd", "Europe/Warsaw", "Europe/Zagreb", "Europe/Zaporozhye", "Europe/Zurich", "Factory", "GB", "GB-Eire", "GMT", "GMT+0", "GMT+1", "GMT+10", "GMT+11", "GMT+12", "GMT+13", "GMT+14", "GMT+2", "GMT+3", "GMT+4", "GMT+5", "GMT+6", "GMT+7", "GMT+8", "GMT+9", "GMT-0", "GMT-1", "GMT-10", "GMT-11", "GMT-12", "GMT-2", "GMT-3", "GMT-4", "GMT-5", "GMT-6", "GMT-7", "GMT-8", "GMT-9", "GMT0", "Greenwich", "HST", "Hongkong", "Iceland", "Indian/Antananarivo", "Indian/Chagos", "Indian/Christmas", "Indian/Cocos", "Indian/Comoro", "Indian/Kerguelen", "Indian/Mahe", "Indian/Maldives", "Indian/Mauritius", "Indian/Mayotte", "Indian/Reunion", "Iran", "Israel", "Jamaica", "Japan", "Kwajalein", "Libya", "MET", "MST", "MST7MDT", "Mexico/BajaNorte", "Mexico/BajaSur", "Mexico/General", "Mideast/Riyadh87", "Mideast/Riyadh88", "Mideast/Riyadh89", "NZ", "NZ-CHAT", "Navajo", "PRC", "PST8PDT", "Pacific/Apia", "Pacific/Auckland", "Pacific/Chatham", "Pacific/Chuuk", "Pacific/Easter", "Pacific/Efate", "Pacific/Enderbury", "Pacific/Fakaofo", "Pacific/Fiji", "Pacific/Funafuti", "Pacific/Galapagos", "Pacific/Gambier", "Pacific/Guadalcanal", "Pacific/Guam", "Pacific/Honolulu", "Pacific/Johnston", "Pacific/Kiritimati", "Pacific/Kosrae", "Pacific/Kwajalein", "Pacific/Majuro", "Pacific/Marquesas", "Pacific/Midway", "Pacific/Nauru", "Pacific/Niue", "Pacific/Norfolk", "Pacific/Noumea", "Pacific/Pago_Pago", "Pacific/Palau", "Pacific/Pitcairn", "Pacific/Pohnpei", "Pacific/Ponape", "Pacific/Port_Moresby", "Pacific/Rarotonga", "Pacific/Saipan", "Pacific/Samoa", "Pacific/Tahiti", "Pacific/Tarawa", "Pacific/Tongatapu", "Pacific/Truk", "Pacific/Wake", "Pacific/Wallis", "Pacific/Yap", "Poland", "Portugal", "ROC", "ROK", "Singapore", "Turkey", "UCT", "US/Alaska", "US/Aleutian", "US/Arizona", "US/Central", "US/East-Indiana", "US/Eastern", "US/Hawaii", "US/Indiana-Starke", "US/Michigan", "US/Mountain", "US/Pacific", "US/Pacific-New", "US/Samoa", "Universal", "W-SU", "WET", "Zulu"]);
   self.availableSettings = ko.observableArray([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60]);
 
   if (coordinator_json.id == null && self.coordinator.properties.workflow()) {
-	self.coordinator.properties.workflow.valueHasMutated();
+    self.coordinator.properties.workflow.valueHasMutated();
   }
 
   self.workflowModalFilter = ko.observable("");
-  self.filteredModalWorkflows = ko.computed(function() {
+  self.filteredModalWorkflows = ko.computed(function () {
     var _filter = self.workflowModalFilter().toLowerCase();
-    if (! _filter) {
+    if (!_filter) {
       return self.workflows();
     }
     else {
-      return ko.utils.arrayFilter(self.workflows(), function(wf) {
+      return ko.utils.arrayFilter(self.workflows(), function (wf) {
         return wf.name().toLowerCase().indexOf(_filter.toLowerCase()) > -1;
       });
     }
   }, self);
 
   self.getWorkflowById = function (uuid) {
-    var _wfs = ko.utils.arrayFilter(self.workflows(), function(wf) {
+    var _wfs = ko.utils.arrayFilter(self.workflows(), function (wf) {
       return wf.uuid() == uuid;
     });
-    if (_wfs.length > 0){
+    if (_wfs.length > 0) {
       return _wfs[0];
     }
     return null;
   }
-  
-  
+
+
   self.save = function () {
     $(".jHueNotify").hide();
     $.post("/oozie/editor/coordinator/save/", {
-        "coordinator": ko.mapping.toJSON(self.coordinator)
+      "coordinator": ko.mapping.toJSON(self.coordinator)
     }, function (data) {
       if (data.status == 0) {
         self.coordinator.id(data.id);
@@ -219,40 +204,40 @@ var CoordinatorEditorViewModel = function (coordinator_json, credentials_json, w
       }
       else {
         $(document).trigger("error", data.message);
-     }
-   }).fail(function (xhr, textStatus, errorThrown) {
+      }
+    }).fail(function (xhr, textStatus, errorThrown) {
       $(document).trigger("error", xhr.responseText);
     });
   };
 
   self.gen_xml = function () {
-	$(".jHueNotify").hide();
-	  logGA('gen_xml');
+    $(".jHueNotify").hide();
+    logGA('gen_xml');
 
     $.post("/oozie/editor/coordinator/gen_xml/", {
-        "coordinator": ko.mapping.toJSON(self.coordinator)
+      "coordinator": ko.mapping.toJSON(self.coordinator)
     }, function (data) {
       if (data.status == 0) {
         console.log(data.xml);
       }
       else {
         $(document).trigger("error", data.message);
-     }
-   }).fail(function (xhr, textStatus, errorThrown) {
+      }
+    }).fail(function (xhr, textStatus, errorThrown) {
       $(document).trigger("error", xhr.responseText);
     });
   };
-  
+
   self.showSubmitPopup = function () {
-	  $(".jHueNotify").hide();
-    
-    if (! self.coordinator.isDirty()){
+    $(".jHueNotify").hide();
+
+    if (!self.coordinator.isDirty()) {
       logGA('submit');
       $.get("/oozie/editor/coordinator/submit/" + self.coordinator.id(), {
-        }, function (data) {
-          $(document).trigger("showSubmitPopup", data);
+      }, function (data) {
+        $(document).trigger("showSubmitPopup", data);
       }).fail(function (xhr, textStatus, errorThrown) {
-          $(document).trigger("error", xhr.responseText);
+        $(document).trigger("error", xhr.responseText);
       });
     }
   };
diff --git a/apps/oozie/static/js/editor2-utils.js b/apps/oozie/static/js/editor2-utils.js
new file mode 100644
index 0000000..eca255a
--- /dev/null
+++ b/apps/oozie/static/js/editor2-utils.js
@@ -0,0 +1,27 @@
+// Licensed to Cloudera, Inc. under one
+// or more contributor license agreements.  See the NOTICE file
+// distributed with this work for additional information
+// regarding copyright ownership.  Cloudera, Inc. licenses this file
+// to you under the Apache License, Version 2.0 (the
+// "License"); you may not use this file except in compliance
+// with the License.  You may obtain a copy of the License at
+//
+//     http://www.apache.org/licenses/LICENSE-2.0
+//
+// Unless required by applicable law or agreed to in writing, software
+// distributed under the License is distributed on an "AS IS" BASIS,
+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+// See the License for the specific language governing permissions and
+// limitations under the License.
+
+$(document).ready(function () {
+  $(document).on("showSubmitPopup", function (event, data) {
+    $('.submit-modal').html(data);
+    $('.submit-modal').modal('show');
+    var _sel = $('.submit-form .control-group[rel!="popover"]:visible');
+    console.log(_sel.length)
+    if (_sel.length > 0) {
+      $('.submit-modal .modal-body').height(_sel.length * 65 + 100);
+    }
+  });
+});
\ No newline at end of file
diff --git a/apps/oozie/static/js/workflow-editor.ko.js b/apps/oozie/static/js/workflow-editor.ko.js
index a58bada..e7852d3 100644
--- a/apps/oozie/static/js/workflow-editor.ko.js
+++ b/apps/oozie/static/js/workflow-editor.ko.js
@@ -85,19 +85,21 @@ var Node = function (node) {
   self.children = ko.mapping.fromJS(typeof node.children != "undefined" && node.children != null ? node.children : []);
 
   self.actionParameters = ko.observableArray([]);
-  self.actionParametersUI = ko.computed(function() {
-	if (typeof self.properties.parameters != "undefined") {
-      var _vars = $.map(self.properties.parameters(), function(p, i) { return p.value().split('=', 1)[0]; });
-      if (typeof self.actionParameters() == "undefined"){
+  self.actionParametersUI = ko.computed(function () {
+    if (typeof self.properties.parameters != "undefined") {
+      var _vars = $.map(self.properties.parameters(), function (p, i) {
+        return p.value().split('=', 1)[0];
+      });
+      if (typeof self.actionParameters() == "undefined") {
         return _vars;
       }
-      return $.grep(self.actionParameters(), function(param) {
+      return $.grep(self.actionParameters(), function (param) {
         return _vars.indexOf(param) == -1;
       });
-	}
+    }
   });
   self.actionParametersFetched = ko.observable(false);
-  
+
   self.get_link = function (name) {
     var _link = null;
     $.each(self.children(), function (index, link) {
@@ -133,33 +135,33 @@ var Node = function (node) {
       self.children.remove(_link);
     }
   };
-  
-  self.fetch_parameters = function() {
-    if (typeof self.properties.parameters != "undefined" && ! self.actionParametersFetched()) { // Fetch once the possible variable when they exist 
+
+  self.fetch_parameters = function () {
+    if (typeof self.properties.parameters != "undefined" && !self.actionParametersFetched()) { // Fetch once the possible variable when they exist
       $.post("/oozie/editor/workflow/action/parameters/", {
-         "node": ko.mapping.toJSON(self),
-	  }, function (data) {
-	    self.actionParametersFetched(true);
-	    self.actionParameters(data.parameters);
-	    if (data.parameters && data.parameters.length > 0 && self.properties.parameters().length == 0) { // If new node with variables, give a hint by adding a parameter
-	      self.properties.parameters.push(ko.mapping.fromJS({'value': ''}));
-	    }
-	  }).fail(function (xhr, textStatus, errorThrown) {
-	    $(document).trigger("error", xhr.responseText);
+        "node": ko.mapping.toJSON(self),
+      }, function (data) {
+        self.actionParametersFetched(true);
+        self.actionParameters(data.parameters);
+        if (data.parameters && data.parameters.length > 0 && self.properties.parameters().length == 0) { // If new node with variables, give a hint by adding a parameter
+          self.properties.parameters.push(ko.mapping.fromJS({'value': ''}));
+        }
+      }).fail(function (xhr, textStatus, errorThrown) {
+        $(document).trigger("error", xhr.responseText);
       });
     }
-  };  
-  
-  if (typeof self.properties.parameters != "undefined") { 
-    self.properties.parameters.subscribe(function(newVal) {
+  };
+
+  if (typeof self.properties.parameters != "undefined") {
+    self.properties.parameters.subscribe(function (newVal) {
       if (newVal) {
-	    self.fetch_parameters();
-	  }
-    });  
+        self.fetch_parameters();
+      }
+    });
   }
-  
+
   if (typeof self.properties.script_path != "undefined") {
-    self.properties.script_path.subscribe(function() {
+    self.properties.script_path.subscribe(function () {
       self.actionParametersFetched(false);
     });
   }
@@ -167,13 +169,18 @@ var Node = function (node) {
 
 
 var Workflow = function (vm, workflow) {
+
   var self = this;
 
   self.id = ko.observable(typeof workflow.id != "undefined" && workflow.id != null ? workflow.id : null);
   self.uuid = ko.observable(typeof workflow.uuid != "undefined" && workflow.uuid != null ? workflow.uuid : UUID());
   self.name = ko.observable(typeof workflow.name != "undefined" && workflow.name != null ? workflow.name : "");
 
-  self.isDirty = ko.observable(false);
+  self.tracker = new ChangeTracker(self); // from ko.common-dashboard.js
+
+  self.isDirty = ko.computed(function () {
+    return self.tracker().somethingHasChanged();
+  });
 
   self.properties = ko.mapping.fromJS(typeof workflow.properties != "undefined" && workflow.properties != null ? workflow.properties : {});
   self.nodes = ko.observableArray([]);
@@ -181,7 +188,7 @@ var Workflow = function (vm, workflow) {
   self.versions = ko.mapping.fromJS(['uri:oozie:workflow:0.4', 'uri:oozie:workflow:0.4.5', 'uri:oozie:workflow:0.5']);
   self.movedNode = null;
   self.properties.show_arrows.subscribe(function (newVal) {
-    if (newVal){
+    if (newVal) {
       $(document).trigger("drawArrows");
     }
     else {
@@ -189,35 +196,6 @@ var Workflow = function (vm, workflow) {
     }
   });
 
-  self.nodesProperties = ko.computed(function () {
-    var isDirtyContainer = [];
-    $.each(self.nodes(), function (index, node) {
-      for(var property in node.properties) {
-        if (typeof node.properties[property] == "function"){
-          var _obs = node.properties[property]();
-           isDirtyContainer.push(_obs);
-           if ($.isArray(_obs)){
-             _obs.forEach(function(item){
-               isDirtyContainer.push(typeof item.value == "function" ? item.value() : item.value);
-             });
-           }
-        }
-      }
-    });
-    return isDirtyContainer;
-  });
-
-  self.oldNodesPropertiesHash = "";
-  self.nodesProperties.subscribe(function(newVal){
-    if (self.oldNodesPropertiesHash == ""){
-      self.oldNodesPropertiesHash = JSON.stringify(newVal);
-    }
-    if (JSON.stringify(newVal) !== self.oldNodesPropertiesHash){
-      self.oldNodesPropertiesHash = JSON.stringify(newVal);
-      self.isDirty(true);
-    }
-  });
-
   self.nodeIds = ko.computed(function () {
     var mapping = [];
 
@@ -275,10 +253,10 @@ var Workflow = function (vm, workflow) {
       success: function (data) {
         if (data.status == 0) {
           viewModel.addActionProperties.removeAll();
-          $.each(data.properties, function(i, prop) {
-        	viewModel.addActionProperties.push(ko.mapping.fromJS(prop));  
+          $.each(data.properties, function (i, prop) {
+            viewModel.addActionProperties.push(ko.mapping.fromJS(prop));
           });
-          
+
           if (data.workflows.length > 0) {
             viewModel.subworfklows(data.workflows);
           }
@@ -286,7 +264,6 @@ var Workflow = function (vm, workflow) {
           if (callback) {
             callback(widget, sourceNode);
           }
-          self.isDirty(true);
         }
       },
       async: false
@@ -333,10 +310,10 @@ var Workflow = function (vm, workflow) {
             var forkParent = self.getNodeById(vm.getWidgetPredecessor(parentWidget.id()).id());
 
             // In case of Fork of Fork, we need to pick the link of the neighbor of new node instead of just the first forkParent.get_link('to')
-            var newParentLink = $.grep(forkParent.children(), function(link) {
+            var newParentLink = $.grep(forkParent.children(), function (link) {
               return vm.getWidgetPredecessor(ko.mapping.toJS(link)['to']).id() == fork.id();
-            })[0];  
- 
+            })[0];
+
             var afterParentId = ko.mapping.toJS(newParentLink).to;
             var afterParent = self.getNodeById(afterParentId);
             fork.children.push({'to': afterParentId, 'condition': '${ 1 gt 0 }'});
@@ -377,7 +354,7 @@ var Workflow = function (vm, workflow) {
             node.set_link('to', child.id());
             node.set_link('error', '17c9c895-5a16-7443-bb81-f34b30b21548');
           } else {
-            // Parent is regular node        	
+            // Parent is regular node
             node.set_link('to', parent.get_link('to')['to']);
             node.set_link('error', '17c9c895-5a16-7443-bb81-f34b30b21548');
 
@@ -386,8 +363,6 @@ var Workflow = function (vm, workflow) {
         }
 
         vm.currentlyCreatingFork = false;
-        self.isDirty(true);
-
       } else {
         $(document).trigger("error", data.message);
       }
@@ -443,7 +418,6 @@ var Workflow = function (vm, workflow) {
       } else if (parent.type() == 'decision-widget') {
         parent.remove_link('to', childId);
       }
-      self.isDirty(true);
     }
     else {
       self.nodes.remove(node);
@@ -494,7 +468,7 @@ var WorkflowEditorViewModel = function (layout_json, workflow_json, credentials_
     $(document).trigger("editingToggled");
   });
   self.toggleEditing = function () {
-    self.isEditing(! self.isEditing());
+    self.isEditing(!self.isEditing());
   };
 
   self.isRunning = ko.observable(false);
@@ -516,11 +490,11 @@ var WorkflowEditorViewModel = function (layout_json, workflow_json, credentials_
   };
 
   self.addActionProperties = ko.observableArray([]);
-  self.addActionPropertiesFilledOut = ko.computed(function (){
+  self.addActionPropertiesFilledOut = ko.computed(function () {
     var _filledInternalValues = function (val) {
       var _iAllFilled = true;
-      val.forEach(function(iVal){
-        if (iVal.value() == ''){
+      val.forEach(function (iVal) {
+        if (iVal.value() == '') {
           _iAllFilled = false;
         }
       });
@@ -529,16 +503,16 @@ var WorkflowEditorViewModel = function (layout_json, workflow_json, credentials_
     var _allFilled = true;
     ko.utils.arrayForEach(self.addActionProperties(), function (property) {
       var _val = property.value();
-      if (($.isArray(_val) && !_filledInternalValues(_val) ) || _val == ''){
+      if (($.isArray(_val) && !_filledInternalValues(_val) ) || _val == '') {
         _allFilled = false;
       }
     });
     return _allFilled;
   });
   self.subworfklows = ko.observableArray(subworkflows_json);
-  self.getSubWorkflow = function(uuid) {
-    var wf = $.grep(self.subworfklows(), function(wf, i) {
-        return wf.value == uuid;
+  self.getSubWorkflow = function (uuid) {
+    var wf = $.grep(self.subworfklows(), function (wf, i) {
+      return wf.value == uuid;
     });
     if (wf[0]) {
       return ko.mapping.fromJS(wf[0]);
@@ -558,13 +532,14 @@ var WorkflowEditorViewModel = function (layout_json, workflow_json, credentials_
 
   self.enableSideDrop = function (widget) {
     toggleSideDrop(widget, true);
-    sideDropsTouched.forEach(function(row) {
+    sideDropsTouched.forEach(function (row) {
       row.enableOozieDropOnSide(true);
     });
     sideDropsTouched = [];
   }
 
   var sideDropsTouched = [];
+
   function toggleSideDrop(widget, enable) {
     if (widget != null && widget.id() != "" && self.currentlyDraggedOp() == "move") {
       var _row = self.getWidgetParentRow(widget.id());
@@ -1051,24 +1026,24 @@ var WorkflowEditorViewModel = function (layout_json, workflow_json, credentials_
   }
 
   self.save = function () {
-	$(".jHueNotify").hide();
+    $(".jHueNotify").hide();
     $.post("/oozie/editor/workflow/save/", {
       "layout": ko.mapping.toJSON(self.oozieColumns),
       "workflow": ko.mapping.toJSON(self.workflow)
     }, function (data) {
       if (data.status == 0) {
-    	if (data.url) { 
+        if (data.url) {
           window.location.replace(data.url);
-    	}
-    	if (self.workflow.id() == null) {
-    	  shareViewModel.setDocId(data.doc1_id);
-    	}
+        }
+        if (self.workflow.id() == null) {
+          shareViewModel.setDocId(data.doc1_id);
+        }
         self.workflow.id(data.id);
         $(document).trigger("info", data.message);
         if (window.location.search.indexOf("workflow") == -1) {
           window.location.hash = '#workflow=' + data.id;
         }
-        self.workflow.isDirty(false);
+        self.workflow.tracker().markCurrentStateAsClean();
       }
       else {
         $(document).trigger("error", data.message);
@@ -1095,7 +1070,7 @@ var WorkflowEditorViewModel = function (layout_json, workflow_json, credentials_
   };
 
   self.showSubmitPopup = function () {
-	$(".jHueNotify").hide();
+    $(".jHueNotify").hide();
     $.get("/oozie/editor/workflow/submit/" + self.workflow.id(), {
     }, function (data) {
       $(document).trigger("showSubmitPopup", data);
@@ -1103,7 +1078,7 @@ var WorkflowEditorViewModel = function (layout_json, workflow_json, credentials_
       $(document).trigger("error", xhr.responseText);
     });
   };
-  
+
   self.schedule = function () {
     window.location.replace('/oozie/editor/coordinator/new/?workflow=' + self.workflow.uuid());
   };
@@ -1194,7 +1169,7 @@ var ExtendedColumn = function (size, rows) {
 var ExtendedRow = function (widgets, vm, columns) {
   var self = new Row(widgets, vm, columns);
   self.columnPrototype = ExtendedColumn;
-  self.enableOozieDrop = ko.computed(function(){
+  self.enableOozieDrop = ko.computed(function () {
     return vm.isEditing && vm.isEditing() && self.widgets && self.widgets().length < 1
   });
 
@@ -1206,8 +1181,8 @@ var ExtendedRow = function (widgets, vm, columns) {
 
 var ExtendedWidget = function (params) {
   var self = new Widget(params);
-  self.oozieMovable = ko.computed(function() {
-    return ["end-widget", "start-widget", "fork-widget", "decision-widget", "join-widget"].indexOf(self.widgetType()) == - 1
+  self.oozieMovable = ko.computed(function () {
+    return ["end-widget", "start-widget", "fork-widget", "decision-widget", "join-widget"].indexOf(self.widgetType()) == -1
   });
 
   self.oozieExpanded = ko.observable(false);
diff --git a/desktop/core/static/js/ko.common-dashboard.js b/desktop/core/static/js/ko.common-dashboard.js
index b2a4c60..7c6537e 100644
--- a/desktop/core/static/js/ko.common-dashboard.js
+++ b/desktop/core/static/js/ko.common-dashboard.js
@@ -67,8 +67,8 @@ var Row = function (widgets, vm, columns) {
   self.id = ko.observable(UUID());
   self.widgets = ko.observableArray(widgets);
   self.columns = ko.observableArray(columns ? columns : []);
-  self.columns.subscribe(function(val){
-    self.columns().forEach(function(col){
+  self.columns.subscribe(function (val) {
+    self.columns().forEach(function (col) {
       col.percWidth((100 - self.columns().length * 0.5) / self.columns().length);
     });
   });
@@ -78,11 +78,11 @@ var Row = function (widgets, vm, columns) {
   };
 
   self.addEmptyColumn = function (atBeginning) {
-    if (self.columns().length == 0){
+    if (self.columns().length == 0) {
       var _col = self.addColumn(null, atBeginning);
-      if (self.widgets().length > 0){
+      if (self.widgets().length > 0) {
         var _row = _col.addEmptyRow();
-        self.widgets().forEach(function(widget){
+        self.widgets().forEach(function (widget) {
           _row.addWidget(widget);
         });
         self.widgets([]);
@@ -95,11 +95,11 @@ var Row = function (widgets, vm, columns) {
     if (typeof column == "undefined" || column == null) {
       var _size = Math.max(1, Math.floor(12 / (self.columns().length + 1)));
       column = new self.columnPrototype(_size, []); // Hacky but needed when a new row is deleted
-      self.columns().forEach(function(col){
+      self.columns().forEach(function (col) {
         col.size(_size);
       });
     }
-    if (typeof atBeginning == "undefined" || atBeginning == null || ! atBeginning) {
+    if (typeof atBeginning == "undefined" || atBeginning == null || !atBeginning) {
       self.columns.push(column);
     }
     else {
@@ -160,7 +160,7 @@ var Row = function (widgets, vm, columns) {
 var Widget = function (params) {
   var self = this;
 
-  self.extend = function() {
+  self.extend = function () {
     return self;
   }
 
@@ -283,4 +283,22 @@ function setLayout(colSizes, vm) {
   vm.columns(_cols);
 
   $(document).trigger("setLayout");
-}
\ No newline at end of file
+}
+
+function ChangeTracker(objectToTrack, hashFunction) {
+  hashFunction = hashFunction || ko.toJSON;
+  var lastCleanState = ko.observable(hashFunction(objectToTrack));
+
+  var result = {
+    somethingHasChanged: ko.dependentObservable(function () {
+      return hashFunction(objectToTrack) != lastCleanState()
+    }),
+    markCurrentStateAsClean: function () {
+      lastCleanState(hashFunction(objectToTrack));
+    }
+  };
+
+  return function () {
+    return result
+  }
+}
-- 
1.7.9.5

