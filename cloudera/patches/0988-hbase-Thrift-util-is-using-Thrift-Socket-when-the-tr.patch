From ab63a4c2eb9818fc7ad631c6513113d9947d2d9b Mon Sep 17 00:00:00 2001
From: Romain Rigaux <romain@cloudera.com>
Date: Wed, 4 Mar 2015 16:47:23 -0800
Subject: [PATCH 0988/1173] [hbase] Thrift util is using Thrift Socket when
 the transport mode is 'socket'

---
 apps/hbase/src/hbase/api.py  |    2 +-
 apps/hbase/src/hbase/conf.py |    4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/apps/hbase/src/hbase/api.py b/apps/hbase/src/hbase/api.py
index c9090a7..90c6fdd 100644
--- a/apps/hbase/src/hbase/api.py
+++ b/apps/hbase/src/hbase/api.py
@@ -97,7 +97,7 @@ class HbaseApi(object):
                                   use_sasl=_security['use_sasl'],
                                   timeout_seconds=30,
                                   transport=conf.THRIFT_TRANSPORT.get(),
-                                  transport_mode='http' if is_using_thrift_http() else 'tcp',
+                                  transport_mode='http' if is_using_thrift_http() else 'socket',
                                   http_url=('https://' if is_using_thrift_ssl() else 'http://') + target['host'] + ':' + str(target['port'])
     )
 
diff --git a/apps/hbase/src/hbase/conf.py b/apps/hbase/src/hbase/conf.py
index ac3c56d..4128696 100644
--- a/apps/hbase/src/hbase/conf.py
+++ b/apps/hbase/src/hbase/conf.py
@@ -19,7 +19,7 @@ import os
 
 from django.utils.translation import ugettext_lazy as _t
 
-from desktop.lib.conf import Config, validate_thrift_transport, coerce_str_lowercase
+from desktop.lib.conf import Config, validate_thrift_transport, coerce_str_lowercase, coerce_bool
 
 
 HBASE_CLUSTERS = Config(
@@ -57,7 +57,7 @@ USE_DOAS = Config(
   key='use_doas',
   help=_t('Force Hue to use Http Thrift mode with doas impersonation, regarless of hbase-site.xml properties.'),
   default=False,
-  type=bool
+  type=coerce_bool
 )
 
 
-- 
1.7.9.5

