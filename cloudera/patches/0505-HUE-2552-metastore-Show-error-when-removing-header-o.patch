From 57cbbfda077a9ec2bf62eb56464e283134dddd55 Mon Sep 17 00:00:00 2001
From: Romain Rigaux <romain@cloudera.com>
Date: Thu, 29 Jan 2015 10:50:28 +0800
Subject: [PATCH 0505/1173] HUE-2552 [metastore] Show error when removing
 header of file missing permissions

---
 apps/beeswax/src/beeswax/create_table.py |    7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/apps/beeswax/src/beeswax/create_table.py b/apps/beeswax/src/beeswax/create_table.py
index 54eff34..893a02b 100644
--- a/apps/beeswax/src/beeswax/create_table.py
+++ b/apps/beeswax/src/beeswax/create_table.py
@@ -20,6 +20,7 @@ import csv
 import gzip
 import json
 import logging
+import re
 
 from django.core.urlresolvers import reverse
 from django.http import QueryDict
@@ -40,7 +41,6 @@ from beeswax.forms import CreateTableForm, ColumnTypeFormSet,\
   TERMINATOR_CHOICES
 from beeswax.server import dbms
 from beeswax.views import execute_directly
-import re
 
 
 LOG = logging.getLogger(__name__)
@@ -468,7 +468,10 @@ def load_after_create(request, database):
     raise PopupException(msg)
 
   if is_remove_header:
-    remove_header(request.fs, path)
+    try:
+      remove_header(request.fs, path)
+    except Exception, e:
+      raise PopupException(_("The headers of the file could not be removed."), detail=e)
 
   LOG.debug("Auto loading data from %s into table %s" % (path, tablename))
   hql = "LOAD DATA INPATH '%s' INTO TABLE `%s.%s`" % (path, database, tablename)
-- 
1.7.9.5

