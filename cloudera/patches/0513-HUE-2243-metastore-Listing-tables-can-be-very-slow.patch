From c2e9b265e5e21afebba31fbcb569c390d749e187 Mon Sep 17 00:00:00 2001
From: Romain Rigaux <romain@cloudera.com>
Date: Tue, 3 Feb 2015 09:50:03 -0500
Subject: [PATCH 0513/1173] HUE-2243 [metastore] Listing tables can be very
 slow

---
 apps/beeswax/src/beeswax/server/dbms.py |   15 ++++++++++++---
 1 file changed, 12 insertions(+), 3 deletions(-)

diff --git a/apps/beeswax/src/beeswax/server/dbms.py b/apps/beeswax/src/beeswax/server/dbms.py
index 6fd067c..8807302 100644
--- a/apps/beeswax/src/beeswax/server/dbms.py
+++ b/apps/beeswax/src/beeswax/server/dbms.py
@@ -115,8 +115,17 @@ class HiveServer2Dbms(object):
     return self.client.get_table(database, table_name)
 
 
-  def get_tables(self, database='default', table_names='.*'):
-    return self.client.get_tables(database, table_names)
+  def get_tables(self, database='default', table_names='*'):
+      hql = "SHOW TABLES IN %s '%s'" % (database, table_names) # self.client.get_tables(database, table_names) is too slow
+      query = hql_query(hql)
+      handle = self.execute_and_wait(query, timeout_sec=15.0)
+
+      if handle:
+        result = self.fetch(handle, rows=5000)
+        self.close(handle)
+        return [name for table in result.rows() for name in table]
+      else:
+        return []
 
 
   def get_databases(self):
@@ -239,7 +248,7 @@ class HiveServer2Dbms(object):
 
   def invalidate_tables(self, database, tables):
     for table in tables:
-      hql = "INVALIDATE METADATA %s.%s" % (database, table,)        
+      hql = "INVALIDATE METADATA %s.%s" % (database, table,)
       query = hql_query(hql, database, query_type=QUERY_TYPES[1])
 
       handle = self.execute_and_wait(query, timeout_sec=10.0)
-- 
1.7.9.5

