From 001c61f54eda737f31380bc6fbbb159cd1a3c119 Mon Sep 17 00:00:00 2001
From: Karissa McKelvey <krmckelv@gmail.com>
Date: Tue, 21 Oct 2014 12:11:38 -0700
Subject: [PATCH 0064/1173] HUE-2131 [core] Add sharing to pig, hive, rdbms

---
 apps/beeswax/src/beeswax/templates/execute.mako    | 1160 +++++++++---------
 apps/beeswax/src/beeswax/views.py                  |    5 +-
 apps/pig/src/pig/models.py                         |    5 +-
 apps/pig/src/pig/templates/app.mako                | 1273 ++++++++++----------
 apps/pig/src/pig/views.py                          |    2 +
 apps/pig/static/js/pig.ko.js                       |   13 +-
 apps/rdbms/src/rdbms/templates/execute.mako        |  281 ++---
 apps/rdbms/src/rdbms/views.py                      |    1 +
 desktop/core/src/desktop/api.py                    |  108 +-
 .../core/src/desktop/templates/common_header.mako  |    2 +-
 .../core/src/desktop/templates/common_share.mako   |    2 +-
 desktop/core/src/desktop/templates/home.mako       |   17 +-
 desktop/core/src/desktop/urls.py                   |    1 +
 desktop/core/static/css/hue3.css                   |   23 +
 desktop/core/static/js/share.vm.js                 |   61 +-
 15 files changed, 1504 insertions(+), 1450 deletions(-)

diff --git a/apps/beeswax/src/beeswax/templates/execute.mako b/apps/beeswax/src/beeswax/templates/execute.mako
index c167a50..ec98f6e 100644
--- a/apps/beeswax/src/beeswax/templates/execute.mako
+++ b/apps/beeswax/src/beeswax/templates/execute.mako
@@ -30,685 +30,689 @@ ${ commonheader(_('Query'), app_name, user) | n,unicode }
 ${layout.menubar(section='query')}
 
 <div id="temporaryPlaceholder"></div>
+<div id="beeswax-execute">
+  <div id="query-editor" class="container-fluid hide section">
+  <div class="row-fluid">
 
-<div id="query-editor" class="container-fluid hide section">
-<div class="row-fluid">
-
-<div class="span2" id="navigator">
-  <ul class="nav nav-tabs" style="margin-bottom: 0">
-    <li class="active"><a href="#navigatorTab" data-toggle="tab" class="sidetab">${_('Assist')}</a></li>
-    <li><a href="#settingsTab" data-toggle="tab" class="sidetab">${_('Settings')} <span data-bind="visible:design.settings.values().length + design.fileResources.values().length + design.functions.values().length > 0, text: design.settings.values().length + design.fileResources.values().length + design.functions.values().length" class="badge badge-info">12</span></a></li>
-  </ul>
-  <div class="tab-content">
-    <div class="tab-pane active" id="navigatorTab">
-      <div class="card card-small card-tab">
-        <div class="card-body" style="margin-top: 0">
-          <a href="#" title="${_('Double click on a table name or field to insert it in the editor')}" rel="tooltip" data-placement="top" class="pull-right" style="margin:3px; margin-top:7px">
-            <i class="fa fa-question-circle"></i>
-          </a>
-          <a id="refreshNavigator" href="#" title="${_('Manually refresh the table list')}" rel="tooltip" data-placement="top" class="pull-right" style="margin:3px; margin-top:7px">
-            <i class="fa fa-refresh"></i>
-          </a>
-          <ul class="nav nav-list" style="border: none; padding: 0; background-color: #FFF">
-            <li class="nav-header">${_('database')}</li>
-          </ul>
-          <select data-bind="options: databases, value: database" class="input-medium chosen-select hide" name="query-database" data-placeholder="${_('Choose a database...')}"></select>
-          <input id="navigatorSearch" type="text" placeholder="${ _('Table name...') }" style="width:90%; margin-top: 20px"/>
-          <div id="navigatorNoTables">${_('The selected database has no tables.')}</div>
-          <ul id="navigatorTables" class="unstyled"></ul>
-          <div id="navigatorLoader" class="center">
-            <!--[if !IE]><!--><i class="fa fa-spinner fa-spin" style="font-size: 20px; color: #BBB"></i><!--<![endif]-->
-            <!--[if IE]><img src="/static/art/spinner.gif"/><![endif]-->
+  <div class="span2" id="navigator">
+    <ul class="nav nav-tabs" style="margin-bottom: 0">
+      <li class="active"><a href="#navigatorTab" data-toggle="tab" class="sidetab">${_('Assist')}</a></li>
+      <li><a href="#settingsTab" data-toggle="tab" class="sidetab">${_('Settings')} <span data-bind="visible:design.settings.values().length + design.fileResources.values().length + design.functions.values().length > 0, text: design.settings.values().length + design.fileResources.values().length + design.functions.values().length" class="badge badge-info">12</span></a></li>
+    </ul>
+    <div class="tab-content">
+      <div class="tab-pane active" id="navigatorTab">
+        <div class="card card-small card-tab">
+          <div class="card-body" style="margin-top: 0">
+            <a href="#" title="${_('Double click on a table name or field to insert it in the editor')}" rel="tooltip" data-placement="top" class="pull-right" style="margin:3px; margin-top:7px">
+              <i class="fa fa-question-circle"></i>
+            </a>
+            <a id="refreshNavigator" href="#" title="${_('Manually refresh the table list')}" rel="tooltip" data-placement="top" class="pull-right" style="margin:3px; margin-top:7px">
+              <i class="fa fa-refresh"></i>
+            </a>
+            <ul class="nav nav-list" style="border: none; padding: 0; background-color: #FFF">
+              <li class="nav-header">${_('database')}</li>
+            </ul>
+            <select data-bind="options: databases, value: database" class="input-medium chosen-select hide" name="query-database" data-placeholder="${_('Choose a database...')}"></select>
+            <input id="navigatorSearch" type="text" placeholder="${ _('Table name...') }" style="width:90%; margin-top: 20px"/>
+            <div id="navigatorNoTables">${_('The selected database has no tables.')}</div>
+            <ul id="navigatorTables" class="unstyled"></ul>
+            <div id="navigatorLoader" class="center">
+              <!--[if !IE]><!--><i class="fa fa-spinner fa-spin" style="font-size: 20px; color: #BBB"></i><!--<![endif]-->
+              <!--[if IE]><img src="/static/art/spinner.gif"/><![endif]-->
+            </div>
           </div>
         </div>
       </div>
-    </div>
-    <div class="tab-pane" id="settingsTab">
-      <div class="card card-small card-tab">
-        <div class="card-body">
-          <div id="advanced-settings">
-          <form id="advancedSettingsForm" action="" method="POST" class="form form-horizontal">
-              ${ csrf_token(request) | n,unicode }
-              <ul class="nav nav-list" style="border: none; padding: 0;">
-                <li class="nav-header">${_('settings')}</li>
-                <li class="white paramContainer">
-                  <!-- ko foreach: design.settings.values -->
-                  <div class="param">
-                    <div class="remove">
-                      <button data-bind="click: $root.removeSetting.bind(this, $index())" type="button" class="btn btn-mini settingsDelete" title="${_('Delete this setting')}">x
-                      </button>
-                    </div>
-                    <div data-bind="css: {'error': $root.getSettingKeyErrors($index()).length > 0}" class="control-group">
-                      <label>${_('Key')}</label>
-                      <input data-bind="value: key" type="text" class="settingsField span8" autocomplete="off" placeholder="${ 'impala.resultset.cache.size' if app_name == 'impala' else 'mapred.reduce.tasks' }"/>
-                    </div>
+      <div class="tab-pane" id="settingsTab">
+        <div class="card card-small card-tab">
+          <div class="card-body">
+            <div id="advanced-settings">
+            <form id="advancedSettingsForm" action="" method="POST" class="form form-horizontal">
+                ${ csrf_token(request) | n,unicode }
+                <ul class="nav nav-list" style="border: none; padding: 0;">
+                  <li class="nav-header">${_('settings')}</li>
+                  <li class="white paramContainer">
+                    <!-- ko foreach: design.settings.values -->
+                    <div class="param">
+                      <div class="remove">
+                        <button data-bind="click: $root.removeSetting.bind(this, $index())" type="button" class="btn btn-mini settingsDelete" title="${_('Delete this setting')}">x
+                        </button>
+                      </div>
+                      <div data-bind="css: {'error': $root.getSettingKeyErrors($index()).length > 0}" class="control-group">
+                        <label>${_('Key')}</label>
+                        <input data-bind="value: key" type="text" class="settingsField span8" autocomplete="off" placeholder="${ 'impala.resultset.cache.size' if app_name == 'impala' else 'mapred.reduce.tasks' }"/>
+                      </div>
 
-                    <div data-bind="css: {'error': $root.getSettingValueErrors($index()).length > 0}" class="control-group">
-                      <label>${_('Value')}</label>
-                      <input data-bind="value: value" type="text" class="settingValuesField span8" placeholder="${ '5000' if app_name == 'impala' else '1' }"/>
-                    </div>
-                  </div>
-                  <!-- /ko -->
-
-                  <div class="control-group">
-                    <a data-bind="click: function() { $root.addSetting('','') }" class="btn btn-mini paramAdd">${_('Add')}</a>
-                  </div>
-                </li>
-                <li class="nav-header
-                  % if app_name == 'impala':
-                     hide
-                  % endif
-                  ">
-                  ${_('File Resources')}
-                </li>
-                <li class="white paramContainer
-                  % if app_name == 'impala':
-                     hide
-                  % endif
-                  ">
-                  <!-- ko foreach: design.fileResources.values -->
-                  <div class="param">
-                    <div class="remove">
-                      <button data-bind="click: $root.removeFileResource.bind(this, $index())" type="button" class="btn btn-mini" title="${_('Delete this setting')}">&times;</button>
+                      <div data-bind="css: {'error': $root.getSettingValueErrors($index()).length > 0}" class="control-group">
+                        <label>${_('Value')}</label>
+                        <input data-bind="value: value" type="text" class="settingValuesField span8" placeholder="${ '5000' if app_name == 'impala' else '1' }"/>
+                      </div>
                     </div>
-                    <div data-bind="css: {'error': $root.getFileResourceTypeErrors($index()).length > 0}" class="control-group">
-                      <label>${_('Type')}</label>
-                      <select data-bind="value: type" class="input-small">
-                        <option value="JAR">${_('jar')}</option>
-                        <option value="ARCHIVE">${_('archive')}</option>
-                        <option value="FILE">${_('file')}</option>
-                      </select>
+                    <!-- /ko -->
+
+                    <div class="control-group">
+                      <a data-bind="click: function() { $root.addSetting('','') }" class="btn btn-mini paramAdd">${_('Add')}</a>
                     </div>
+                  </li>
+                  <li class="nav-header
+                    % if app_name == 'impala':
+                       hide
+                    % endif
+                    ">
+                    ${_('File Resources')}
+                  </li>
+                  <li class="white paramContainer
+                    % if app_name == 'impala':
+                       hide
+                    % endif
+                    ">
+                    <!-- ko foreach: design.fileResources.values -->
+                    <div class="param">
+                      <div class="remove">
+                        <button data-bind="click: $root.removeFileResource.bind(this, $index())" type="button" class="btn btn-mini" title="${_('Delete this setting')}">&times;</button>
+                      </div>
+                      <div data-bind="css: {'error': $root.getFileResourceTypeErrors($index()).length > 0}" class="control-group">
+                        <label>${_('Type')}</label>
+                        <select data-bind="value: type" class="input-small">
+                          <option value="JAR">${_('jar')}</option>
+                          <option value="ARCHIVE">${_('archive')}</option>
+                          <option value="FILE">${_('file')}</option>
+                        </select>
+                      </div>
 
-                    <div data-bind="css: {'error': $root.getFileResourcePathErrors($index()).length > 0}" class="control-group">
-                      <label>${_('Path')}</label>
-                      <input data-bind="value: path" type="text" class="filesField span7 fileChooser" placeholder="/user/foo/udf.jar"/>
+                      <div data-bind="css: {'error': $root.getFileResourcePathErrors($index()).length > 0}" class="control-group">
+                        <label>${_('Path')}</label>
+                        <input data-bind="value: path" type="text" class="filesField span7 fileChooser" placeholder="/user/foo/udf.jar"/>
+                      </div>
                     </div>
-                  </div>
-                  <!-- /ko -->
-
-                  <div class="control-group">
-                    <a data-bind="click: function() { $root.addFileResource('','') }" class="btn btn-mini paramAdd">${_('Add')}</a>
-                  </div>
-                </li>
-                <li title="${ _('User-Defined Functions') }" class="nav-header
-                  % if app_name == 'impala':
-                    hide
-                  % endif
-                  ">
-                  ${_('UDFs')}
-                </li>
-                <li class="white paramContainer
-                  % if app_name == 'impala':
-                    hide
-                  % endif
-                  ">
-                  <!-- ko foreach: design.functions.values -->
-                  <div class="param">
-                    <div class="remove">
-                      <button data-bind="click: $root.removeFunction.bind(this, $index())" type="button" class="btn btn-mini settingsDelete" title="${_('Delete this setting')}">&times;</button>
+                    <!-- /ko -->
+
+                    <div class="control-group">
+                      <a data-bind="click: function() { $root.addFileResource('','') }" class="btn btn-mini paramAdd">${_('Add')}</a>
                     </div>
-                    <div data-bind="css: {'error': $root.getFunctionNameErrors($index()).length > 0}" class="control-group">
-                      <label>${_('Name')}</label>
-                      <input data-bind="value: name" type="text" class="functionsField span8" autocomplete="off" placeholder="myFunction"/>
+                  </li>
+                  <li title="${ _('User-Defined Functions') }" class="nav-header
+                    % if app_name == 'impala':
+                      hide
+                    % endif
+                    ">
+                    ${_('UDFs')}
+                  </li>
+                  <li class="white paramContainer
+                    % if app_name == 'impala':
+                      hide
+                    % endif
+                    ">
+                    <!-- ko foreach: design.functions.values -->
+                    <div class="param">
+                      <div class="remove">
+                        <button data-bind="click: $root.removeFunction.bind(this, $index())" type="button" class="btn btn-mini settingsDelete" title="${_('Delete this setting')}">&times;</button>
+                      </div>
+                      <div data-bind="css: {'error': $root.getFunctionNameErrors($index()).length > 0}" class="control-group">
+                        <label>${_('Name')}</label>
+                        <input data-bind="value: name" type="text" class="functionsField span8" autocomplete="off" placeholder="myFunction"/>
+                      </div>
+
+                      <div data-bind="css: {'error': $root.getFunctionClassNameErrors($index()).length > 0}" class="control-group">
+                        <label>${_('Class name')}</label>
+                        <input data-bind="value: class_name" type="text" class="classNamesField span8" placeholder="com.acme.example"/>
+                      </div>
                     </div>
+                    <!-- /ko -->
 
-                    <div data-bind="css: {'error': $root.getFunctionClassNameErrors($index()).length > 0}" class="control-group">
-                      <label>${_('Class name')}</label>
-                      <input data-bind="value: class_name" type="text" class="classNamesField span8" placeholder="com.acme.example"/>
+                    <div class="control-group">
+                      <a data-bind="click: function() { $root.addFunction('','') }" class="btn btn-mini paramAdd">${_('Add')}</a>
                     </div>
-                  </div>
-                  <!-- /ko -->
-
-                  <div class="control-group">
-                    <a data-bind="click: function() { $root.addFunction('','') }" class="btn btn-mini paramAdd">${_('Add')}</a>
-                  </div>
-                </li>
-                <li class="nav-header">${_('Options')}</li>
-                <li class="white" style="padding-top:0; padding-left:0">
-                  <label class="checkbox" rel="tooltip" data-original-title="${_("If checked (the default), you can include parameters like $parameter_name in your query, and users will be prompted for a value when the query is run.")}">
-                    <input data-bind="checked: design.isParameterized" type="checkbox"/>
-                    ${_("Enable parameterization")}
-                  </label>
-                </li>
-                % if app_name == 'impala':
-                  <li class="nav-header">
-                    ${_('Metastore Catalog')}
                   </li>
+                  <li class="nav-header">${_('Options')}</li>
                   <li class="white" style="padding-top:0; padding-left:0">
-                    <div class="control-group">
-                      <span id="refresh-dyk">
-                        <i class="fa fa-refresh"></i>
-                        ${ _('Sync tables tips') }
-                      </span>
-
-                      <div id="refresh-content" class="hide">
-                        <ul style="text-align: left;">
-                          <li>"invalidate
-                            metadata" ${ _("invalidates the entire catalog metadata. All table metadata will be reloaded on the next access.") }</li>
-                          <li>"invalidate metadata
-                            &lt;table&gt;" ${ _("invalidates the metadata, load on the next access") }</li>
-                          <li>"refresh
-                            &lt;table&gt;" ${ _("refreshes the metadata immediately. It is a faster, incremental refresh.") }</li>
-                        </ul>
-                      </div>
-                    </div>
+                    <label class="checkbox" rel="tooltip" data-original-title="${_("If checked (the default), you can include parameters like $parameter_name in your query, and users will be prompted for a value when the query is run.")}">
+                      <input data-bind="checked: design.isParameterized" type="checkbox"/>
+                      ${_("Enable parameterization")}
+                    </label>
                   </li>
-                % endif
-              </ul>
-          </form>
+                  % if app_name == 'impala':
+                    <li class="nav-header">
+                      ${_('Metastore Catalog')}
+                    </li>
+                    <li class="white" style="padding-top:0; padding-left:0">
+                      <div class="control-group">
+                        <span id="refresh-dyk">
+                          <i class="fa fa-refresh"></i>
+                          ${ _('Sync tables tips') }
+                        </span>
+
+                        <div id="refresh-content" class="hide">
+                          <ul style="text-align: left;">
+                            <li>"invalidate
+                              metadata" ${ _("invalidates the entire catalog metadata. All table metadata will be reloaded on the next access.") }</li>
+                            <li>"invalidate metadata
+                              &lt;table&gt;" ${ _("invalidates the metadata, load on the next access") }</li>
+                            <li>"refresh
+                              &lt;table&gt;" ${ _("refreshes the metadata immediately. It is a faster, incremental refresh.") }</li>
+                          </ul>
+                        </div>
+                      </div>
+                    </li>
+                  % endif
+                </ul>
+            </form>
+            </div>
           </div>
         </div>
       </div>
     </div>
   </div>
-</div>
 
-<div id="querySide" class="span10">
-  <div id="queryContainer" class="card card-small">
-    <div class="pull-right" style="margin: 10px">
-      <i class="fa fa-question-circle" id="help"></i>
-      <div id="help-content" class="hide">
-        <ul style="text-align: left;">
-          <li>${ _('Press CTRL + Space to autocomplete') }</li>
-          <li>${ _("You can execute queries with multiple SQL statements delimited by a semicolon ';'") }</li>
-          <li>${ _('You can highlight and run a fragment of a query') }</li>
-        </ul>
+  <div id="querySide" class="span10">
+    <div id="queryContainer" class="card card-small">
+      <div class="pull-right" style="margin: 10px">
+        <i class="fa fa-question-circle" id="help"></i>
+        <div id="help-content" class="hide">
+          <ul style="text-align: left;">
+            <li>${ _('Press CTRL + Space to autocomplete') }</li>
+            <li>${ _("You can execute queries with multiple SQL statements delimited by a semicolon ';'") }</li>
+            <li>${ _('You can highlight and run a fragment of a query') }</li>
+          </ul>
+        </div>
       </div>
-    </div>
-    <div style="margin-bottom: 30px">
-        % if can_edit_name:
-        <h1 class="card-heading simple">
-          <a href="javascript:void(0);"
-             id="query-name"
-             data-type="text"
-             data-name="name"
-             data-value="${design.name}"
-             data-original-title="${ _('Query name') }"
-             data-placement="right">
-          </a>
-          <a href="javascript:void(0);"
-             id="query-description"
-             data-type="textarea"
-             data-name="description"
-             data-value="${design.desc}"
-             data-original-title="${ _('Query description') }"
-             data-placement="right" style="font-size: 14px; margin-left: 10px">
-          </a>
-        </h1>
-        %endif
-    </div>
-    <div class="card-body">
-      <div class="tab-content">
-        <div id="queryPane">
-
-          <div data-bind="css: {'hide': design.errors().length == 0}" class="alert alert-error">
-            <!-- ko if: $root.getQueryErrors().length > 0 -->
-            <p><strong>${_('Please provide a query')}</strong></p>
-            <!-- /ko -->
-            <!-- ko if: $root.getQueryErrors().length == 0 -->
-            <p><strong>${_('Your query has the following error(s):')}</strong></p>
-
-            <div data-bind="foreach: design.errors">
-              <p data-bind="text: $data" class="queryErrorMessage"></p>
+      <div style="margin-bottom: 30px">
+          % if can_edit_name:
+          <h1 class="card-heading simple">
+            <a class="share-link" rel="tooltip" data-placement="bottom" style="padding-left:10px; padding-right: 10px" data-bind="click: openShareModal,
+              attr: {'data-original-title': '${ _("Share") } '+name},
+              css: {'baseShared': true, 'isShared': isShared()}">
+              <i class="fa fa-users"></i>
+            </a>
+            <a href="javascript:void(0);"
+               id="query-name"
+               data-type="text"
+               data-name="name"
+               data-value="${design.name}"
+               data-original-title="${ _('Query name') }"
+               data-placement="right">
+            </a>
+            <a href="javascript:void(0);"
+               id="query-description"
+               data-type="textarea"
+               data-name="description"
+               data-value="${design.desc}"
+               data-original-title="${ _('Query description') }"
+               data-placement="right" style="font-size: 14px; margin-left: 10px">
+            </a>
+          </h1>
+          %endif
+      </div>
+      <div class="card-body">
+        <div class="tab-content">
+          <div id="queryPane">
+
+            <div data-bind="css: {'hide': design.errors().length == 0}" class="alert alert-error">
+              <!-- ko if: $root.getQueryErrors().length > 0 -->
+              <p><strong>${_('Please provide a query')}</strong></p>
+              <!-- /ko -->
+              <!-- ko if: $root.getQueryErrors().length == 0 -->
+              <p><strong>${_('Your query has the following error(s):')}</strong></p>
+
+              <div data-bind="foreach: design.errors">
+                <p data-bind="text: $data" class="queryErrorMessage"></p>
+              </div>
+              <!-- /ko -->
             </div>
-            <!-- /ko -->
-          </div>
 
-          <div data-bind="css: {'hide': design.watch.errors().length == 0}" class="alert alert-error">
-            <p><strong>${_('Your query has the following error(s):')}</strong></p>
+            <div data-bind="css: {'hide': design.watch.errors().length == 0}" class="alert alert-error">
+              <p><strong>${_('Your query has the following error(s):')}</strong></p>
 
-            <div data-bind="foreach: design.watch.errors">
-              <p data-bind="text: $data" class="queryErrorMessage"></p>
+              <div data-bind="foreach: design.watch.errors">
+                <p data-bind="text: $data" class="queryErrorMessage"></p>
+              </div>
             </div>
-          </div>
 
-          <textarea class="hide" tabindex="1" name="query" id="queryField"></textarea>
+            <textarea class="hide" tabindex="1" name="query" id="queryField"></textarea>
 
-          <div class="actions">
-            <button data-bind="click: tryExecuteQuery, visible: $root.canExecute, enable: $root.queryEditorBlank" type="button" id="executeQuery" class="btn btn-primary disable-feedback" tabindex="2">${_('Execute')}</button>
-            <button data-bind="click: tryCancelQuery, visible: $root.design.isRunning()" class="btn btn-danger" data-loading-text="${ _('Canceling...') }" rel="tooltip" data-original-title="${ _('Cancel the query') }">${ _('Cancel') }</button>
+            <div class="actions">
+              <button data-bind="click: tryExecuteQuery, visible: $root.canExecute, enable: $root.queryEditorBlank" type="button" id="executeQuery" class="btn btn-primary disable-feedback" tabindex="2">${_('Execute')}</button>
+              <button data-bind="click: tryCancelQuery, visible: $root.design.isRunning()" class="btn btn-danger" data-loading-text="${ _('Canceling...') }" rel="tooltip" data-original-title="${ _('Cancel the query') }">${ _('Cancel') }</button>
 
-            <button data-bind="click: tryExecuteNextStatement, visible: !$root.design.isFinished()" type="button" class="btn btn-primary disable-feedback" tabindex="2">${_('Next')}</button>
-            <button data-bind="click: tryExecuteQuery, visible: !$root.design.isFinished()" type="button" id="executeQuery" class="btn btn-primary disable-feedback" tabindex="2">${_('Restart')}</button>
+              <button data-bind="click: tryExecuteNextStatement, visible: !$root.design.isFinished()" type="button" class="btn btn-primary disable-feedback" tabindex="2">${_('Next')}</button>
+              <button data-bind="click: tryExecuteQuery, visible: !$root.design.isFinished()" type="button" id="executeQuery" class="btn btn-primary disable-feedback" tabindex="2">${_('Restart')}</button>
 
-            % if can_edit:
-            <button data-bind="click: trySaveDesign, css: {'hide': !$root.design.id() || $root.design.id() == -1}" type="button" class="btn hide">${_('Save')}</button>
-            % endif
-            <button data-bind="click: saveAsModal" type="button" class="btn">${_('Save as...')}</button>
-            <button data-bind="click: tryShareQuery, css: {'hide': !$root.design.id() || $root.design.id() == -1}"
-               type="button" id="shareQuery" class="btn" tabindex="2">${_('Share')}</button>
-            <button data-bind="click: tryExplainQuery, visible: $root.canExecute" type="button" id="explainQuery" class="btn">${_('Explain')}</button>
-            &nbsp; ${_('or create a')} &nbsp;
-            <button data-bind="click: createNewQuery" type="button" class="btn">${_('New query')}</button>
-            <br/><br/>
-          </div>
+              % if can_edit:
+              <button data-bind="click: trySaveDesign, css: {'hide': !$root.design.id() || $root.design.id() == -1}" type="button" class="btn hide">${_('Save')}</button>
+              % endif
+              <button data-bind="click: saveAsModal" type="button" class="btn">${_('Save as...')}</button>
+              <button data-bind="click: tryExplainQuery, visible: $root.canExecute" type="button" id="explainQuery" class="btn">${_('Explain')}</button>
+              &nbsp; ${_('or create a')} &nbsp;
+              <button data-bind="click: createNewQuery" type="button" class="btn">${_('New query')}</button>
+              <br/><br/>
+            </div>
 
+          </div>
         </div>
       </div>
     </div>
-  </div>
 
-  <div id="resizePanel"><a href="javascript:void(0)"><i class="fa fa-ellipsis-h"></i></a></div>
+    <div id="resizePanel"><a href="javascript:void(0)"><i class="fa fa-ellipsis-h"></i></a></div>
 
-  <div class="card card-small scrollable resultsContainer">
-    <div data-bind="visible: !design.explain() && $root.hasResults()">
-      <a id="expandResults" href="javascript:void(0)" title="${_('See results in full screen')}" rel="tooltip"
-        class="view-query-results hide pull-right"><h4 style="margin-right: 20px"><i class="fa fa-expand"></i></h4></a>
+    <div class="card card-small scrollable resultsContainer">
+      <div data-bind="visible: !design.explain() && $root.hasResults()">
+        <a id="expandResults" href="javascript:void(0)" title="${_('See results in full screen')}" rel="tooltip"
+          class="view-query-results hide pull-right"><h4 style="margin-right: 20px"><i class="fa fa-expand"></i></h4></a>
 
-      <a id="save-results" data-bind="click: saveResultsModal" href="javascript:void(0)" title="${_('Save the results to HDFS or a new Hive table')}" rel="tooltip"
-        class="view-query-results hide pull-right"><h4 style="margin-right: 20px"><i class="fa fa-save"></i></h4>
-      </a>
+        <a id="save-results" data-bind="click: saveResultsModal" href="javascript:void(0)" title="${_('Save the results to HDFS or a new Hive table')}" rel="tooltip"
+          class="view-query-results hide pull-right"><h4 style="margin-right: 20px"><i class="fa fa-save"></i></h4>
+        </a>
 
-      <a id="download-csv" data-bind="attr: {'href': '/${ app_name }/download/' + $root.design.history.id() + '/csv'}" href="javascript:void(0)" title="${_('Download the results in CSV format')}" rel="tooltip"
-        class="view-query-results download hide pull-right"><h4 style="margin-right: 20px"><i class="hfo hfo-file-csv"></i></h4>
-      </a>
+        <a id="download-csv" data-bind="attr: {'href': '/${ app_name }/download/' + $root.design.history.id() + '/csv'}" href="javascript:void(0)" title="${_('Download the results in CSV format')}" rel="tooltip"
+          class="view-query-results download hide pull-right"><h4 style="margin-right: 20px"><i class="hfo hfo-file-csv"></i></h4>
+        </a>
 
-      <a id="download-excel" data-bind="attr: {'href': '/${ app_name }/download/' + $root.design.history.id() + '/xls'}" href="javascript:void(0)" title="${_('Download the results in XLS format')}" rel="tooltip"
-        class="view-query-results download hide pull-right"><h4 style="margin-right: 20px"><i class="hfo hfo-file-xls"></i></h4></a>
-    </div>
-
-    <div class="card-body">
-      <ul class="nav nav-tabs">
-        <li class="active recentLi"><a href="#recentTab" data-toggle="tab">${_('Recent queries')}</a></li>
-        <li><a href="#query" data-toggle="tab">${_('Query')}</a></li>
-        <!-- ko if: !design.explain() -->
-        <li><a href="#log" data-toggle="tab">${_('Log')}</a></li>
-        <!-- /ko -->
-        <!-- ko if: !design.explain() -->
-        <li><a href="#columns" data-toggle="tab">${_('Columns')}</a></li>
-        <li><a href="#results" data-toggle="tab">${_('Results')}</a></li>
-        <li><a href="#chart" data-toggle="tab">${_('Chart')}</a></li>
-        <!-- /ko -->
-        <!-- ko if: design.explain() && !design.isRunning() -->
-        <li><a href="#explanation" data-toggle="tab">${_('Explanation')}</a></li>
-        <!-- /ko -->
-      </ul>
-
-      <div class="tab-content">
-        <div class="active tab-pane" id="recentTab">
-          <div id="recentLoader">
-            <!--[if !IE]><!--><i class="fa fa-spinner fa-spin" style="font-size: 20px; color: #DDD"></i><!--<![endif]-->
-            <!--[if IE]><img src="/static/art/spinner.gif"/><![endif]-->
-          </div>
-          <table id="recentQueries" class="table table-striped table-condensed datatables" cellpadding="0" cellspacing="0" data-tablescroller-enforce-height="true">
-            <thead>
-              <tr>
-                <th>${_('Time')}</th>
-                <th>${_('Query')}</th>
-                <th>${_('Result')}</th>
-                <th>&nbsp;</th>
-              </tr>
-            </thead>
-            <tbody>
-            </tbody>
-          </table>
-        </div>
-        <div class="tab-pane" id="query">
-          <pre data-bind="visible: viewModel.design.statement() == ''">${_('There is currently no query to visualize.')}</pre>
-          <pre data-bind="visible: viewModel.design.statement() != '', text: viewModel.design.statement()"></pre>
-        </div>
+        <a id="download-excel" data-bind="attr: {'href': '/${ app_name }/download/' + $root.design.history.id() + '/xls'}" href="javascript:void(0)" title="${_('Download the results in XLS format')}" rel="tooltip"
+          class="view-query-results download hide pull-right"><h4 style="margin-right: 20px"><i class="hfo hfo-file-xls"></i></h4></a>
+      </div>
 
-        <!-- ko if: design.explain() -->
-        <div class="tab-pane" id="explanation">
-          <pre data-bind="text: $root.design.results.explanation()"></pre>
-        </div>
-        <!-- /ko -->
+      <div class="card-body">
+        <ul class="nav nav-tabs">
+          <li class="active recentLi"><a href="#recentTab" data-toggle="tab">${_('Recent queries')}</a></li>
+          <li><a href="#query" data-toggle="tab">${_('Query')}</a></li>
+          <!-- ko if: !design.explain() -->
+          <li><a href="#log" data-toggle="tab">${_('Log')}</a></li>
+          <!-- /ko -->
+          <!-- ko if: !design.explain() -->
+          <li><a href="#columns" data-toggle="tab">${_('Columns')}</a></li>
+          <li><a href="#results" data-toggle="tab">${_('Results')}</a></li>
+          <li><a href="#chart" data-toggle="tab">${_('Chart')}</a></li>
+          <!-- /ko -->
+          <!-- ko if: design.explain() && !design.isRunning() -->
+          <li><a href="#explanation" data-toggle="tab">${_('Explanation')}</a></li>
+          <!-- /ko -->
+        </ul>
 
-        <!-- ko if: !design.explain() -->
-        <div class="tab-pane" id="log">
-          <div style="position:relative">
-            <ul data-bind="foreach: $root.design.watch.jobUrls" class="unstyled jobs-overlay">
-              <li><a data-bind="text: $.trim($data.name), attr: { href: $data.url }" target="_blank"></a></li>
-            </ul>
-            <pre data-bind="visible: $root.design.watch.logs().length == 0">${_('There are currently no logs to visualize.')} <img src="/static/art/spinner.gif" data-bind="visible: $root.design.isRunning()"/></pre>
-            <pre data-bind="visible: $root.design.watch.logs().length > 0, text: $root.design.watch.logs().join('\n')"></pre>
+        <div class="tab-content">
+          <div class="active tab-pane" id="recentTab">
+            <div id="recentLoader">
+              <!--[if !IE]><!--><i class="fa fa-spinner fa-spin" style="font-size: 20px; color: #DDD"></i><!--<![endif]-->
+              <!--[if IE]><img src="/static/art/spinner.gif"/><![endif]-->
+            </div>
+            <table id="recentQueries" class="table table-striped table-condensed datatables" cellpadding="0" cellspacing="0" data-tablescroller-enforce-height="true">
+              <thead>
+                <tr>
+                  <th>${_('Time')}</th>
+                  <th>${_('Query')}</th>
+                  <th>${_('Result')}</th>
+                  <th>&nbsp;</th>
+                </tr>
+              </thead>
+              <tbody>
+              </tbody>
+            </table>
           </div>
-        </div>
-
-        <div class="tab-pane" id="columns">
-          <pre data-bind="visible: $root.design.results.columns().length == 0">${_('There are currently no columns to visualize.')}</pre>
-          <div data-bind="visible: $root.design.results.columns().length > 10">
-            <input id="columnFilter" class="input-xlarge" type="text" placeholder="${_('Filter for column name or type...')}" />
+          <div class="tab-pane" id="query">
+            <pre data-bind="visible: viewModel.design.statement() == ''">${_('There is currently no query to visualize.')}</pre>
+            <pre data-bind="visible: viewModel.design.statement() != '', text: viewModel.design.statement()"></pre>
           </div>
-          <table class="table table-striped table-condensed" cellpadding="0" cellspacing="0">
-            <tbody data-bind="foreach: $root.design.results.columns">
-              <tr class="columnRow" data-bind="visible: $index() > 0">
-                <td rel="columntooltip" data-placement="left" data-bind="attr: {title: '${ _("Scroll to the column") }">
-                  <a href="javascript:void(0)" data-row-selector="true" class="column-selector" data-bind="text: $data.name"></a>
-                </td>
-                <td class="columnType" data-bind="text: $.trim($data.type)"></td>
-              </tr>
-            </tbody>
-          </table>
-        </div>
 
-        <div class="tab-pane" id="results">
-          <div data-bind="css: {'hide': design.results.errors().length == 0}" class="alert alert-error">
-            <p><strong>${_('Fetching results ran into the following error(s):')}</strong></p>
+          <!-- ko if: design.explain() -->
+          <div class="tab-pane" id="explanation">
+            <pre data-bind="text: $root.design.results.explanation()"></pre>
+          </div>
+          <!-- /ko -->
 
-            <div data-bind="foreach: design.results.errors">
-              <p data-bind="text: $data" class="queryErrorMessage"></p>
+          <!-- ko if: !design.explain() -->
+          <div class="tab-pane" id="log">
+            <div style="position:relative">
+              <ul data-bind="foreach: $root.design.watch.jobUrls" class="unstyled jobs-overlay">
+                <li><a data-bind="text: $.trim($data.name), attr: { href: $data.url }" target="_blank"></a></li>
+              </ul>
+              <pre data-bind="visible: $root.design.watch.logs().length == 0">${_('There are currently no logs to visualize.')} <img src="/static/art/spinner.gif" data-bind="visible: $root.design.isRunning()"/></pre>
+              <pre data-bind="visible: $root.design.watch.logs().length > 0, text: $root.design.watch.logs().join('\n')"></pre>
             </div>
           </div>
 
-          <div data-bind="css: {'hide': !$root.hasResults()}">
-            <table id="resultTable" class="table table-striped table-condensed" cellpadding="0" cellspacing="0" data-tablescroller-enforce-height="true">
-              <thead>
-              <tr data-bind="foreach: $root.design.results.columns">
-                <th data-bind="html: ($index() == 0 ? '&nbsp;' : $data.name), css: { 'sort-numeric': isNumericColumn($data.type), 'sort-date': isDateTimeColumn($data.type), 'sort-string': isStringColumn($data.type)}"></th>
-              </tr>
-              </thead>
+          <div class="tab-pane" id="columns">
+            <pre data-bind="visible: $root.design.results.columns().length == 0">${_('There are currently no columns to visualize.')}</pre>
+            <div data-bind="visible: $root.design.results.columns().length > 10">
+              <input id="columnFilter" class="input-xlarge" type="text" placeholder="${_('Filter for column name or type...')}" />
+            </div>
+            <table class="table table-striped table-condensed" cellpadding="0" cellspacing="0">
+              <tbody data-bind="foreach: $root.design.results.columns">
+                <tr class="columnRow" data-bind="visible: $index() > 0">
+                  <td rel="columntooltip" data-placement="left" data-bind="attr: {title: '${ _("Scroll to the column") }">
+                    <a href="javascript:void(0)" data-row-selector="true" class="column-selector" data-bind="text: $data.name"></a>
+                  </td>
+                  <td class="columnType" data-bind="text: $.trim($data.type)"></td>
+                </tr>
+              </tbody>
             </table>
           </div>
 
-          <div data-bind="css: {'hide': !$root.design.results.empty() || $root.design.results.expired()}" id="resultEmpty">
-            <pre>${_('The operation has no results.')}</pre>
-          </div>
+          <div class="tab-pane" id="results">
+            <div data-bind="css: {'hide': design.results.errors().length == 0}" class="alert alert-error">
+              <p><strong>${_('Fetching results ran into the following error(s):')}</strong></p>
 
-          <div data-bind="css: {'hide': !$root.design.results.expired()}" id="resultExpired">
-            <pre>${_('The results have expired, rerun the query if needed.')}</pre>
-          </div>
-        </div>
+              <div data-bind="foreach: design.results.errors">
+                <p data-bind="text: $data" class="queryErrorMessage"></p>
+              </div>
+            </div>
+
+            <div data-bind="css: {'hide': !$root.hasResults()}">
+              <table id="resultTable" class="table table-striped table-condensed" cellpadding="0" cellspacing="0" data-tablescroller-enforce-height="true">
+                <thead>
+                <tr data-bind="foreach: $root.design.results.columns">
+                  <th data-bind="html: ($index() == 0 ? '&nbsp;' : $data.name), css: { 'sort-numeric': isNumericColumn($data.type), 'sort-date': isDateTimeColumn($data.type), 'sort-string': isStringColumn($data.type)}"></th>
+                </tr>
+                </thead>
+              </table>
+            </div>
 
-        <div class="tab-pane" id="chart">
-          <pre data-bind="visible: $root.design.results.empty() || $root.design.results.expired()">${_('There is currently no data to build a chart on.')}</pre>
-          <div class="alert hide">
-            <strong>${_('Warning:')}</strong> ${_('the results on the chart have been limited to 1000 rows.')}
+            <div data-bind="css: {'hide': !$root.design.results.empty() || $root.design.results.expired()}" id="resultEmpty">
+              <pre>${_('The operation has no results.')}</pre>
+            </div>
+
+            <div data-bind="css: {'hide': !$root.design.results.expired()}" id="resultExpired">
+              <pre>${_('The results have expired, rerun the query if needed.')}</pre>
+            </div>
           </div>
 
-          <div data-bind="visible: ! $root.design.results.empty() && ! $root.design.results.expired()" style="text-align: center">
-          <form class="form-inline">
-            ${_('Chart type')}&nbsp;
-            <div class="btn-group" data-toggle="buttons-radio">
-              <a rel="tooltip" data-placement="top" title="${_('Bars')}" id="blueprintBars" href="javascript:void(0)" class="btn"><i class="hcha hcha-bar-chart"></i></a>
-              <a rel="tooltip" data-placement="top" title="${_('Lines')}" id="blueprintLines" href="javascript:void(0)" class="btn"><i class="hcha hcha-line-chart"></i></a>
-              <a rel="tooltip" data-placement="top" title="${_('Pie')}" id="blueprintPie" href="javascript:void(0)" class="btn"><i class="hcha hcha-pie-chart"></i></a>
-              <a rel="tooltip" data-placement="top" title="${_('Map')}" id="blueprintMap" href="javascript:void(0)" class="btn"><i class="hcha hcha-map-chart"></i></a>
-            </div>&nbsp;&nbsp;
-            <span id="blueprintAxis" class="hide">
-              <label>${_('X-Axis')}
-                <select id="blueprintX" class="blueprintSelect"></select>
-              </label>&nbsp;&nbsp;
-              <label>${_('Y-Axis')}
-              <select id="blueprintY" class="blueprintSelect"></select>
-              </label>&nbsp;
+          <div class="tab-pane" id="chart">
+            <pre data-bind="visible: $root.design.results.empty() || $root.design.results.expired()">${_('There is currently no data to build a chart on.')}</pre>
+            <div class="alert hide">
+              <strong>${_('Warning:')}</strong> ${_('the results on the chart have been limited to 1000 rows.')}
+            </div>
+
+            <div data-bind="visible: ! $root.design.results.empty() && ! $root.design.results.expired()" style="text-align: center">
+            <form class="form-inline">
+              ${_('Chart type')}&nbsp;
               <div class="btn-group" data-toggle="buttons-radio">
-                <a rel="tooltip" data-placement="top" title="${_('No sorting')}" id="blueprintNoSort" href="javascript:void(0)" class="btn active"><i class="fa fa-align-left fa-rotate-270"></i></a>
-                <a rel="tooltip" data-placement="top" title="${_('Sort ascending')}" id="blueprintSortAsc" href="javascript:void(0)" class="btn"><i class="fa fa-sort-amount-asc fa-rotate-270"></i></a>
-                <a rel="tooltip" data-placement="top" title="${_('Sort descending')}" id="blueprintSortDesc" href="javascript:void(0)" class="btn"><i class="fa fa-sort-amount-desc fa-rotate-270"></i></a>
+                <a rel="tooltip" data-placement="top" title="${_('Bars')}" id="blueprintBars" href="javascript:void(0)" class="btn"><i class="hcha hcha-bar-chart"></i></a>
+                <a rel="tooltip" data-placement="top" title="${_('Lines')}" id="blueprintLines" href="javascript:void(0)" class="btn"><i class="hcha hcha-line-chart"></i></a>
+                <a rel="tooltip" data-placement="top" title="${_('Pie')}" id="blueprintPie" href="javascript:void(0)" class="btn"><i class="hcha hcha-pie-chart"></i></a>
+                <a rel="tooltip" data-placement="top" title="${_('Map')}" id="blueprintMap" href="javascript:void(0)" class="btn"><i class="hcha hcha-map-chart"></i></a>
               </div>&nbsp;&nbsp;
-            </span>
-            <span id="blueprintLatLng" class="hide">
-              <label>${_('Latitude')}
-                <select id="blueprintLat" class="blueprintSelect"></select>
-              </label>&nbsp;&nbsp;
-              <label>${_('Longitude')}
-              <select id="blueprintLng" class="blueprintSelect"></select>
-              </label>&nbsp;&nbsp;
-              <label>${_('Label')}
-              <select id="blueprintDesc" class="blueprintSelect"></select>
-              </label>
-            </span>
-          </form>
-          </div>
-          <div data-bind="visible: ! $root.design.results.empty() && ! $root.design.results.expired()" id="blueprint" class="empty center">${_("Please select a chart type.")}</div>
-          <div style="margin: 10px" data-bind="visible: ! $root.design.results.empty() && ! $root.design.results.expired()">
-            <div id="pieChart" data-bind="pieChart: {data: {counts: $root.chartData}, fqs: ko.observableArray([]),
-              transformer: pieChartDataTransformer,
-              maxWidth: 350 }, visible: $root.chartType() == 'pie'"></div>
-
-            <div id="barChart" data-bind="barChart: {datum: {counts: $root.chartData}, fqs: ko.observableArray([]), hideSelection: true,
-                  transformer: barChartDataTransformer}, visible: $root.chartType() == 'bars'"></div>
-
-            <div id="lineChart" data-bind="lineChart: {datum: {counts: $root.chartData},
-                  transformer: lineChartDataTransformer,
-                  showControls: false }, visible: $root.chartType() == 'lines'"></div>
-
-            <div id="leafletMapChart" data-bind="leafletMapChart: {datum: {counts: $root.chartData},
-                  transformer: leafletMapChartDataTransformer,
-                  showControls: false }, visible: $root.chartType() == 'map'"></div>
+              <span id="blueprintAxis" class="hide">
+                <label>${_('X-Axis')}
+                  <select id="blueprintX" class="blueprintSelect"></select>
+                </label>&nbsp;&nbsp;
+                <label>${_('Y-Axis')}
+                <select id="blueprintY" class="blueprintSelect"></select>
+                </label>&nbsp;
+                <div class="btn-group" data-toggle="buttons-radio">
+                  <a rel="tooltip" data-placement="top" title="${_('No sorting')}" id="blueprintNoSort" href="javascript:void(0)" class="btn active"><i class="fa fa-align-left fa-rotate-270"></i></a>
+                  <a rel="tooltip" data-placement="top" title="${_('Sort ascending')}" id="blueprintSortAsc" href="javascript:void(0)" class="btn"><i class="fa fa-sort-amount-asc fa-rotate-270"></i></a>
+                  <a rel="tooltip" data-placement="top" title="${_('Sort descending')}" id="blueprintSortDesc" href="javascript:void(0)" class="btn"><i class="fa fa-sort-amount-desc fa-rotate-270"></i></a>
+                </div>&nbsp;&nbsp;
+              </span>
+              <span id="blueprintLatLng" class="hide">
+                <label>${_('Latitude')}
+                  <select id="blueprintLat" class="blueprintSelect"></select>
+                </label>&nbsp;&nbsp;
+                <label>${_('Longitude')}
+                <select id="blueprintLng" class="blueprintSelect"></select>
+                </label>&nbsp;&nbsp;
+                <label>${_('Label')}
+                <select id="blueprintDesc" class="blueprintSelect"></select>
+                </label>
+              </span>
+            </form>
+            </div>
+            <div data-bind="visible: ! $root.design.results.empty() && ! $root.design.results.expired()" id="blueprint" class="empty center">${_("Please select a chart type.")}</div>
+            <div style="margin: 10px" data-bind="visible: ! $root.design.results.empty() && ! $root.design.results.expired()">
+              <div id="pieChart" data-bind="pieChart: {data: {counts: $root.chartData}, fqs: ko.observableArray([]),
+                transformer: pieChartDataTransformer,
+                maxWidth: 350 }, visible: $root.chartType() == 'pie'"></div>
+
+              <div id="barChart" data-bind="barChart: {datum: {counts: $root.chartData}, fqs: ko.observableArray([]), hideSelection: true,
+                    transformer: barChartDataTransformer}, visible: $root.chartType() == 'bars'"></div>
+
+              <div id="lineChart" data-bind="lineChart: {datum: {counts: $root.chartData},
+                    transformer: lineChartDataTransformer,
+                    showControls: false }, visible: $root.chartType() == 'lines'"></div>
+
+              <div id="leafletMapChart" data-bind="leafletMapChart: {datum: {counts: $root.chartData},
+                    transformer: leafletMapChartDataTransformer,
+                    showControls: false }, visible: $root.chartType() == 'map'"></div>
+            </div>
           </div>
+          <!-- /ko -->
         </div>
-        <!-- /ko -->
       </div>
     </div>
   </div>
-</div>
 
 
-</div>
-</div>
+  </div>
+  </div>
 
 
-<div id="execute-parameter-selection" class="container-fluid hide section">
-  <div class="row-fluid">
-    <div class="card card-small">
-      <h1 class="card-heading simple">${_('Please specify parameters for this query')}</h1>
-      <div class="card-body">
-        <p>
-        <form method="POST" action="" class="form-horizontal">
-          ${ csrf_token(request) | n,unicode }
-          <fieldset>
-            <!-- ko foreach: $root.design.parameters -->
-            <div class="control-group">
-              <label data-bind="text: name" class="control-label"></label>
-              <div class="controls">
-                <input data-bind="value: value, valueUpdate:'afterkeydown'" type="text"/>
+  <div id="execute-parameter-selection" class="container-fluid hide section">
+    <div class="row-fluid">
+      <div class="card card-small">
+        <h1 class="card-heading simple">${_('Please specify parameters for this query')}</h1>
+        <div class="card-body">
+          <p>
+          <form method="POST" action="" class="form-horizontal">
+            ${ csrf_token(request) | n,unicode }
+            <fieldset>
+              <!-- ko foreach: $root.design.parameters -->
+              <div class="control-group">
+                <label data-bind="text: name" class="control-label"></label>
+                <div class="controls">
+                  <input data-bind="value: value, valueUpdate:'afterkeydown'" type="text"/>
+                </div>
               </div>
-            </div>
-            <!-- /ko -->
-            <div class="form-actions" style="padding-left: 10px">
-              <a class="btn" href="javascript:history.go(-1);">${_('Cancel')}</a>
-              <button data-bind="enable: $root.hasParametersFilled, click: tryExecuteParameterizedQuery" type="button" class="btn btn-primary">${_('Execute query')}</button>
-            </div>
-          </fieldset>
-        </form>
-        </p>
+              <!-- /ko -->
+              <div class="form-actions" style="padding-left: 10px">
+                <a class="btn" href="javascript:history.go(-1);">${_('Cancel')}</a>
+                <button data-bind="enable: $root.hasParametersFilled, click: tryExecuteParameterizedQuery" type="button" class="btn btn-primary">${_('Execute query')}</button>
+              </div>
+            </fieldset>
+          </form>
+          </p>
+        </div>
       </div>
     </div>
   </div>
-</div>
 
 
-<div id="explain-parameter-selection" class="container-fluid hide section">
-  <div class="row-fluid">
-    <div class="card card-small">
-      <h1 class="card-heading simple">${_('Please specify parameters for this query')}</h1>
-
-      <div class="card-body">
-        <p>
+  <div id="explain-parameter-selection" class="container-fluid hide section">
+    <div class="row-fluid">
+      <div class="card card-small">
+        <h1 class="card-heading simple">${_('Please specify parameters for this query')}</h1>
 
-        <form method="POST" action="" class="form-horizontal">
-          ${ csrf_token(request) | n,unicode }
-          <fieldset>
-            <!-- ko foreach: $root.design.parameters -->
-            <div class="control-group">
-              <label data-bind="text: name" class="control-label"></label>
-
-              <div class="controls">
-                <input data-bind="value: value, valueUpdate:'afterkeydown'" type="text"/>
+        <div class="card-body">
+          <p>
+
+          <form method="POST" action="" class="form-horizontal">
+            ${ csrf_token(request) | n,unicode }
+            <fieldset>
+              <!-- ko foreach: $root.design.parameters -->
+              <div class="control-group">
+                <label data-bind="text: name" class="control-label"></label>
+
+                <div class="controls">
+                  <input data-bind="value: value, valueUpdate:'afterkeydown'" type="text"/>
+                </div>
               </div>
-            </div>
-            <!-- /ko -->
-            <div class="form-actions" style="padding-left: 10px">
-              <a class="btn" href="javascript:history.go(-1);">${_('Cancel')}</a>
-              <button data-bind="enable: $root.hasParametersFilled, click: tryExplainParameterizedQuery" type="button" class="btn btn-primary">${_('Explain query')}</button>
-            </div>
-          </fieldset>
-        </form>
-        </p>
+              <!-- /ko -->
+              <div class="form-actions" style="padding-left: 10px">
+                <a class="btn" href="javascript:history.go(-1);">${_('Cancel')}</a>
+                <button data-bind="enable: $root.hasParametersFilled, click: tryExplainParameterizedQuery" type="button" class="btn btn-primary">${_('Explain query')}</button>
+              </div>
+            </fieldset>
+          </form>
+          </p>
+        </div>
       </div>
     </div>
   </div>
-</div>
 
 
-<div id="chooseFile" class="modal hide fade">
-  <div class="modal-header">
-    <a href="#" class="close" data-dismiss="modal">&times;</a>
-    <h3>${_('Choose a file')}</h3>
-  </div>
-  <div class="modal-body">
-    <div id="filechooser">
+  <div id="chooseFile" class="modal hide fade">
+    <div class="modal-header">
+      <a href="#" class="close" data-dismiss="modal">&times;</a>
+      <h3>${_('Choose a file')}</h3>
+    </div>
+    <div class="modal-body">
+      <div id="filechooser">
+      </div>
+    </div>
+    <div class="modal-footer">
     </div>
   </div>
-  <div class="modal-footer">
-  </div>
-</div>
 
-<div id="chooseFolder" class="modal hide fade">
-  <div class="modal-header">
-    <a href="#" class="close" data-dismiss="modal">&times;</a>
-    <h3>${_('Select a directory')}</h3>
-  </div>
-  <div class="modal-body">
-    <div id="folderchooser">
+  <div id="chooseFolder" class="modal hide fade">
+    <div class="modal-header">
+      <a href="#" class="close" data-dismiss="modal">&times;</a>
+      <h3>${_('Select a directory')}</h3>
+    </div>
+    <div class="modal-body">
+      <div id="folderchooser">
+      </div>
+    </div>
+    <div class="modal-footer">
     </div>
   </div>
-  <div class="modal-footer">
-  </div>
-</div>
 
-<div id="choosePath" class="modal hide fade">
-  <div class="modal-header">
-    <a href="#" class="close" data-dismiss="modal">&times;</a>
-    <h3>${_('Select a file or directory')}</h3>
-  </div>
-  <div class="modal-body">
-    <div id="pathchooser">
+  <div id="choosePath" class="modal hide fade">
+    <div class="modal-header">
+      <a href="#" class="close" data-dismiss="modal">&times;</a>
+      <h3>${_('Select a file or directory')}</h3>
+    </div>
+    <div class="modal-body">
+      <div id="pathchooser">
+      </div>
+    </div>
+    <div class="modal-footer">
     </div>
   </div>
-  <div class="modal-footer">
-  </div>
-</div>
 
 
-<div id="saveAs" class="modal hide fade">
-  <div class="modal-header">
-    <a href="#" class="close" data-dismiss="modal">&times;</a>
+  <div id="saveAs" class="modal hide fade">
+    <div class="modal-header">
+      <a href="#" class="close" data-dismiss="modal">&times;</a>
 
-    <h3>${_('Choose a name')}</h3>
-  </div>
-  <form class="form-horizontal">
-    <div class="control-group" id="saveas-query-name">
-      <label class="control-label">${_('Name')}</label>
+      <h3>${_('Choose a name')}</h3>
+    </div>
+    <form class="form-horizontal">
+      <div class="control-group" id="saveas-query-name">
+        <label class="control-label">${_('Name')}</label>
 
-      <div class="controls">
-        <input data-bind="value: $root.design.name, html" type="text" class="input-xlarge">
+        <div class="controls">
+          <input data-bind="value: $root.design.name, html" type="text" class="input-xlarge">
+        </div>
       </div>
-    </div>
-    <div class="control-group">
-      <label class="control-label">${_('Description')}</label>
+      <div class="control-group">
+        <label class="control-label">${_('Description')}</label>
 
-      <div class="controls">
-        <input data-bind="value: $root.design.description, html" type="text" class="input-xlarge">
+        <div class="controls">
+          <input data-bind="value: $root.design.description, html" type="text" class="input-xlarge">
+        </div>
       </div>
+    </form>
+    <div class="modal-footer">
+      <button class="btn" data-dismiss="modal">${_('Cancel')}</button>
+      <button data-bind="click: trySaveAsDesign" class="btn btn-primary">${_('Save')}</button>
     </div>
-  </form>
-  <div class="modal-footer">
-    <button class="btn" data-dismiss="modal">${_('Cancel')}</button>
-    <button data-bind="click: trySaveAsDesign" class="btn btn-primary">${_('Save')}</button>
   </div>
-</div>
 
 
-<div id="saveResultsModal" class="modal hide fade">
-  <div class="loader">
-    <div class="overlay"></div>
-    <!--[if !IE]><!--><i class="fa fa-spinner fa-spin"></i><!--<![endif]-->
-    <!--[if IE]><img class="spinner" src="/static/art/spinner-big-inverted.gif"/><![endif]-->
-  </div>
+  <div id="saveResultsModal" class="modal hide fade">
+    <div class="loader">
+      <div class="overlay"></div>
+      <!--[if !IE]><!--><i class="fa fa-spinner fa-spin"></i><!--<![endif]-->
+      <!--[if IE]><img class="spinner" src="/static/art/spinner-big-inverted.gif"/><![endif]-->
+    </div>
 
-  <div class="modal-header">
-    <a href="#" class="close" data-dismiss="modal">&times;</a>
-    <h3>${_('Save Query Results')}</h3>
-  </div>
-  <div class="modal-body" style="padding: 4px">
-    <!-- ko if: $root.design.results.save.saveTargetError() -->
-      <h4 data-bind="text: $root.design.results.save.saveTargetError()"></h4>
-    <!-- /ko -->
-    <!-- ko if: $root.design.results.save.targetTableError() -->
-      <h4 data-bind="text: $root.design.results.save.targetTableError()"></h4>
-    <!-- /ko -->
-    <!-- ko if: $root.design.results.save.targetDirectoryError() -->
-      <h4 data-bind="text: $root.design.results.save.targetDirectoryError()"></h4>
-    <!-- /ko -->
-    <form id="saveResultsForm" method="POST" class="form form-inline">
-      ${ csrf_token(request) | n,unicode }
-      <fieldset>
-        <div data-bind="css: {'error': $root.design.results.save.targetFileError()}" class="control-group">
-          <div class="controls">
-            <label class="radio">
-              <input data-bind="checked: $root.design.results.save.type" type="radio" name="save-results-type" value="hdfs-file">
-              &nbsp;${ _('In an HDFS file') }
-            </label>
-            <span data-bind="visible: $root.design.results.save.type() == 'hdfs-file'">
-              <input data-bind="value: $root.design.results.save.path" type="text" name="target_file" placeholder="${_('Path to CSV file')}" class="pathChooser">
-            </span>
-            <label class="radio" data-bind="visible: $root.design.results.save.type() == 'hdfs-file'">
-              <input data-bind="checked: $root.design.results.save.overwrite" type="checkbox" name="overwrite">
-              ${ _('Overwrite') }
-            </label>
+    <div class="modal-header">
+      <a href="#" class="close" data-dismiss="modal">&times;</a>
+      <h3>${_('Save Query Results')}</h3>
+    </div>
+    <div class="modal-body" style="padding: 4px">
+      <!-- ko if: $root.design.results.save.saveTargetError() -->
+        <h4 data-bind="text: $root.design.results.save.saveTargetError()"></h4>
+      <!-- /ko -->
+      <!-- ko if: $root.design.results.save.targetTableError() -->
+        <h4 data-bind="text: $root.design.results.save.targetTableError()"></h4>
+      <!-- /ko -->
+      <!-- ko if: $root.design.results.save.targetDirectoryError() -->
+        <h4 data-bind="text: $root.design.results.save.targetDirectoryError()"></h4>
+      <!-- /ko -->
+      <form id="saveResultsForm" method="POST" class="form form-inline">
+        ${ csrf_token(request) | n,unicode }
+        <fieldset>
+          <div data-bind="css: {'error': $root.design.results.save.targetFileError()}" class="control-group">
+            <div class="controls">
+              <label class="radio">
+                <input data-bind="checked: $root.design.results.save.type" type="radio" name="save-results-type" value="hdfs-file">
+                &nbsp;${ _('In an HDFS file') }
+              </label>
+              <span data-bind="visible: $root.design.results.save.type() == 'hdfs-file'">
+                <input data-bind="value: $root.design.results.save.path" type="text" name="target_file" placeholder="${_('Path to CSV file')}" class="pathChooser">
+              </span>
+              <label class="radio" data-bind="visible: $root.design.results.save.type() == 'hdfs-file'">
+                <input data-bind="checked: $root.design.results.save.overwrite" type="checkbox" name="overwrite">
+                ${ _('Overwrite') }
+              </label>
+            </div>
           </div>
-        </div>
-        <div data-bind="css: {'error': $root.design.results.save.targetTableError()}" class="control-group">
-          <div class="controls">
-            <label class="radio">
-              <input data-bind="checked: $root.design.results.save.type" type="radio" name="save-results-type" value="hive-table">
-              &nbsp;${ _('In a new table') }
-            </label>
-            <span data-bind="visible: $root.design.results.save.type() == 'hive-table'">
-              <input data-bind="value: $root.design.results.save.path" type="text" name="target_table" class="span4" placeholder="${_('Table name or <database name>.<table name>')}">
-            </span>
+          <div data-bind="css: {'error': $root.design.results.save.targetTableError()}" class="control-group">
+            <div class="controls">
+              <label class="radio">
+                <input data-bind="checked: $root.design.results.save.type" type="radio" name="save-results-type" value="hive-table">
+                &nbsp;${ _('In a new table') }
+              </label>
+              <span data-bind="visible: $root.design.results.save.type() == 'hive-table'">
+                <input data-bind="value: $root.design.results.save.path" type="text" name="target_table" class="span4" placeholder="${_('Table name or <database name>.<table name>')}">
+              </span>
+            </div>
           </div>
-        </div>
-        <div data-bind="css: {'error': $root.design.results.save.targetDirectoryError()}" class="control-group hide advanced">
-          <div class="controls">
-            <label class="radio">
-              <input data-bind="checked: $root.design.results.save.type" type="radio" name="save-results-type" value="hdfs-directory">
-              &nbsp;${ _('Big Query in HDFS') }
-            </label>
-            <span data-bind="visible: $root.design.results.save.type() == 'hdfs-directory'">
-              <input data-bind="value: $root.design.results.save.path" type="text" name="target_dir" placeholder="${_('Path to directory')}" class="folderChooser">
-              <i class="fa fa-question-circle" id="hdfs-directory-help"></i>
-            </span>
+          <div data-bind="css: {'error': $root.design.results.save.targetDirectoryError()}" class="control-group hide advanced">
+            <div class="controls">
+              <label class="radio">
+                <input data-bind="checked: $root.design.results.save.type" type="radio" name="save-results-type" value="hdfs-directory">
+                &nbsp;${ _('Big Query in HDFS') }
+              </label>
+              <span data-bind="visible: $root.design.results.save.type() == 'hdfs-directory'">
+                <input data-bind="value: $root.design.results.save.path" type="text" name="target_dir" placeholder="${_('Path to directory')}" class="folderChooser">
+                <i class="fa fa-question-circle" id="hdfs-directory-help"></i>
+              </span>
+            </div>
           </div>
-        </div>
-      </fieldset>
-    </form>
-    <div id="hdfs-directory-help-content" class="hide">
-      <p>${ _("Use this option if you have a large result. It will rerun the entire query and save the results to the chosen HDFS directory.") }</p>
+        </fieldset>
+      </form>
+      <div id="hdfs-directory-help-content" class="hide">
+        <p>${ _("Use this option if you have a large result. It will rerun the entire query and save the results to the chosen HDFS directory.") }</p>
+      </div>
+    </div>
+    <div class="modal-footer">
+      <a id="save-results-advanced" href="javascript:void(0)" class="pull-left">${ _('Show advanced fields') }</a>
+      <a id="save-results-simple" href="javascript:void(0)" class="pull-left hide">${ _('Hide advanced fields') }</a>
+      <button class="btn" data-dismiss="modal">${_('Cancel')}</button>
+      <button data-bind="click: trySaveResults" class="btn btn-primary disable-feedback">${_('Save')}</button>
     </div>
   </div>
-  <div class="modal-footer">
-    <a id="save-results-advanced" href="javascript:void(0)" class="pull-left">${ _('Show advanced fields') }</a>
-    <a id="save-results-simple" href="javascript:void(0)" class="pull-left hide">${ _('Hide advanced fields') }</a>
-    <button class="btn" data-dismiss="modal">${_('Cancel')}</button>
-    <button data-bind="click: trySaveResults" class="btn btn-primary disable-feedback">${_('Save')}</button>
-  </div>
-</div>
 
-<div id="navigatorQuicklook" class="modal hide fade">
-  <div class="modal-header">
-    <a href="#" class="close" data-dismiss="modal">&times;</a>
-    % if has_metastore:
-    <a class="tableLink pull-right" href="#" target="_blank" style="margin-right: 20px;margin-top:6px">
-      <i class="fa fa-external-link"></i> ${ _('View in Metastore Browser') }
-    </a>
-    % endif
+  <div id="navigatorQuicklook" class="modal hide fade">
+    <div class="modal-header">
+      <a href="#" class="close" data-dismiss="modal">&times;</a>
+      % if has_metastore:
+      <a class="tableLink pull-right" href="#" target="_blank" style="margin-right: 20px;margin-top:6px">
+        <i class="fa fa-external-link"></i> ${ _('View in Metastore Browser') }
+      </a>
+      % endif
 
-    <h3>${_('Data sample for')} <span class="tableName"></span></h3>
-  </div>
-  <div class="modal-body" style="min-height: 100px">
-    <div class="loader">
-      <!--[if !IE]><!--><i class="fa fa-spinner fa-spin" style="font-size: 30px; color: #DDD"></i><!--<![endif]-->
-      <!--[if IE]><img src="/static/art/spinner.gif"/><![endif]-->
+      <h3>${_('Data sample for')} <span class="tableName"></span></h3>
+    </div>
+    <div class="modal-body" style="min-height: 100px">
+      <div class="loader">
+        <!--[if !IE]><!--><i class="fa fa-spinner fa-spin" style="font-size: 30px; color: #DDD"></i><!--<![endif]-->
+        <!--[if IE]><img src="/static/art/spinner.gif"/><![endif]-->
+      </div>
+      <div class="sample"></div>
+    </div>
+    <div class="modal-footer">
+      <button class="btn btn-primary disable-feedback" data-dismiss="modal">${_('Ok')}</button>
     </div>
-    <div class="sample"></div>
-  </div>
-  <div class="modal-footer">
-    <button class="btn btn-primary disable-feedback" data-dismiss="modal">${_('Ok')}</button>
   </div>
 </div>
 
@@ -2139,7 +2143,6 @@ $(document).on('saved.results', function() {
   $('#saveResultsModal').modal('hide');
 });
 
-
 // Querying and click events.
 function tryExecuteQuery() {
   $(".jHueTableExtenderClonedContainer").hide();
@@ -2164,10 +2167,6 @@ function tryExecuteQuery() {
   logGA('query/execute');
 }
 
-function tryShareQuery() {
-  $("#documentShareModal").modal("show");
-}
-
 function tryExecuteNextStatement() {
   var query = getHighlightedQuery() || codeMirror.getValue();
 
@@ -2678,6 +2677,10 @@ function setupCodeMirrorSubscription() {
 
 // Knockout
 viewModel = new BeeswaxViewModel("${app_name}");
+ko.applyBindings(viewModel, $("#beeswax-execute")[0]);
+
+shareViewModel = setupSharing("#documentShareModal");
+shareViewModel.setDocId(${doc_id})
 
 % if not beeswax_conf.USE_GET_LOG_API.get() and app_name != 'impala':
   viewModel.shouldAppendLogs = true;
@@ -2696,11 +2699,6 @@ viewModel.design.fileResources.values.subscribe(function() {
   $(".fileChooser:not(:has(~ button))").after(getFileBrowseButton($(".fileChooser:not(:has(~ button))")));
 });
 
-var shareViewModel = setupSharing(function(doc) {
-  console.log('updating sharing', doc)
-}, "#documentShareModal");
-ko.applyBindings(viewModel, $("#query-editor")[0]);
-
 
 % if action == 'watch-results':
   $(document).ready(watchEvents);
diff --git a/apps/beeswax/src/beeswax/views.py b/apps/beeswax/src/beeswax/views.py
index 8b3a332..bffc8ac 100644
--- a/apps/beeswax/src/beeswax/views.py
+++ b/apps/beeswax/src/beeswax/views.py
@@ -138,7 +138,6 @@ def _save_design(user, design, type_, design_obj, explicit_save, name=None, desc
 
   return design
 
-
 def delete_design(request):
   if request.method == 'POST':
     ids = request.POST.getlist('designs_selection')
@@ -401,6 +400,7 @@ def execute_query(request, design_id=None, query_history_id=None):
     design = safe_get_design(request, query_type, design_id)
     query_history = None
 
+  doc = design and design.id and design.doc.get()
   context = {
     'design': design,
     'query': query_history, # Backward
@@ -408,7 +408,8 @@ def execute_query(request, design_id=None, query_history_id=None):
     'autocomplete_base_url': reverse(get_app_name(request) + ':api_autocomplete_databases', kwargs={}),
     'autocomplete_base_url_hive': reverse('beeswax:api_autocomplete_databases', kwargs={}),
     'can_edit_name': design and design.id and not design.is_auto,
-    'can_edit': design and design.id and design.doc.get().can_write(request.user),
+    'doc_id': doc and doc.id or -1,
+    'can_edit': doc and doc.can_write(request.user),
     'action': action,
     'on_success_url': request.GET.get('on_success_url'),
     'has_metastore': 'metastore' in get_apps_dict(request.user)
diff --git a/apps/pig/src/pig/models.py b/apps/pig/src/pig/models.py
index 5743ec1..68675fd 100644
--- a/apps/pig/src/pig/models.py
+++ b/apps/pig/src/pig/models.py
@@ -65,7 +65,7 @@ class PigScript(Document):
     for attr in PigScript._ATTRIBUTES:
       if attrs.get(attr) is not None:
         data_dict[attr] = attrs[attr]
-        
+
     if 'name' in attrs:
       self.doc.update(name=attrs['name'])
 
@@ -106,7 +106,7 @@ def create_or_update_script(id, name, script, user, parameters, resources, hadoo
 
 
 def get_scripts(user, is_design=None):
-  scripts = []  
+  scripts = []
   data = Doc.objects.available(PigScript, user)
 
   if is_design is not None:
@@ -116,6 +116,7 @@ def get_scripts(user, is_design=None):
     data = script.dict
     massaged_script = {
       'id': script.id,
+      'docId': script.doc.get().id,
       'name': data['name'],
       'script': data['script'],
       'parameters': data['parameters'],
diff --git a/apps/pig/src/pig/templates/app.mako b/apps/pig/src/pig/templates/app.mako
index c56c3f7..9b4aa88 100644
--- a/apps/pig/src/pig/templates/app.mako
+++ b/apps/pig/src/pig/templates/app.mako
@@ -14,7 +14,7 @@
 ## See the License for the specific language governing permissions and
 ## limitations under the License.
 <%!
-  from desktop.views import commonheader, commonfooter
+  from desktop.views import commonheader, commonfooter, commonshare
   from django.utils.translation import ugettext as _
 %>
 
@@ -22,709 +22,720 @@
 
 ${ commonheader(None, "pig", user) | n,unicode }
 
-<div class="navbar navbar-inverse navbar-fixed-top">
-    <div class="navbar-inner">
-      <div class="container-fluid">
-        <div class="nav-collapse">
-          <ul class="nav">
-            <li class="currentApp">
-              <a href="/${app_name}">
-                <img src="/pig/static/art/icon_pig_48.png" class="app-icon"/>
-                ${ _('Pig Editor') }
-              </a>
-            </li>
-            <li class="active"><a href="#editor" data-bind="css: { unsaved: isDirty }">${ _('Editor') }</a></li>
-            <li><a href="#scripts">${ _('Scripts') }</a></li>
-            <li><a href="#dashboard">${ _('Dashboard') }</a></li>
-          </ul>
+<div id="pig-editor-app">
+  <div class="navbar navbar-inverse navbar-fixed-top">
+      <div class="navbar-inner">
+        <div class="container-fluid">
+          <div class="nav-collapse">
+            <ul class="nav">
+              <li class="currentApp">
+                <a href="/${app_name}">
+                  <img src="/pig/static/art/icon_pig_48.png" class="app-icon"/>
+                  ${ _('Pig Editor') }
+                </a>
+              </li>
+              <li class="active"><a href="#editor" data-bind="css: { unsaved: isDirty }">${ _('Editor') }</a></li>
+              <li><a href="#scripts">${ _('Scripts') }</a></li>
+              <li><a href="#dashboard">${ _('Dashboard') }</a></li>
+            </ul>
+          </div>
         </div>
       </div>
-    </div>
-</div>
+  </div>
 
-<div class="container-fluid">
-  <div id="scripts" class="row-fluid mainSection hide">
-    <div class="card card-small">
-      <%actionbar:render>
-        <%def name="search()">
-            <input id="filter" type="text" class="input-xlarge search-query" placeholder="${_('Search for script name or content')}">
-        </%def>
-
-        <%def name="actions()">
-            <button class="btn fileToolbarBtn" title="${_('Run this script')}" data-bind="enable: selectedScripts().length == 1, click: listRunScript, visible: scripts().length > 0"><i class="fa fa-play"></i> ${_('Run')}</button>
-            <button class="btn fileToolbarBtn" title="${_('Copy this script')}" data-bind="enable: selectedScripts().length == 1, click: listCopyScript, visible: scripts().length > 0"><i class="fa fa-files-o"></i> ${_('Copy')}</button>
-            <button class="btn fileToolbarBtn" title="${_('Delete this script')}" data-bind="enable: selectedScripts().length > 0, click: listConfirmDeleteScripts, visible: scripts().length > 0"><i class="fa fa-trash-o"></i> ${_('Delete')}</button>
-        </%def>
-
-        <%def name="creation()">
-            <button class="btn fileToolbarBtn" title="${_('Create a new script')}" data-bind="click: confirmNewScript"><i class="fa fa-plus-circle"></i> ${_('New Script')}</button>
-        </%def>
-      </%actionbar:render>
-      <div class="alert alert-info" data-bind="visible: scripts().length == 0">
-        ${_('There are currently no scripts defined. Please add a new script clicking on "New script"')}
-      </div>
+  <div class="container-fluid">
+    <div id="scripts" class="row-fluid mainSection hide">
+      <div class="card card-small">
+        <%actionbar:render>
+          <%def name="search()">
+              <input id="filter" type="text" class="input-xlarge search-query" placeholder="${_('Search for script name or content')}">
+          </%def>
+
+          <%def name="actions()">
+              <button class="btn fileToolbarBtn" title="${_('Run this script')}" data-bind="enable: selectedScripts().length == 1, click: listRunScript, visible: scripts().length > 0"><i class="fa fa-play"></i> ${_('Run')}</button>
+              <button class="btn fileToolbarBtn" title="${_('Copy this script')}" data-bind="enable: selectedScripts().length == 1, click: listCopyScript, visible: scripts().length > 0"><i class="fa fa-files-o"></i> ${_('Copy')}</button>
+              <button class="btn fileToolbarBtn" title="${_('Delete this script')}" data-bind="enable: selectedScripts().length > 0, click: listConfirmDeleteScripts, visible: scripts().length > 0"><i class="fa fa-trash-o"></i> ${_('Delete')}</button>
+          </%def>
+
+          <%def name="creation()">
+              <button class="btn fileToolbarBtn" title="${_('Create a new script')}" data-bind="click: confirmNewScript"><i class="fa fa-plus-circle"></i> ${_('New Script')}</button>
+          </%def>
+        </%actionbar:render>
+        <div class="alert alert-info" data-bind="visible: scripts().length == 0">
+          ${_('There are currently no scripts defined. Please add a new script clicking on "New script"')}
+        </div>
 
-      <table class="table table-striped table-condensed tablescroller-disable" data-bind="visible: scripts().length > 0">
-        <thead>
-        <tr>
-          <th width="1%"><div data-bind="click: selectAll, css: {hueCheckbox: true, 'fa': true, 'fa-check': allSelected}"></div></th>
-          <th width="20%">${_('Name')}</th>
-          <th width="79%">${_('Script')}</th>
-        </tr>
-        </thead>
-        <tbody id="scriptTable" data-bind="template: {name: 'scriptTemplate', foreach: filteredScripts}">
-
-        </tbody>
-        <tfoot>
-        <tr data-bind="visible: isLoading()">
-          <td colspan="3" class="left">
-            <img src="/static/art/spinner.gif" />
-          </td>
-        </tr>
-        <tr data-bind="visible: filteredScripts().length == 0 && !isLoading()">
-          <td colspan="3">
-            <div class="alert">
-                ${_('There are no scripts matching the search criteria.')}
-            </div>
-          </td>
-        </tr>
-        </tfoot>
-      </table>
+        <table class="table table-striped table-condensed tablescroller-disable" data-bind="visible: scripts().length > 0">
+          <thead>
+          <tr>
+            <th width="1%"><div data-bind="click: selectAll, css: {hueCheckbox: true, 'fa': true, 'fa-check': allSelected}"></div></th>
+            <th width="20%">${_('Name')}</th>
+            <th width="79%">${_('Script')}</th>
+          </tr>
+          </thead>
+          <tbody id="scriptTable" data-bind="template: {name: 'scriptTemplate', foreach: filteredScripts}">
 
-      <script id="scriptTemplate" type="text/html">
-        <tr style="cursor: pointer" data-bind="event: { mouseover: toggleHover, mouseout: toggleHover}">
-          <td class="center" data-bind="click: handleSelect" style="cursor: default">
-            <div data-bind="css: {hueCheckbox: true, 'fa': true, 'fa-check': selected}"></div>
-          </td>
-          <td data-bind="click: $root.confirmViewScript">
-            <strong><a href="#" data-bind="click: $root.confirmViewScript, text: name"></a></strong>
-          </td>
-          <td data-bind="click: $root.confirmViewScript">
-            <span data-bind="text: scriptSumup"></span>
-          </td>
-        </tr>
-      </script>
-    </div>
-  </div>
+          </tbody>
+          <tfoot>
+          <tr data-bind="visible: isLoading()">
+            <td colspan="3" class="left">
+              <img src="/static/art/spinner.gif" />
+            </td>
+          </tr>
+          <tr data-bind="visible: filteredScripts().length == 0 && !isLoading()">
+            <td colspan="3">
+              <div class="alert">
+                  ${_('There are no scripts matching the search criteria.')}
+              </div>
+            </td>
+          </tr>
+          </tfoot>
+        </table>
 
-  <div id="editor" class="row-fluid mainSection hide">
-    <div class="span2">
-      <div class="sidebar-nav" style="padding-top: 0">
-          <ul class="nav nav-list">
-            <li class="nav-header">${_('Editor')}</li>
-            <li data-bind="click: editScript" class="active" data-section="edit">
-              <a href="#"><i class="fa fa-edit"></i> ${ _('Pig') }</a>
-            </li>
-            <li data-bind="click: editScriptProperties" data-section="properties">
-              <a href="#"><i class="fa fa-bars"></i> ${ _('Properties') }</a>
-            </li>
-            <li data-bind="click: saveScript, visible: currentScript().can_write()">
-              <a href="#" title="${ _('Save the script') }" rel="tooltip" data-placement="right">
-                <i class="fa fa-floppy-o"></i> ${ _('Save') }
-              </a>
-            </li>
-            <li data-bind="click: confirmNewScript">
-              <a href="#" title="${ _('New script') }" rel="tooltip" data-placement="right">
-                <i class="fa fa-plus-circle"></i> ${ _('New Script') }
-              </a>
-            </li>
-            <li class="nav-header">${_('Run')}</li>
-            <li data-bind="click: runOrShowSubmissionModal, visible: !currentScript().isRunning()">
-              <a href="#" title="${ _('Run the script') }" rel="tooltip" data-placement="right">
-                <i class="fa fa-play"></i> ${ _('Submit') }
-              </a>
-            </li>
-            <li data-bind="click: showStopModal, visible: currentScript().isRunning()">
-              <a href="#" title="${ _('Stop the script') }" rel="tooltip" data-placement="right" class="disabled">
-                <i class="fa fa-ban"></i> ${ _('Stop') }
-              </a>
-            </li>
-            <li data-bind="click: showScriptLogs" data-section="logs">
-              <a href="#" title="${ _('Show Logs') }" rel="tooltip" data-placement="right">
-                <i class="fa fa-tasks"></i> ${ _('Logs') }
-              </a>
-            </li>
-            <li data-bind="visible: currentScript().id() != -1, click: copyScript">
-              <a href="#" title="${ _('Copy the script') }" rel="tooltip" data-placement="right">
-                <i class="fa fa-files-o"></i> ${ _('Copy') }
-              </a>
-            </li>
-            <li data-bind="visible: currentScript().id() != -1, click: confirmDeleteScript">
-              <a href="#" title="${ _('Delete the script') }" rel="tooltip" data-placement="right">
-                <i class="fa fa-trash-o"></i> ${ _('Delete') }
-              </a>
-            </li>
-            <li>
-            <a href="#" id="help">
-              <i class="fa fa-question-circle"></i>
-            </a>
-            <div id="help-content" class="hide">
-              <ul style="text-align: left;">
-                <li>${ _("Press CTRL + Space to autocomplete") }</li>
-                <li>${ _("You can execute the current script by pressing CTRL + ENTER or CTRL + . in the editor") }</li>
-              </ul>
-            </div>
-            </li>
-          </ul>
+        <script id="scriptTemplate" type="text/html">
+          <tr style="cursor: pointer" data-bind="event: { mouseover: toggleHover, mouseout: toggleHover}">
+            <td class="center" data-bind="click: handleSelect" style="cursor: default">
+              <div data-bind="css: {hueCheckbox: true, 'fa': true, 'fa-check': selected}"></div>
+            </td>
+            <td data-bind="click: $root.confirmViewScript">
+              <strong><a href="#" data-bind="click: $root.confirmViewScript, text: name"></a></strong>
+            </td>
+            <td data-bind="click: $root.confirmViewScript">
+              <span data-bind="text: scriptSumup"></span>
+            </td>
+          </tr>
+        </script>
       </div>
     </div>
 
-    <div class="span10">
-      <div class="ribbon-wrapper" data-bind="visible: isDirty">
-        <div class="ribbon">${ _('Unsaved') }</div>
+    <div id="editor" class="row-fluid mainSection hide">
+      <div class="span2">
+        <div class="sidebar-nav" style="padding-top: 0">
+            <ul class="nav nav-list">
+              <li class="nav-header">${_('Editor')}</li>
+              <li data-bind="click: editScript" class="active" data-section="edit">
+                <a href="#"><i class="fa fa-edit"></i> ${ _('Pig') }</a>
+              </li>
+              <li data-bind="click: editScriptProperties" data-section="properties">
+                <a href="#"><i class="fa fa-bars"></i> ${ _('Properties') }</a>
+              </li>
+              <li data-bind="click: saveScript, visible: currentScript().can_write()">
+                <a href="#" title="${ _('Save the script') }" rel="tooltip" data-placement="right">
+                  <i class="fa fa-floppy-o"></i> ${ _('Save') }
+                </a>
+              </li>
+
+              <li data-bind="click: tryShareQuery, visible: currentScript().id() != -1">
+                <a class="share-link" href="#" title="${ _('Share the script') }" rel="tooltip" data-placement="right">
+                  <i class="fa fa-users"></i> ${ _('Share') }
+                </a>
+              <li data-bind="click: confirmNewScript">
+                <a href="#" title="${ _('New script') }" rel="tooltip" data-placement="right">
+                  <i class="fa fa-plus-circle"></i> ${ _('New Script') }
+                </a>
+              </li>
+              <li class="nav-header">${_('Run')}</li>
+              <li data-bind="click: runOrShowSubmissionModal, visible: !currentScript().isRunning()">
+                <a href="#" title="${ _('Run the script') }" rel="tooltip" data-placement="right">
+                  <i class="fa fa-play"></i> ${ _('Submit') }
+                </a>
+              </li>
+              <li data-bind="click: showStopModal, visible: currentScript().isRunning()">
+                <a href="#" title="${ _('Stop the script') }" rel="tooltip" data-placement="right" class="disabled">
+                  <i class="fa fa-ban"></i> ${ _('Stop') }
+                </a>
+              </li>
+              <li data-bind="click: showScriptLogs" data-section="logs">
+                <a href="#" title="${ _('Show Logs') }" rel="tooltip" data-placement="right">
+                  <i class="fa fa-tasks"></i> ${ _('Logs') }
+                </a>
+              </li>
+              <li data-bind="visible: currentScript().id() != -1, click: copyScript">
+                <a href="#" title="${ _('Copy the script') }" rel="tooltip" data-placement="right">
+                  <i class="fa fa-files-o"></i> ${ _('Copy') }
+                </a>
+              </li>
+              <li data-bind="visible: currentScript().id() != -1, click: confirmDeleteScript">
+                <a href="#" title="${ _('Delete the script') }" rel="tooltip" data-placement="right">
+                  <i class="fa fa-trash-o"></i> ${ _('Delete') }
+                </a>
+              </li>
+              <li>
+              <a href="#" id="help">
+                <i class="fa fa-question-circle"></i>
+              </a>
+              <div id="help-content" class="hide">
+                <ul style="text-align: left;">
+                  <li>${ _("Press CTRL + Space to autocomplete") }</li>
+                  <li>${ _("You can execute the current script by pressing CTRL + ENTER or CTRL + . in the editor") }</li>
+                </ul>
+              </div>
+              </li>
+            </ul>
+        </div>
       </div>
 
-      <div class="card card-small">
-
-      <div id="edit" class="section">
-        <div class="alert alert-info">
-          <a class="mainAction" href="#" title="${ _('Run this script') }" data-bind="click: runOrShowSubmissionModal, visible: !currentScript().isRunning()"><i class="fa fa-play"></i></a>
-          <a class="mainAction" href="#" title="${ _('Stop this script') }" data-bind="click: showStopModal, visible: currentScript().isRunning()"><i class="fa fa-stop"></i></a>
-          <h3><span data-bind="text: currentScript().name"></span></h3>
+      <div class="span10">
+        <div class="ribbon-wrapper" data-bind="visible: isDirty">
+          <div class="ribbon">${ _('Unsaved') }</div>
         </div>
-        <div class="row-fluid">
-          <div id="queryColumn" class="span9">
-            <a id="navigatorShow" href="#" title="${_('Show the assist')}" style="position:absolute;z-index: 10000; margin-top:10px;display:none;right:30px" rel="tooltip" data-placement="left"><i class="fa fa-compass"></i></a>
-            <form id="queryForm">
-              <textarea id="scriptEditor" data-bind="text:currentScript().script"></textarea>
-            </form>
-          </div>
-          <div id="navigatorColumn" class="span3">
-            <a id="navigatorHide" href="#" title="${_('Hide the assist')}" rel="tooltip" data-placement="left" class="pull-right" style="margin:10px;margin-left: 0"><i class="fa fa-chevron-right"></i></a>
-            <a href="#" title="${_('Double click on function to insert it in the editor')}" rel="tooltip" data-placement="left" class="pull-right" style="margin:10px;margin-left: 0"><i class="fa fa-question-circle"></i></a>
-            <h1 class="card-heading simple"><i class="fa fa-compass"></i> ${_('Assist')}</h1>
-            <div class="card-body">
-              <p>
-                <input id="navigatorSearch" type="text" class="input-medium" placeholder="${ _('Function name...') }"/>
-                <ul id="navigatorFunctions" class="unstyled">
-                  <li>
-                    <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Eval Functions</a>
-                    <ul class="navigatorFunctionCategoryContent unstyled hide">
-                      <li><a href="#">AVG(%VAR%)</a></li>
-                      <li><a href="#">CONCAT(%VAR1%, %VAR2%)</a></li>
-                      <li><a href="#">COUNT(%VAR%)</a></li>
-                      <li><a href="#">COUNT_START(%VAR%)</a></li>
-                      <li><a href="#">IsEmpty(%VAR%)</a></li>
-                      <li><a href="#">DIFF(%VAR1%, %VAR2%)</a></li>
-                      <li><a href="#">MAX(%VAR%)</a></li>
-                      <li><a href="#">MIN(%VAR%)</a></li>
-                      <li><a href="#">SIZE(%VAR%)</a></li>
-                      <li><a href="#">SUM(%VAR%)</a></li>
-                      <li><a href="#">TOKENIZE(%VAR%, %DELIM%)</a></li>
-                    </ul>
-                  </li>
-                  <li>
-                      <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Relational Operators</a>
-                      <ul class="navigatorFunctionCategoryContent unstyled hide">
-                        <li><a href="#">COGROUP %VAR% BY %VAR%</a></li>
-                        <li><a href="#">CROSS %VAR1%, %VAR2%;</a></li>
-                        <li><a href="#">DISTINCT %VAR%;</a></li>
-                        <li><a href="#">FILTER %VAR% BY %COND%</a></li>
-                        <li><a href="#">FLATTEN(%VAR%)</a></li>
-                        <li><a href="#">FOREACH %DATA% GENERATE %NEW_DATA%;</a></li>
-                        <li><a href="#">FOREACH %DATA% {%NESTED_BLOCK%};</a></li>
-                        <li><a href="#">GROUP %VAR% BY %VAR%</a></li>
-                        <li><a href="#">GROUP %VAR% ALL</a></li>
-                        <li><a href="#">JOIN %VAR% BY </a></li>
-                        <li><a href="#">LIMIT %VAR% %N%</a></li>
-                        <li><a href="#">ORDER %VAR% BY %FIELD%</a></li>
-                        <li><a href="#">SAMPLE %VAR% %SIZE%</a></li>
-                        <li><a href="#">SPLIT %VAR1% INTO %VAR2% IF %EXPRESSIONS%</a></li>
-                        <li><a href="#">UNION %VAR1%, %VAR2%</a></li>
-                      </ul>
-                    </li>
 
+        <div class="card card-small">
+
+        <div id="edit" class="section">
+          <div class="alert alert-info">
+            <a class="mainAction" href="#" title="${ _('Run this script') }" data-bind="click: runOrShowSubmissionModal, visible: !currentScript().isRunning()"><i class="fa fa-play"></i></a>
+            <a class="mainAction" href="#" title="${ _('Stop this script') }" data-bind="click: showStopModal, visible: currentScript().isRunning()"><i class="fa fa-stop"></i></a>
+            <h3><span data-bind="text: currentScript().name"></span></h3>
+          </div>
+          <div class="row-fluid">
+            <div id="queryColumn" class="span9">
+              <a id="navigatorShow" href="#" title="${_('Show the assist')}" style="position:absolute;z-index: 10000; margin-top:10px;display:none;right:30px" rel="tooltip" data-placement="left"><i class="fa fa-compass"></i></a>
+              <form id="queryForm">
+                <textarea id="scriptEditor" data-bind="text:currentScript().script"></textarea>
+              </form>
+            </div>
+            <div id="navigatorColumn" class="span3">
+              <a id="navigatorHide" href="#" title="${_('Hide the assist')}" rel="tooltip" data-placement="left" class="pull-right" style="margin:10px;margin-left: 0"><i class="fa fa-chevron-right"></i></a>
+              <a href="#" title="${_('Double click on function to insert it in the editor')}" rel="tooltip" data-placement="left" class="pull-right" style="margin:10px;margin-left: 0"><i class="fa fa-question-circle"></i></a>
+              <h1 class="card-heading simple"><i class="fa fa-compass"></i> ${_('Assist')}</h1>
+              <div class="card-body">
+                <p>
+                  <input id="navigatorSearch" type="text" class="input-medium" placeholder="${ _('Function name...') }"/>
+                  <ul id="navigatorFunctions" class="unstyled">
                     <li>
-                      <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Input/Output</a>
-                      <ul class="navigatorFunctionCategoryContent unstyled hide">
-                        <li><a href="#">LOAD '%FILE%';</a></li>
-                        <li><a href="#">DUMP %VAR%;</a></li>
-                        <li><a href="#">STORE %VAR% INTO %PATH%;</a></li>
-                      </ul>
-                    </li>
-                    <li>
-                      <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Debug</a>
-                      <ul class="navigatorFunctionCategoryContent unstyled hide">
-                        <li><a href="#">EXPLAIN %VAR%;</a></li>
-                        <li><a href="#">ILLUSTRATE %VAR%;</a></li>
-                        <li><a href="#">DESCRIBE %VAR%;</a></li>
-                      </ul>
-                    </li>
-                    <li>
-                      <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> HCatalog</a>
-                      <ul class="navigatorFunctionCategoryContent unstyled hide">
-                        <li><a href="#">LOAD '%TABLE%' USING org.apache.hcatalog.pig.HCatLoader();</a></li>
-                      </ul>
-                    </li>
-                    <li>
-                      <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Math</a>
-                      <ul class="navigatorFunctionCategoryContent unstyled hide">
-                        <li><a href="#">ABS(%VAR%)</a></li>
-                        <li><a href="#">ACOS(%VAR%)</a></li>
-                        <li><a href="#">ASIN(%VAR%)</a></li>
-                        <li><a href="#">ATAN(%VAR%)</a></li>
-                        <li><a href="#">CBRT(%VAR%)</a></li>
-                        <li><a href="#">CEIL(%VAR%)</a></li>
-                        <li><a href="#">COS(%VAR%)</a></li>
-                        <li><a href="#">COSH(%VAR%)</a></li>
-                        <li><a href="#">EXP(%VAR%)</a></li>
-                        <li><a href="#">FLOOR(%VAR%)</a></li>
-                        <li><a href="#">LOG(%VAR%)</a></li>
-                        <li><a href="#">LOG10(%VAR%)</a></li>
-                        <li><a href="#">RANDOM(%VAR%)</a></li>
-                        <li><a href="#">ROUND(%VAR%)</a></li>
-                        <li><a href="#">SIN(%VAR%)</a></li>
-                        <li><a href="#">SINH(%VAR%)</a></li>
-                        <li><a href="#">SQRT(%VAR%)</a></li>
-                        <li><a href="#">TAN(%VAR%)</a></li>
-                        <li><a href="#">TANH(%VAR%)</a></li>
-                      </ul>
-                    </li>
-                    <li>
-                      <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Tuple, Bag, Map Functions</a>
-                      <ul class="navigatorFunctionCategoryContent unstyled hide">
-                        <li><a href="#">TOTUPLE(%VAR%)</a></li>
-                        <li><a href="#">TOBAG(%VAR%)</a></li>
-                        <li><a href="#">TOMAP(%KEY%, %VALUE%)</a></li>
-                        <li><a href="#">TOP(%topN%, %COLUMN%, %RELATION%)</a></li>
-                      </ul>
-                    </li>
-                    <li>
-                      <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> String Functions</a>
-                      <ul class="navigatorFunctionCategoryContent unstyled hide">
-                        <li><a href="#">INDEXOF(%STRING%, '%CHARACTER%', %STARTINDEX%)</a></li>
-                        <li><a href="#">LAST_INDEX_OF(%STRING%, '%CHARACTER%', %STARTINDEX%)</a></li>
-                        <li><a href="#">LOWER(%STRING%)</a></li>
-                        <li><a href="#">REGEX_EXTRACT(%STRING%, %REGEX%, %INDEX%)</a></li>
-                        <li><a href="#">REGEX_EXTRACT_ALL(%STRING%, %REGEX%)</a></li>
-                        <li><a href="#">REPLACE(%STRING%, '%oldChar%', '%newChar%')</a></li>
-                        <li><a href="#">STRSPLIT(%STRING%, %REGEX%, %LIMIT%)</a></li>
-                        <li><a href="#">SUBSTRING(%STRING%, %STARTINDEX%, %STOPINDEX%)</a></li>
-                        <li><a href="#">TRIM(%STRING%)</a></li>
-                        <li><a href="#">UCFIRST(%STRING%)</a></li>
-                        <li><a href="#">UPPER(%STRING%)</a></li>
-                      </ul>
-                    </li>
-                    <li>
-                      <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Macros</a>
-                      <ul class="navigatorFunctionCategoryContent unstyled hide">
-                        <li><a href="#">IMPORT '%PATH_TO_MACRO%';</a></li>
-                      </ul>
-                    </li>
-                    <li>
-                      <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> HBase</a>
+                      <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Eval Functions</a>
                       <ul class="navigatorFunctionCategoryContent unstyled hide">
-                        <li><a href="#">LOAD 'hbase://%TABLE%' USING org.apache.pig.backend.hadoop.hbase.HBaseStorage('%columnList%')</a></li>
-                        <li><a href="#">STORE %VAR% INTO 'hbase://%TABLE%' USING org.apache.pig.backend.hadoop.hbase.HBaseStorage('%columnList%')</a></li>
+                        <li><a href="#">AVG(%VAR%)</a></li>
+                        <li><a href="#">CONCAT(%VAR1%, %VAR2%)</a></li>
+                        <li><a href="#">COUNT(%VAR%)</a></li>
+                        <li><a href="#">COUNT_START(%VAR%)</a></li>
+                        <li><a href="#">IsEmpty(%VAR%)</a></li>
+                        <li><a href="#">DIFF(%VAR1%, %VAR2%)</a></li>
+                        <li><a href="#">MAX(%VAR%)</a></li>
+                        <li><a href="#">MIN(%VAR%)</a></li>
+                        <li><a href="#">SIZE(%VAR%)</a></li>
+                        <li><a href="#">SUM(%VAR%)</a></li>
+                        <li><a href="#">TOKENIZE(%VAR%, %DELIM%)</a></li>
                       </ul>
                     </li>
                     <li>
-                      <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Python UDF</a>
-                      <ul class="navigatorFunctionCategoryContent unstyled hide">
-                        <li>
-                          <a data-python="true" href="#">REGISTER 'python_udf.py' USING jython AS myfuncs;</a>
-                        </li>
-                      </ul>
-                    </li>
-                </ul>
-              </p>
+                        <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Relational Operators</a>
+                        <ul class="navigatorFunctionCategoryContent unstyled hide">
+                          <li><a href="#">COGROUP %VAR% BY %VAR%</a></li>
+                          <li><a href="#">CROSS %VAR1%, %VAR2%;</a></li>
+                          <li><a href="#">DISTINCT %VAR%;</a></li>
+                          <li><a href="#">FILTER %VAR% BY %COND%</a></li>
+                          <li><a href="#">FLATTEN(%VAR%)</a></li>
+                          <li><a href="#">FOREACH %DATA% GENERATE %NEW_DATA%;</a></li>
+                          <li><a href="#">FOREACH %DATA% {%NESTED_BLOCK%};</a></li>
+                          <li><a href="#">GROUP %VAR% BY %VAR%</a></li>
+                          <li><a href="#">GROUP %VAR% ALL</a></li>
+                          <li><a href="#">JOIN %VAR% BY </a></li>
+                          <li><a href="#">LIMIT %VAR% %N%</a></li>
+                          <li><a href="#">ORDER %VAR% BY %FIELD%</a></li>
+                          <li><a href="#">SAMPLE %VAR% %SIZE%</a></li>
+                          <li><a href="#">SPLIT %VAR1% INTO %VAR2% IF %EXPRESSIONS%</a></li>
+                          <li><a href="#">UNION %VAR1%, %VAR2%</a></li>
+                        </ul>
+                      </li>
+
+                      <li>
+                        <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Input/Output</a>
+                        <ul class="navigatorFunctionCategoryContent unstyled hide">
+                          <li><a href="#">LOAD '%FILE%';</a></li>
+                          <li><a href="#">DUMP %VAR%;</a></li>
+                          <li><a href="#">STORE %VAR% INTO %PATH%;</a></li>
+                        </ul>
+                      </li>
+                      <li>
+                        <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Debug</a>
+                        <ul class="navigatorFunctionCategoryContent unstyled hide">
+                          <li><a href="#">EXPLAIN %VAR%;</a></li>
+                          <li><a href="#">ILLUSTRATE %VAR%;</a></li>
+                          <li><a href="#">DESCRIBE %VAR%;</a></li>
+                        </ul>
+                      </li>
+                      <li>
+                        <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> HCatalog</a>
+                        <ul class="navigatorFunctionCategoryContent unstyled hide">
+                          <li><a href="#">LOAD '%TABLE%' USING org.apache.hcatalog.pig.HCatLoader();</a></li>
+                        </ul>
+                      </li>
+                      <li>
+                        <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Math</a>
+                        <ul class="navigatorFunctionCategoryContent unstyled hide">
+                          <li><a href="#">ABS(%VAR%)</a></li>
+                          <li><a href="#">ACOS(%VAR%)</a></li>
+                          <li><a href="#">ASIN(%VAR%)</a></li>
+                          <li><a href="#">ATAN(%VAR%)</a></li>
+                          <li><a href="#">CBRT(%VAR%)</a></li>
+                          <li><a href="#">CEIL(%VAR%)</a></li>
+                          <li><a href="#">COS(%VAR%)</a></li>
+                          <li><a href="#">COSH(%VAR%)</a></li>
+                          <li><a href="#">EXP(%VAR%)</a></li>
+                          <li><a href="#">FLOOR(%VAR%)</a></li>
+                          <li><a href="#">LOG(%VAR%)</a></li>
+                          <li><a href="#">LOG10(%VAR%)</a></li>
+                          <li><a href="#">RANDOM(%VAR%)</a></li>
+                          <li><a href="#">ROUND(%VAR%)</a></li>
+                          <li><a href="#">SIN(%VAR%)</a></li>
+                          <li><a href="#">SINH(%VAR%)</a></li>
+                          <li><a href="#">SQRT(%VAR%)</a></li>
+                          <li><a href="#">TAN(%VAR%)</a></li>
+                          <li><a href="#">TANH(%VAR%)</a></li>
+                        </ul>
+                      </li>
+                      <li>
+                        <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Tuple, Bag, Map Functions</a>
+                        <ul class="navigatorFunctionCategoryContent unstyled hide">
+                          <li><a href="#">TOTUPLE(%VAR%)</a></li>
+                          <li><a href="#">TOBAG(%VAR%)</a></li>
+                          <li><a href="#">TOMAP(%KEY%, %VALUE%)</a></li>
+                          <li><a href="#">TOP(%topN%, %COLUMN%, %RELATION%)</a></li>
+                        </ul>
+                      </li>
+                      <li>
+                        <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> String Functions</a>
+                        <ul class="navigatorFunctionCategoryContent unstyled hide">
+                          <li><a href="#">INDEXOF(%STRING%, '%CHARACTER%', %STARTINDEX%)</a></li>
+                          <li><a href="#">LAST_INDEX_OF(%STRING%, '%CHARACTER%', %STARTINDEX%)</a></li>
+                          <li><a href="#">LOWER(%STRING%)</a></li>
+                          <li><a href="#">REGEX_EXTRACT(%STRING%, %REGEX%, %INDEX%)</a></li>
+                          <li><a href="#">REGEX_EXTRACT_ALL(%STRING%, %REGEX%)</a></li>
+                          <li><a href="#">REPLACE(%STRING%, '%oldChar%', '%newChar%')</a></li>
+                          <li><a href="#">STRSPLIT(%STRING%, %REGEX%, %LIMIT%)</a></li>
+                          <li><a href="#">SUBSTRING(%STRING%, %STARTINDEX%, %STOPINDEX%)</a></li>
+                          <li><a href="#">TRIM(%STRING%)</a></li>
+                          <li><a href="#">UCFIRST(%STRING%)</a></li>
+                          <li><a href="#">UPPER(%STRING%)</a></li>
+                        </ul>
+                      </li>
+                      <li>
+                        <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Macros</a>
+                        <ul class="navigatorFunctionCategoryContent unstyled hide">
+                          <li><a href="#">IMPORT '%PATH_TO_MACRO%';</a></li>
+                        </ul>
+                      </li>
+                      <li>
+                        <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> HBase</a>
+                        <ul class="navigatorFunctionCategoryContent unstyled hide">
+                          <li><a href="#">LOAD 'hbase://%TABLE%' USING org.apache.pig.backend.hadoop.hbase.HBaseStorage('%columnList%')</a></li>
+                          <li><a href="#">STORE %VAR% INTO 'hbase://%TABLE%' USING org.apache.pig.backend.hadoop.hbase.HBaseStorage('%columnList%')</a></li>
+                        </ul>
+                      </li>
+                      <li>
+                        <a class="navigatorFunctionCategory" href="javascript:void(0)"><i class="fa fa-caret-right"></i> Python UDF</a>
+                        <ul class="navigatorFunctionCategoryContent unstyled hide">
+                          <li>
+                            <a data-python="true" href="#">REGISTER 'python_udf.py' USING jython AS myfuncs;</a>
+                          </li>
+                        </ul>
+                      </li>
+                  </ul>
+                </p>
+              </div>
             </div>
           </div>
         </div>
-      </div>
 
-      <div id="properties" class="section hide">
-        <div class="alert alert-info">
-          <a class="mainAction" href="#" title="${ _('Run this script') }" data-bind="click: runOrShowSubmissionModal, visible: !currentScript().isRunning()"><i class="fa fa-play"></i></a>
-          <a class="mainAction" href="#" title="${ _('Stop this script') }" data-bind="click: showStopModal, visible: currentScript().isRunning()"><i class="fa fa-stop"></i></a>
-          <h3><span data-bind="text: currentScript().name"></span></h3>
-        </div>
-        <form class="form-inline" style="padding-left: 10px">
-          <label>
-            ${ _('Script name') } &nbsp;
-            <input type="text" id="scriptName" class="input-xlarge" data-bind="value: currentScript().name, valueUpdate:'afterkeydown'" />
-          </label>
-
-          <br/>
-          <br/>
-
-          <h4>${ _('Pig parameters') } &nbsp; <i id="parameters-dyk" class="fa fa-question-circle"></i></h4>
-          <div id="parameters-dyk-content" class="hide">
-            <ul style="text-align: left;">
-              <li>input /user/data</li>
-              <li>-param input=/user/data</li>
-              <li>-optimizer_off SplitFilter</li>
-              <li>-verbose</li>
-            </ul>
+        <div id="properties" class="section hide">
+          <div class="alert alert-info">
+            <a class="mainAction" href="#" title="${ _('Run this script') }" data-bind="click: runOrShowSubmissionModal, visible: !currentScript().isRunning()"><i class="fa fa-play"></i></a>
+            <a class="mainAction" href="#" title="${ _('Stop this script') }" data-bind="click: showStopModal, visible: currentScript().isRunning()"><i class="fa fa-stop"></i></a>
+            <h3><span data-bind="text: currentScript().name"></span></h3>
           </div>
-          <div class="parameterTableCnt">
-            <table class="parameterTable" data-bind="visible: currentScript().parameters().length == 0">
-              <tr>
-                <td>
-                  ${ _('There are currently no defined parameters.') }
-                  <button class="btn" data-bind="click: currentScript().addParameter" style="margin-left: 4px">
-                    <i class="fa fa-plus"></i> ${ _('Add') }
-                  </button>
-                </td>
-              </tr>
-            </table>
-            <table data-bind="css: {'parameterTable': currentScript().parameters().length > 0}">
-              <thead data-bind="visible: currentScript().parameters().length > 0">
-                <tr>
-                  <th>${ _('Name') }</th>
-                  <th>${ _('Value') }</th>
-                  <th>&nbsp;</th>
-                </tr>
-              </thead>
-              <tbody data-bind="foreach: currentScript().parameters">
+          <form class="form-inline" style="padding-left: 10px">
+            <label>
+              ${ _('Script name') } &nbsp;
+              <input type="text" id="scriptName" class="input-xlarge" data-bind="value: currentScript().name, valueUpdate:'afterkeydown'" />
+            </label>
+
+            <br/>
+            <br/>
+
+            <h4>${ _('Pig parameters') } &nbsp; <i id="parameters-dyk" class="fa fa-question-circle"></i></h4>
+            <div id="parameters-dyk-content" class="hide">
+              <ul style="text-align: left;">
+                <li>input /user/data</li>
+                <li>-param input=/user/data</li>
+                <li>-optimizer_off SplitFilter</li>
+                <li>-verbose</li>
+              </ul>
+            </div>
+            <div class="parameterTableCnt">
+              <table class="parameterTable" data-bind="visible: currentScript().parameters().length == 0">
                 <tr>
-                  <td><input type="text" data-bind="value: name" class="input-xlarge" /></td>
                   <td>
-                    <div class="input-append">
-                      <input type="text" data-bind="value: value" class="input-xxlarge" />
-                      <button class="btn fileChooserBtn" data-bind="click: $root.showFileChooser">..</button>
-                    </div>
+                    ${ _('There are currently no defined parameters.') }
+                    <button class="btn" data-bind="click: currentScript().addParameter" style="margin-left: 4px">
+                      <i class="fa fa-plus"></i> ${ _('Add') }
+                    </button>
                   </td>
-                  <td><button data-bind="click: viewModel.currentScript().removeParameter" class="btn"><i class="fa fa-trash-o"></i> ${ _('Remove') }</button></td>
                 </tr>
-              </tbody>
-              <tfoot data-bind="visible: currentScript().parameters().length > 0">
-                <tr>
-                  <td colspan="3">
-                    <button class="btn" data-bind="click: currentScript().addParameter"><i class="fa fa-plus"></i> ${ _('Add') }</button>
-                  </td>
-                </tr>
-              </tfoot>
-            </table>
-          </div>
+              </table>
+              <table data-bind="css: {'parameterTable': currentScript().parameters().length > 0}">
+                <thead data-bind="visible: currentScript().parameters().length > 0">
+                  <tr>
+                    <th>${ _('Name') }</th>
+                    <th>${ _('Value') }</th>
+                    <th>&nbsp;</th>
+                  </tr>
+                </thead>
+                <tbody data-bind="foreach: currentScript().parameters">
+                  <tr>
+                    <td><input type="text" data-bind="value: name" class="input-xlarge" /></td>
+                    <td>
+                      <div class="input-append">
+                        <input type="text" data-bind="value: value" class="input-xxlarge" />
+                        <button class="btn fileChooserBtn" data-bind="click: $root.showFileChooser">..</button>
+                      </div>
+                    </td>
+                    <td><button data-bind="click: viewModel.currentScript().removeParameter" class="btn"><i class="fa fa-trash-o"></i> ${ _('Remove') }</button></td>
+                  </tr>
+                </tbody>
+                <tfoot data-bind="visible: currentScript().parameters().length > 0">
+                  <tr>
+                    <td colspan="3">
+                      <button class="btn" data-bind="click: currentScript().addParameter"><i class="fa fa-plus"></i> ${ _('Add') }</button>
+                    </td>
+                  </tr>
+                </tfoot>
+              </table>
+            </div>
 
-          <br/>
-          <h4>${ _('Hadoop properties') } &nbsp; <i id="properties-dyk" class="fa fa-question-circle"></i></h4>
-          <div id="properties-dyk-content" class="hide">
-            <ul style="text-align: left; word-wrap:break-word">
-              <li>mapred.job.queue.name production</li>
-              <li>mapred.map.tasks.speculative.execution false</li>
-            </ul>
-          </div>
-          <div class="parameterTableCnt">
-            <table class="parameterTable" data-bind="visible: currentScript().hadoopProperties().length == 0">
-              <tr>
-                <td>
-                  ${ _('There are currently no defined Hadoop properties.') }
-                  <button class="btn" data-bind="click: currentScript().addHadoopProperties" style="margin-left: 4px">
-                    <i class="fa fa-plus"></i> ${ _('Add') }
-                  </button>
-                </td>
-              </tr>
-            </table>
-            <table data-bind="css: {'parameterTable': currentScript().hadoopProperties().length > 0}">
-              <thead data-bind="visible: currentScript().hadoopProperties().length > 0">
-                <tr>
-                  <th>${ _('Name') }</th>
-                  <th>${ _('Value') }</th>
-                  <th>&nbsp;</th>
-                </tr>
-              </thead>
-              <tbody data-bind="foreach: currentScript().hadoopProperties">
+            <br/>
+            <h4>${ _('Hadoop properties') } &nbsp; <i id="properties-dyk" class="fa fa-question-circle"></i></h4>
+            <div id="properties-dyk-content" class="hide">
+              <ul style="text-align: left; word-wrap:break-word">
+                <li>mapred.job.queue.name production</li>
+                <li>mapred.map.tasks.speculative.execution false</li>
+              </ul>
+            </div>
+            <div class="parameterTableCnt">
+              <table class="parameterTable" data-bind="visible: currentScript().hadoopProperties().length == 0">
                 <tr>
-                  <td><input type="text" data-bind="value: name" class="input-xlarge" /></td>
                   <td>
-                    <div class="input-append">
-                      <input type="text" data-bind="value: value" class="input-xxlarge" />
-                      <button class="btn fileChooserBtn" data-bind="click: $root.showFileChooser">..</button>
-                    </div>
-                  </td>
-                  <td><button data-bind="click: viewModel.currentScript().removeHadoopProperties" class="btn"><i class="fa fa-trash-o"></i> ${ _('Remove') }</button></td>
-                </tr>
-              </tbody>
-              <tfoot data-bind="visible: currentScript().hadoopProperties().length > 0">
-                <tr>
-                  <td colspan="3">
-                    <button class="btn" data-bind="click: currentScript().addHadoopProperties"><i class="fa fa-plus"></i> ${ _('Add') }</button>
+                    ${ _('There are currently no defined Hadoop properties.') }
+                    <button class="btn" data-bind="click: currentScript().addHadoopProperties" style="margin-left: 4px">
+                      <i class="fa fa-plus"></i> ${ _('Add') }
+                    </button>
                   </td>
                 </tr>
-              </tfoot>
-            </table>
-          </div>
+              </table>
+              <table data-bind="css: {'parameterTable': currentScript().hadoopProperties().length > 0}">
+                <thead data-bind="visible: currentScript().hadoopProperties().length > 0">
+                  <tr>
+                    <th>${ _('Name') }</th>
+                    <th>${ _('Value') }</th>
+                    <th>&nbsp;</th>
+                  </tr>
+                </thead>
+                <tbody data-bind="foreach: currentScript().hadoopProperties">
+                  <tr>
+                    <td><input type="text" data-bind="value: name" class="input-xlarge" /></td>
+                    <td>
+                      <div class="input-append">
+                        <input type="text" data-bind="value: value" class="input-xxlarge" />
+                        <button class="btn fileChooserBtn" data-bind="click: $root.showFileChooser">..</button>
+                      </div>
+                    </td>
+                    <td><button data-bind="click: viewModel.currentScript().removeHadoopProperties" class="btn"><i class="fa fa-trash-o"></i> ${ _('Remove') }</button></td>
+                  </tr>
+                </tbody>
+                <tfoot data-bind="visible: currentScript().hadoopProperties().length > 0">
+                  <tr>
+                    <td colspan="3">
+                      <button class="btn" data-bind="click: currentScript().addHadoopProperties"><i class="fa fa-plus"></i> ${ _('Add') }</button>
+                    </td>
+                  </tr>
+                </tfoot>
+              </table>
+            </div>
 
-          <br/>
+            <br/>
 
-          <h4>${ _('Resources') } &nbsp; <i id="resources-dyk" class="fa fa-question-circle"></i></h4>
-          <div id="resources-dyk-content" class="hide">
-            <ul style="text-align: left;">
-              <li>${ _("Path to a HDFS file or zip file to add to the workspace of the running script") }</li>
-            </ul>
-          </div>
-          <div class="parameterTableCnt">
-            <table class="parameterTable" data-bind="visible: currentScript().resources().length == 0">
-              <tr>
-                <td>
-                  ${ _('There are currently no defined resources.') }
-                  <button class="btn" data-bind="click: currentScript().addResource" style="margin-left: 4px">
-                    <i class="fa fa-plus"></i> ${ _('Add') }
-                  </button>
-                </td>
-              </tr>
-            </table>
-            <table data-bind="css: {'parameterTable': currentScript().resources().length > 0}">
-              <thead data-bind="visible: currentScript().resources().length > 0">
-                <tr>
-                  <th>${ _('Type') }</th>
-                  <th>${ _('Value') }</th>
-                  <th>&nbsp;</th>
-                </tr>
-              </thead>
-              <tbody data-bind="foreach: currentScript().resources">
+            <h4>${ _('Resources') } &nbsp; <i id="resources-dyk" class="fa fa-question-circle"></i></h4>
+            <div id="resources-dyk-content" class="hide">
+              <ul style="text-align: left;">
+                <li>${ _("Path to a HDFS file or zip file to add to the workspace of the running script") }</li>
+              </ul>
+            </div>
+            <div class="parameterTableCnt">
+              <table class="parameterTable" data-bind="visible: currentScript().resources().length == 0">
                 <tr>
                   <td>
-                    <select type="text" data-bind="value: type" class="input-xlarge">
-                      ##<option value="udf">${ _('UDF') }</option>
-                      <option value="file">${ _('File') }</option>
-                      <option value="archive">${ _('Archive') }</option>
-                    </select>
-                  </td>
-                  <td>
-                    <div class="input-append">
-                      <input type="text" data-bind="value: value" class="input-xxlarge" />
-                      <button class="btn fileChooserBtn" data-bind="click: $root.showFileChooser">..</button>
-                    </div>
-                  </td>
-                  <td>
-                    <button data-bind="click: viewModel.currentScript().removeResource" class="btn">
-                    <i class="fa fa-trash-o"></i> ${ _('Remove') }</button>
-                  </td>
-                </tr>
-              </tbody>
-              <tfoot data-bind="visible: currentScript().resources().length > 0">
-                <tr>
-                  <td colspan="3">
-                    <button class="btn" data-bind="click: currentScript().addResource"><i class="fa fa-plus"></i> ${ _('Add') }</button>
+                    ${ _('There are currently no defined resources.') }
+                    <button class="btn" data-bind="click: currentScript().addResource" style="margin-left: 4px">
+                      <i class="fa fa-plus"></i> ${ _('Add') }
+                    </button>
                   </td>
                 </tr>
-              </tfoot>
-            </table>
-          </div>
-        </form>
-      </div>
+              </table>
+              <table data-bind="css: {'parameterTable': currentScript().resources().length > 0}">
+                <thead data-bind="visible: currentScript().resources().length > 0">
+                  <tr>
+                    <th>${ _('Type') }</th>
+                    <th>${ _('Value') }</th>
+                    <th>&nbsp;</th>
+                  </tr>
+                </thead>
+                <tbody data-bind="foreach: currentScript().resources">
+                  <tr>
+                    <td>
+                      <select type="text" data-bind="value: type" class="input-xlarge">
+                        ##<option value="udf">${ _('UDF') }</option>
+                        <option value="file">${ _('File') }</option>
+                        <option value="archive">${ _('Archive') }</option>
+                      </select>
+                    </td>
+                    <td>
+                      <div class="input-append">
+                        <input type="text" data-bind="value: value" class="input-xxlarge" />
+                        <button class="btn fileChooserBtn" data-bind="click: $root.showFileChooser">..</button>
+                      </div>
+                    </td>
+                    <td>
+                      <button data-bind="click: viewModel.currentScript().removeResource" class="btn">
+                      <i class="fa fa-trash-o"></i> ${ _('Remove') }</button>
+                    </td>
+                  </tr>
+                </tbody>
+                <tfoot data-bind="visible: currentScript().resources().length > 0">
+                  <tr>
+                    <td colspan="3">
+                      <button class="btn" data-bind="click: currentScript().addResource"><i class="fa fa-plus"></i> ${ _('Add') }</button>
+                    </td>
+                  </tr>
+                </tfoot>
+              </table>
+            </div>
+          </form>
+        </div>
 
-      <div id="logs" class="section hide">
-          <div class="alert alert-info">
-            <a class="mainAction" href="#" title="${ _('Stop this script') }" data-bind="click: showStopModal, visible: currentScript().isRunning()"><i class="fa fa-stop"></i></a>
-            <h3><span data-bind="text: currentScript().name"></span></h3>
-          </div>
-          <div data-bind="template: {name: 'logTemplate', foreach: currentScript().actions}"></div>
-          <script id="logTemplate" type="text/html">
-            <div data-bind="css:{'alert-modified': name != '', 'alert': name != '', 'alert-success': (status == 'SUCCEEDED' || status == 'OK') && isReallyDone, 'alert-error': status != 'RUNNING' && status != 'SUCCEEDED' && status != 'OK' && status != 'PREP' && status != 'SUSPENDED'}">
-              <div class="pull-right">
-                  ${ _('Status:') } <a data-bind="text: status, visible: absoluteUrl != '', attr: {'href': absoluteUrl}" target="_blank"/> <i class="fa fa-share"></i>
-              </div>
-              <h4>${ _('Progress:') } <span data-bind="text: progress"></span>${ _('%') }</h4>
-              <div data-bind="css: {'progress': name != '', 'progress-striped': name != '', 'active': status == 'RUNNING'}" style="margin-top:10px">
-                <div data-bind="css: {'bar': name != '', 'bar-success': (status == 'SUCCEEDED' || status == 'OK') && isReallyDone, 'bar-warning': status == 'RUNNING' || status == 'PREP' || !isReallyDone, 'bar-danger': status != 'RUNNING' && status != 'SUCCEEDED' && status != 'OK' && status != 'PREP' && status != 'SUSPENDED'}, attr: {'style': 'width:' + progressPercent}"></div>
-              </div>
+        <div id="logs" class="section hide">
+            <div class="alert alert-info">
+              <a class="mainAction" href="#" title="${ _('Stop this script') }" data-bind="click: showStopModal, visible: currentScript().isRunning()"><i class="fa fa-stop"></i></a>
+              <h3><span data-bind="text: currentScript().name"></span></h3>
             </div>
-          </script>
-          <pre id="withoutLogs">${ _('No available logs.') } <img src="/static/art/spinner.gif" data-bind="visible: currentScript().isRunning()"/></pre>
-          <pre id="withLogs" class="hide scroll"></pre>
+            <div data-bind="template: {name: 'logTemplate', foreach: currentScript().actions}"></div>
+            <script id="logTemplate" type="text/html">
+              <div data-bind="css:{'alert-modified': name != '', 'alert': name != '', 'alert-success': (status == 'SUCCEEDED' || status == 'OK') && isReallyDone, 'alert-error': status != 'RUNNING' && status != 'SUCCEEDED' && status != 'OK' && status != 'PREP' && status != 'SUSPENDED'}">
+                <div class="pull-right">
+                    ${ _('Status:') } <a data-bind="text: status, visible: absoluteUrl != '', attr: {'href': absoluteUrl}" target="_blank"/> <i class="fa fa-share"></i>
+                </div>
+                <h4>${ _('Progress:') } <span data-bind="text: progress"></span>${ _('%') }</h4>
+                <div data-bind="css: {'progress': name != '', 'progress-striped': name != '', 'active': status == 'RUNNING'}" style="margin-top:10px">
+                  <div data-bind="css: {'bar': name != '', 'bar-success': (status == 'SUCCEEDED' || status == 'OK') && isReallyDone, 'bar-warning': status == 'RUNNING' || status == 'PREP' || !isReallyDone, 'bar-danger': status != 'RUNNING' && status != 'SUCCEEDED' && status != 'OK' && status != 'PREP' && status != 'SUSPENDED'}, attr: {'style': 'width:' + progressPercent}"></div>
+                </div>
+              </div>
+            </script>
+            <pre id="withoutLogs">${ _('No available logs.') } <img src="/static/art/spinner.gif" data-bind="visible: currentScript().isRunning()"/></pre>
+            <pre id="withLogs" class="hide scroll"></pre>
+          </div>
         </div>
-      </div>
-      </div>
-  </div>
+        </div>
+    </div>
 
-  <div id="dashboard" class="row-fluid mainSection hide">
+    <div id="dashboard" class="row-fluid mainSection hide">
 
-    <div class="card card-small">
-      <h2 class="card-heading simple">${ _('Running') }</h2>
-      <div class="card-body">
-        <p>
-        <div class="alert alert-info" data-bind="visible: runningScripts().length == 0" style="margin-bottom:0">
-          ${_('There are currently no running scripts.')}
+      <div class="card card-small">
+        <h2 class="card-heading simple">${ _('Running') }</h2>
+        <div class="card-body">
+          <p>
+          <div class="alert alert-info" data-bind="visible: runningScripts().length == 0" style="margin-bottom:0">
+            ${_('There are currently no running scripts.')}
+          </div>
+          <table class="table table-striped table-condensed datatables tablescroller-disable" data-bind="visible: runningScripts().length > 0">
+            <thead>
+            <tr>
+              <th width="20%">${_('Name')}</th>
+              <th width="40%">${_('Progress')}</th>
+              <th>${_('Created on')}</th>
+              <th width="30">&nbsp;</th>
+            </tr>
+            </thead>
+            <tbody data-bind="template: {name: 'runningTemplate', foreach: runningScripts}">
+
+            </tbody>
+          </table>
+          </p>
         </div>
-        <table class="table table-striped table-condensed datatables tablescroller-disable" data-bind="visible: runningScripts().length > 0">
-          <thead>
-          <tr>
-            <th width="20%">${_('Name')}</th>
-            <th width="40%">${_('Progress')}</th>
-            <th>${_('Created on')}</th>
-            <th width="30">&nbsp;</th>
-          </tr>
-          </thead>
-          <tbody data-bind="template: {name: 'runningTemplate', foreach: runningScripts}">
-
-          </tbody>
-        </table>
-        </p>
       </div>
-    </div>
 
-    <div class="card card-small">
-      <h2 class="card-heading simple">${ _('Completed') }</h2>
-      <div class="card-body">
-        <p>
-        <div class="alert alert-info" data-bind="visible: completedScripts().length == 0">
-          ${_('There are currently no completed scripts.')}
+      <div class="card card-small">
+        <h2 class="card-heading simple">${ _('Completed') }</h2>
+        <div class="card-body">
+          <p>
+          <div class="alert alert-info" data-bind="visible: completedScripts().length == 0">
+            ${_('There are currently no completed scripts.')}
+          </div>
+          <table class="table table-striped table-condensed datatables tablescroller-disable" data-bind="visible: completedScripts().length > 0">
+            <thead>
+            <tr>
+              <th width="20%">${_('Name')}</th>
+              <th width="40%">${_('Status')}</th>
+              <th>${_('Created on')}</th>
+            </tr>
+            </thead>
+            <tbody data-bind="template: {name: 'completedTemplate', foreach: completedScripts}">
+
+            </tbody>
+          </table>
+          </p>
         </div>
-        <table class="table table-striped table-condensed datatables tablescroller-disable" data-bind="visible: completedScripts().length > 0">
-          <thead>
-          <tr>
-            <th width="20%">${_('Name')}</th>
-            <th width="40%">${_('Status')}</th>
-            <th>${_('Created on')}</th>
-          </tr>
-          </thead>
-          <tbody data-bind="template: {name: 'completedTemplate', foreach: completedScripts}">
-
-          </tbody>
-        </table>
-        </p>
       </div>
-    </div>
 
-    <script id="runningTemplate" type="text/html">
-      <tr style="cursor: pointer">
-        <td data-bind="click: $root.viewSubmittedScript" title="${_('Click to edit')}">
-          <strong><a data-bind="text: appName"></a></strong>
-        </td>
-        <td>
-          <div data-bind="css: {'progress': appName != '', 'progress-striped': appName != '', 'active': status == 'RUNNING'}">
-            <div data-bind="css: {'bar': appName != '', 'bar-success': status == 'SUCCEEDED' || status == 'OK', 'bar-warning': status == 'RUNNING' || status == 'PREP' || status == 'SUSPENDED', 'bar-danger': status != 'RUNNING' && status != 'SUCCEEDED' && status != 'OK' && status != 'PREP' && status != 'SUSPENDED'}, attr: {'style': 'width:' + progressPercent}"></div>
-          </div>
-        </td>
-        <td data-bind="text: created"></td>
-        <td data-bind="click: $root.showLogs"><i class="fa fa-tasks"></i></td>
-      </tr>
-    </script>
-
-    <script id="completedTemplate" type="text/html">
-      <tr style="cursor: pointer" data-bind="click: $root.viewSubmittedScript" title="${_('Click to view')}">
-        <td>
-          <strong><a data-bind="text: appName"></a></strong>
-        </td>
-        <td>
-          <span data-bind="attr: {'class': statusClass}, text: status"></span>
-        </td>
-        <td data-bind="text: created"></td>
-      </tr>
-    </script>
+      <script id="runningTemplate" type="text/html">
+        <tr style="cursor: pointer">
+          <td data-bind="click: $root.viewSubmittedScript" title="${_('Click to edit')}">
+            <strong><a data-bind="text: appName"></a></strong>
+          </td>
+          <td>
+            <div data-bind="css: {'progress': appName != '', 'progress-striped': appName != '', 'active': status == 'RUNNING'}">
+              <div data-bind="css: {'bar': appName != '', 'bar-success': status == 'SUCCEEDED' || status == 'OK', 'bar-warning': status == 'RUNNING' || status == 'PREP' || status == 'SUSPENDED', 'bar-danger': status != 'RUNNING' && status != 'SUCCEEDED' && status != 'OK' && status != 'PREP' && status != 'SUSPENDED'}, attr: {'style': 'width:' + progressPercent}"></div>
+            </div>
+          </td>
+          <td data-bind="text: created"></td>
+          <td data-bind="click: $root.showLogs"><i class="fa fa-tasks"></i></td>
+        </tr>
+      </script>
+
+      <script id="completedTemplate" type="text/html">
+        <tr style="cursor: pointer" data-bind="click: $root.viewSubmittedScript" title="${_('Click to view')}">
+          <td>
+            <strong><a data-bind="text: appName"></a></strong>
+          </td>
+          <td>
+            <span data-bind="attr: {'class': statusClass}, text: status"></span>
+          </td>
+          <td data-bind="text: created"></td>
+        </tr>
+      </script>
+    </div>
   </div>
-</div>
 
 
-<div id="deleteModal" class="modal hide fade">
-  <div class="modal-header">
-    <a href="#" class="close" data-dismiss="modal">&times;</a>
-    <h3>${_('Confirm Delete')}</h3>
-  </div>
-  <div class="modal-body">
-    <p class="deleteMsg hide single">${_('Are you sure you want to delete this script?')}</p>
-    <p class="deleteMsg hide multiple">${_('Are you sure you want to delete these scripts?')}</p>
-  </div>
-  <div class="modal-footer">
-    <a class="btn" data-dismiss="modal">${_('No')}</a>
-    <a class="btn btn-danger" data-bind="click: deleteScripts">${_('Yes')}</a>
+  <div id="deleteModal" class="modal hide fade">
+    <div class="modal-header">
+      <a href="#" class="close" data-dismiss="modal">&times;</a>
+      <h3>${_('Confirm Delete')}</h3>
+    </div>
+    <div class="modal-body">
+      <p class="deleteMsg hide single">${_('Are you sure you want to delete this script?')}</p>
+      <p class="deleteMsg hide multiple">${_('Are you sure you want to delete these scripts?')}</p>
+    </div>
+    <div class="modal-footer">
+      <a class="btn" data-dismiss="modal">${_('No')}</a>
+      <a class="btn btn-danger" data-bind="click: deleteScripts">${_('Yes')}</a>
+    </div>
   </div>
-</div>
 
-<div id="logsModal" class="modal hide fade">
-  <div class="modal-header">
-    <a href="#" class="close" data-dismiss="modal">&times;</a>
-    <h3>${_('Logs')}</h3>
-  </div>
-  <div class="modal-body">
-    <img src="/static/art/spinner.gif" class="hide" />
-    <pre class="scroll hide"></pre>
-  </div>
-  <div class="modal-footer">
-    <a class="btn" data-dismiss="modal">${_('Close')}</a>
+  <div id="logsModal" class="modal hide fade">
+    <div class="modal-header">
+      <a href="#" class="close" data-dismiss="modal">&times;</a>
+      <h3>${_('Logs')}</h3>
+    </div>
+    <div class="modal-body">
+      <img src="/static/art/spinner.gif" class="hide" />
+      <pre class="scroll hide"></pre>
+    </div>
+    <div class="modal-footer">
+      <a class="btn" data-dismiss="modal">${_('Close')}</a>
+    </div>
   </div>
-</div>
 
-<div id="submitModal" class="modal hide fade">
-  <div class="modal-header">
-    <a href="#" class="close" data-dismiss="modal">&times;</a>
-    <h3>${_('Run Script')} '<span data-bind="text: currentScript().name"></span>' ${_('?')}</h3>
-  </div>
-  <div class="modal-body" data-bind="visible: submissionVariables().length > 0">
-    <legend style="color:#666">${_('Script variables')}</legend>
-    <div data-bind="foreach: submissionVariables" style="margin-bottom: 20px">
-      <div class="row-fluid">
-        <span data-bind="text: name" class="span3"></span>
-        <input type="text" data-bind="value: value" class="span9" />
+  <div id="submitModal" class="modal hide fade">
+    <div class="modal-header">
+      <a href="#" class="close" data-dismiss="modal">&times;</a>
+      <h3>${_('Run Script')} '<span data-bind="text: currentScript().name"></span>' ${_('?')}</h3>
+    </div>
+    <div class="modal-body" data-bind="visible: submissionVariables().length > 0">
+      <legend style="color:#666">${_('Script variables')}</legend>
+      <div data-bind="foreach: submissionVariables" style="margin-bottom: 20px">
+        <div class="row-fluid">
+          <span data-bind="text: name" class="span3"></span>
+          <input type="text" data-bind="value: value" class="span9" />
+        </div>
       </div>
     </div>
+    <div class="modal-footer">
+      <a class="btn" data-dismiss="modal">${_('No')}</a>
+      <a id="runScriptBtn" class="btn btn-danger disable-feedback" data-bind="click: runScript">${_('Yes')}</a>
+    </div>
   </div>
-  <div class="modal-footer">
-    <a class="btn" data-dismiss="modal">${_('No')}</a>
-    <a id="runScriptBtn" class="btn btn-danger disable-feedback" data-bind="click: runScript">${_('Yes')}</a>
-  </div>
-</div>
 
-<div id="stopModal" class="modal hide fade">
-  <div class="modal-header">
-    <a href="#" class="close" data-dismiss="modal">&times;</a>
-    <h3>${_('Stop Script')} '<span data-bind="text: currentScript().name"></span>' ${_('?')}</h3>
+  <div id="stopModal" class="modal hide fade">
+    <div class="modal-header">
+      <a href="#" class="close" data-dismiss="modal">&times;</a>
+      <h3>${_('Stop Script')} '<span data-bind="text: currentScript().name"></span>' ${_('?')}</h3>
+    </div>
+    <div class="modal-footer">
+      <a class="btn" data-dismiss="modal">${_('No')}</a>
+      <a id="stopScriptBtn" class="btn btn-danger disable-feedback" data-bind="click: stopScript">${_('Yes')}</a>
+    </div>
   </div>
-  <div class="modal-footer">
-    <a class="btn" data-dismiss="modal">${_('No')}</a>
-    <a id="stopScriptBtn" class="btn btn-danger disable-feedback" data-bind="click: stopScript">${_('Yes')}</a>
+
+  <div id="chooseFile" class="modal hide fade">
+      <div class="modal-header">
+          <a href="#" class="close" data-dismiss="modal">&times;</a>
+          <h3>${_('Choose a file')}</h3>
+      </div>
+      <div class="modal-body">
+          <div id="filechooser">
+          </div>
+      </div>
+      <div class="modal-footer">
+      </div>
   </div>
-</div>
 
-<div id="chooseFile" class="modal hide fade">
+  <div id="confirmModal" class="modal hide fade">
     <div class="modal-header">
-        <a href="#" class="close" data-dismiss="modal">&times;</a>
-        <h3>${_('Choose a file')}</h3>
+      <a href="#" class="close" data-dismiss="modal">&times;</a>
+      <h3>${_('Are you sure?')}</h3>
     </div>
     <div class="modal-body">
-        <div id="filechooser">
-        </div>
+      <p>
+        ${_('The current script has unsaved changes. Are you sure you want to discard the changes?')}
+      </p>
     </div>
     <div class="modal-footer">
+      <a class="btn" data-dismiss="modal">${_('No')}</a>
+      <a class="btn btn-danger disable-feedback" data-bind="click: confirmScript">${_('Yes')}</a>
     </div>
-</div>
-
-<div id="confirmModal" class="modal hide fade">
-  <div class="modal-header">
-    <a href="#" class="close" data-dismiss="modal">&times;</a>
-    <h3>${_('Are you sure?')}</h3>
   </div>
-  <div class="modal-body">
-    <p>
-      ${_('The current script has unsaved changes. Are you sure you want to discard the changes?')}
-    </p>
-  </div>
-  <div class="modal-footer">
-    <a class="btn" data-dismiss="modal">${_('No')}</a>
-    <a class="btn btn-danger disable-feedback" data-bind="click: confirmScript">${_('Yes')}</a>
-  </div>
-</div>
 
-<div id="nameModal" class="modal hide fade">
-  <div class="modal-header">
-    <a href="#" class="close" data-dismiss="modal">&times;</a>
-    <h3>${_('Save script')}</h3>
-  </div>
-  <div class="modal-body">
-    <p>
-      ${_('Give a meaningful name to this script.')}<br/><br/>
-      <label>
-        ${ _('Script name') } &nbsp;
-        <input type="text" class="input-xlarge" data-bind="value: currentScript().name, valueUpdate:'afterkeydown'" />
-      </label>
-    </p>
-  </div>
-  <div class="modal-footer">
-    <a class="btn" data-dismiss="modal">${_('Cancel')}</a>
-    <button class="btn btn-primary disable-feedback" data-bind="click: saveScript, enable: currentScript().name() != '' && currentScript().name() != $root.LABELS.NEW_SCRIPT_NAME">${_('Save')}</button>
+  <div id="nameModal" class="modal hide fade">
+    <div class="modal-header">
+      <a href="#" class="close" data-dismiss="modal">&times;</a>
+      <h3>${_('Save script')}</h3>
+    </div>
+    <div class="modal-body">
+      <p>
+        ${_('Give a meaningful name to this script.')}<br/><br/>
+        <label>
+          ${ _('Script name') } &nbsp;
+          <input type="text" class="input-xlarge" data-bind="value: currentScript().name, valueUpdate:'afterkeydown'" />
+        </label>
+      </p>
+    </div>
+    <div class="modal-footer">
+      <a class="btn" data-dismiss="modal">${_('Cancel')}</a>
+      <button class="btn btn-primary disable-feedback" data-bind="click: saveScript, enable: currentScript().name() != '' && currentScript().name() != $root.LABELS.NEW_SCRIPT_NAME">${_('Save')}</button>
+    </div>
   </div>
 </div>
 
+${ commonshare() | n,unicode }
 
 <div class="bottomAlert alert"></div>
 
 <script src="/static/ext/js/knockout-min.js" type="text/javascript" charset="utf-8"></script>
+<script src="/static/ext/js/knockout.mapping-2.3.2.js" type="text/javascript" charset="utf-8"></script>
 <script src="/pig/static/js/utils.js" type="text/javascript" charset="utf-8"></script>
 <script src="/pig/static/js/pig.ko.js" type="text/javascript" charset="utf-8"></script>
+<script src="/static/js/share.vm.js" type="text/javascript" charset="utf-8"></script>
+
 <script src="/static/ext/js/routie-0.3.0.min.js" type="text/javascript" charset="utf-8"></script>
 <script src="/static/ext/js/codemirror-3.11.js"></script>
 <script src="/static/js/codemirror-pig.js"></script>
@@ -764,15 +775,23 @@ ${ commonheader(None, "pig", user) | n,unicode }
     deleteUrl: "${ url('pig:delete') }"
   }
 
-  var viewModel = new PigViewModel(appProperties);
-  ko.applyBindings(viewModel);
-
   var HIVE_AUTOCOMPLETE_BASE_URL = "${ autocomplete_base_url | n,unicode }";
   var HIVE_AUTOCOMPLETE_FAILS_SILENTLY_ON = [503]; // error codes from beeswax/views.py - autocomplete
   var HIVE_AUTOCOMPLETE_USER = "${ user }";
 
   var codeMirror;
 
+  var viewModel = new PigViewModel(appProperties);
+  ko.applyBindings(viewModel, $("#pig-editor-app")[0]);
+  var shareViewModel = setupSharing("#documentShareModal");
+
+  function tryShareQuery() {
+    if (viewModel.currentScript().docId() != -1) {
+      shareViewModel.setDocId(viewModel.currentScript().docId())
+      $("#documentShareModal").modal("show");
+    }
+  }
+
   $(document).ready(function () {
     // initialize navigator
     function showNavigator() {
diff --git a/apps/pig/src/pig/views.py b/apps/pig/src/pig/views.py
index c8ad9b1..400289b 100644
--- a/apps/pig/src/pig/views.py
+++ b/apps/pig/src/pig/views.py
@@ -80,6 +80,7 @@ def save(request):
 
   response = {
     'id': pig_script.id,
+    'docId': pig_script.doc.get().id
   }
 
   return HttpResponse(json.dumps(response), content_type="text/plain")
@@ -167,6 +168,7 @@ def copy(request):
 
   response = {
     'id': script_copy.id,
+    'docId': copy_doc.id,
     'name': name,
     'script': script,
     'parameters': parameters,
diff --git a/apps/pig/static/js/pig.ko.js b/apps/pig/static/js/pig.ko.js
index 45c550b..8ee7930 100644
--- a/apps/pig/static/js/pig.ko.js
+++ b/apps/pig/static/js/pig.ko.js
@@ -35,6 +35,7 @@ var PigScript = function (pigScript) {
   var self = this;
 
   self.id = ko.observable(pigScript.id);
+  self.docId = ko.observable(pigScript.docId);
   self.isDesign = ko.observable(pigScript.isDesign);
   self.name = ko.observable(pigScript.name);
   self.can_write = ko.observable(pigScript.can_write);
@@ -201,6 +202,7 @@ var PigViewModel = function (props) {
 
   var _defaultScript = {
     id: -1,
+    docId: -1,
     name: self.LABELS.NEW_SCRIPT_NAME,
     script: self.LABELS.NEW_SCRIPT_CONTENT,
     parameters: self.LABELS.NEW_SCRIPT_PARAMETERS,
@@ -489,6 +491,11 @@ var PigViewModel = function (props) {
     });
   }
 
+  function updateScript(script, data) {
+    script.id(data.id);
+    script.docId(data.docId);
+  }
+
   function callSave(script) {
     $(document).trigger("saving");
     $.post(self.SAVE_URL,
@@ -501,9 +508,9 @@ var PigViewModel = function (props) {
           hadoopProperties: ko.toJSON(script.hadoopProperties()),
         },
         function (data) {
-          self.currentScript().id(data.id);
-          $(document).trigger("saved");
+          updateScript(self.currentScript(), data);
           self.updateScripts();
+          $(document).trigger("saved");
         }, "json").fail( function(xhr, textStatus, errorThrown) {
           $(document).trigger("error", xhr.responseText);
         });
@@ -529,7 +536,7 @@ var PigViewModel = function (props) {
         },
         function (data) {
           if (data.id && self.currentScript().id() != data.id){
-            script.id(data.id);
+            updateScript(self.currentScript(), data);
             $(document).trigger("loadEditor");
           }
           script.isRunning(true);
diff --git a/apps/rdbms/src/rdbms/templates/execute.mako b/apps/rdbms/src/rdbms/templates/execute.mako
index 6650a20..d5b4cc7 100644
--- a/apps/rdbms/src/rdbms/templates/execute.mako
+++ b/apps/rdbms/src/rdbms/templates/execute.mako
@@ -14,7 +14,7 @@
 ## See the License for the specific language governing permissions and
 ## limitations under the License.
 <%!
-  from desktop.views import commonheader, commonfooter
+  from desktop.views import commonheader, commonfooter, commonshare
   from django.utils.translation import ugettext as _
 %>
 
@@ -24,174 +24,179 @@ ${ commonheader(_('Query'), app_name, user) | n,unicode }
 
 <%common:navbar></%common:navbar>
 
-<div class="container-fluid">
-  <div class="row-fluid">
-    <div class="span2" id="navigator">
-      <ul class="nav nav-tabs" style="margin-bottom: 0">
-        <li class="active"><a href="#navigatorTab" data-toggle="tab" class="sidetab">${ _('Assist') }</a></li>
-      </ul>
-
-      <div class="tab-content">
-    <div class="tab-pane active" id="navigatorTab">
-      <div class="card card-small card-tab" style="min-height: 470px;">
-        <div class="card-body" style="margin-top: 0">
-          <a href="#" title="${_('Double click on a table name or field to insert it in the editor')}" rel="tooltip" data-placement="left" class="pull-right" style="margin:10px;margin-left: 0"><i class="fa fa-question-circle"></i></a>
-          <a id="refreshNavigator" href="#" title="${_('Manually refresh the table list')}" rel="tooltip" data-placement="left" class="pull-right" style="margin:10px"><i class="fa fa-refresh"></i></a>
-
-          <ul class="nav nav-list" style="border: none; padding: 0; background-color: #FFF">
-            <li class="nav-header">${_('server')}</li>
-          </ul>
-
-          <select data-bind="options: $root.servers, value: $root.chosenServer, optionsText: 'nice_name'" class="input-medium chosen-select chosen-server" data-placeholder="${_('Choose a database...')}"></select>
-
-          <ul class="nav nav-list" style="border: none; padding: 0; background-color: #FFF">
-            <li class="nav-header">${_('database')}</li>
-          </ul>
-
-          <select data-bind="options: $root.databases, value: $root.chosenDatabase" class="input-medium chosen-select chosen-db" data-placeholder="${_('Choose a database...')}"></select>
-
-          <input id="navigatorSearch" type="text" placeholder="${ _('Table name...') }" style="width:90%; margin-top: 20px"/>
-          <div id="navigatorNoTables" style="margin-top: 20px">${_('The selected database has no tables.')}</div>
-          <ul id="navigatorTables" class="unstyled"></ul>
-          <div id="navigatorLoader">
-            <!--[if !IE]><!--><i class="fa fa-spinner fa-spin" style="font-size: 20px; color: #DDD"></i><!--<![endif]-->
-            <!--[if IE]><img src="/static/art/spinner.gif" /><![endif]-->
+<div id="rdbms-query-editor">
+  <div class="container-fluid">
+    <div class="row-fluid">
+      <div class="span2" id="navigator">
+        <ul class="nav nav-tabs" style="margin-bottom: 0">
+          <li class="active"><a href="#navigatorTab" data-toggle="tab" class="sidetab">${ _('Assist') }</a></li>
+        </ul>
+
+        <div class="tab-content">
+      <div class="tab-pane active" id="navigatorTab">
+        <div class="card card-small card-tab" style="min-height: 470px;">
+          <div class="card-body" style="margin-top: 0">
+            <a href="#" title="${_('Double click on a table name or field to insert it in the editor')}" rel="tooltip" data-placement="left" class="pull-right" style="margin:10px;margin-left: 0"><i class="fa fa-question-circle"></i></a>
+            <a id="refreshNavigator" href="#" title="${_('Manually refresh the table list')}" rel="tooltip" data-placement="left" class="pull-right" style="margin:10px"><i class="fa fa-refresh"></i></a>
+
+            <ul class="nav nav-list" style="border: none; padding: 0; background-color: #FFF">
+              <li class="nav-header">${_('server')}</li>
+            </ul>
+
+            <select data-bind="options: $root.servers, value: $root.chosenServer, optionsText: 'nice_name'" class="input-medium chosen-select chosen-server" data-placeholder="${_('Choose a database...')}"></select>
+
+            <ul class="nav nav-list" style="border: none; padding: 0; background-color: #FFF">
+              <li class="nav-header">${_('database')}</li>
+            </ul>
+
+            <select data-bind="options: $root.databases, value: $root.chosenDatabase" class="input-medium chosen-select chosen-db" data-placeholder="${_('Choose a database...')}"></select>
+
+            <input id="navigatorSearch" type="text" placeholder="${ _('Table name...') }" style="width:90%; margin-top: 20px"/>
+            <div id="navigatorNoTables" style="margin-top: 20px">${_('The selected database has no tables.')}</div>
+            <ul id="navigatorTables" class="unstyled"></ul>
+            <div id="navigatorLoader">
+              <!--[if !IE]><!--><i class="fa fa-spinner fa-spin" style="font-size: 20px; color: #DDD"></i><!--<![endif]-->
+              <!--[if IE]><img src="/static/art/spinner.gif" /><![endif]-->
+            </div>
           </div>
         </div>
       </div>
-    </div>
 
-  </div>
+    </div>
 
 
-    </div>
+      </div>
 
-    <div class="span10">
-      <div id="query">
-        <div class="card card-small">
-          <div style="margin-bottom: 10px">
-            <h1 class="card-heading simple">
-              <a id="collapse-editor" href="javascript:void(0)" class="pull-right"><i class="fa fa-caret-up"></i></a>
-              ${ _('Query Editor') }
-              % if can_edit_name:
-                :
-                <a href="javascript:void(0);"
-                   id="query-name"
-                   data-type="text"
-                   data-name="name"
-                   data-value="${design.name}"
-                   data-original-title="${ _('Query name') }"
-                   data-placement="right">
-                </a>
-              %endif
-            </h1>
-            % if can_edit_name:
-              <p style="margin-left: 20px">
-                <a href="javascript:void(0);"
-                   id="query-description"
-                   data-type="textarea"
-                   data-name="description"
-                   data-value="${design.desc}"
-                   data-original-title="${ _('Query description') }"
-                   data-placement="right">
-                </a>
-              </p>
-            % endif
-          </div>
-          <div class="card-body">
-            <div class="tab-content">
-              <div id="queryPane">
-
-                <div data-bind="css: {'hide': query.errors().length == 0}" class="hide alert alert-error">
-                  <p><strong>${_('Your query has the following error(s):')}</strong></p>
-                  <div data-bind="foreach: { 'data': query.errors, 'afterRender': resizeTable }">
-                    <p data-bind="text: $data" class="queryErrorMessage"></p>
+      <div class="span10">
+        <div id="query">
+          <div class="card card-small">
+            <div style="margin-bottom: 10px">
+              <h1 class="card-heading simple">
+                <a id="collapse-editor" href="javascript:void(0)" class="pull-right"><i class="fa fa-caret-up"></i></a>
+                % if can_edit_name:
+
+                  <a class="share-link" rel="tooltip" data-placement="bottom" style="padding-left:10px; padding-right: 10px" data-bind="click: openShareModal,
+                    attr: {'data-original-title': '${ _("Share") } '+name},
+                    css: {'baseShared': true, 'isShared': isShared()}">
+                    <i class="fa fa-users"></i>
+                  </a>
+                  <a href="javascript:void(0);"
+                     id="query-name"
+                     data-type="text"
+                     data-name="name"
+                     data-value="${design.name}"
+                     data-original-title="${ _('Query name') }"
+                     data-placement="right">
+                  </a>
+                  <a href="javascript:void(0);"
+                     id="query-description"
+                     data-type="textarea"
+                     data-name="description"
+                     data-value="${design.desc}"
+                     data-original-title="${ _('Query description') }"
+                     data-placement="right" style="font-size: 14px; margin-left: 10px">
+                  </a>
+              </h1>
+              % endif
+            </div>
+            <div class="card-body">
+              <div class="tab-content">
+                <div id="queryPane">
+
+                  <div data-bind="css: {'hide': query.errors().length == 0}" class="hide alert alert-error">
+                    <p><strong>${_('Your query has the following error(s):')}</strong></p>
+                    <div data-bind="foreach: { 'data': query.errors, 'afterRender': resizeTable }">
+                      <p data-bind="text: $data" class="queryErrorMessage"></p>
+                    </div>
                   </div>
-                </div>
 
-                <textarea class="hide" tabindex="1" name="query" id="queryField"></textarea>
+                  <textarea class="hide" tabindex="1" name="query" id="queryField"></textarea>
 
-                <div class="actions">
-                  <button data-bind="click: tryExecuteQuery" type="button" id="executeQuery" class="btn btn-primary disable-feedback" tabindex="2">${_('Execute')}</button>
-                  <button data-bind="click: trySaveQuery, css: {'hide': !$root.query.id() || $root.query.id() == -1}" type="button" class="btn hide">${_('Save')}</button>
-                  <button data-bind="click: trySaveAsQuery" type="button" class="btn">${_('Save as...')}</button>
-                  <button data-bind="click: tryExplainQuery" type="button" id="explainQuery" class="btn">${_('Explain')}</button>
-                  &nbsp; ${_('or create a')} &nbsp;<a type="button" class="btn" href="${ url('rdbms:execute_query') }">${_('New query')}</a>
-                  <br /><br />
-              </div>
+                  <div class="actions">
+                    <button data-bind="click: tryExecuteQuery" type="button" id="executeQuery" class="btn btn-primary disable-feedback" tabindex="2">${_('Execute')}</button>
+                    <button data-bind="click: trySaveQuery, css: {'hide': !$root.query.id() || $root.query.id() == -1}" type="button" class="btn hide">${_('Save')}</button>
+                    <button data-bind="click: trySaveAsQuery" type="button" class="btn">${_('Save as...')}</button>
+                    <button data-bind="click: tryExplainQuery" type="button" id="explainQuery" class="btn">${_('Explain')}</button>
+                    &nbsp; ${_('or create a')} &nbsp;<a type="button" class="btn" href="${ url('rdbms:execute_query') }">${_('New query')}</a>
+                    <br /><br />
+                </div>
 
+                </div>
               </div>
             </div>
           </div>
         </div>
-      </div>
-      <div data-bind="css: {'hide': rows().length == 0}" class="hide">
-        <div class="card card-small scrollable">
-          <table id="resultTable" class="table table-striped table-condensed resultTable" cellpadding="0" cellspacing="0" data-tablescroller-min-height-disable="true" data-tablescroller-enforce-height="true">
-            <thead>
-              <tr data-bind="foreach: columns">
-                <th data-bind="text: $data"></th>
-              </tr>
-            </thead>
-          </table>
+        <div data-bind="css: {'hide': rows().length == 0}" class="hide">
+          <div class="card card-small scrollable">
+            <table id="resultTable" class="table table-striped table-condensed resultTable" cellpadding="0" cellspacing="0" data-tablescroller-min-height-disable="true" data-tablescroller-enforce-height="true">
+              <thead>
+                <tr data-bind="foreach: columns">
+                  <th data-bind="text: $data"></th>
+                </tr>
+              </thead>
+            </table>
+          </div>
         </div>
-      </div>
 
-      <div data-bind="css: {'hide': !resultsEmpty()}" class="hide">
-        <div class="card card-small scrollable">
-          <div class="row-fluid">
-            <div class="span10 offset1 center empty-wrapper">
-              <i class="fa fa-frown-o"></i>
-              <h1>${_('The server returned no results.')}</h1>
-              <br />
+        <div data-bind="css: {'hide': !resultsEmpty()}" class="hide">
+          <div class="card card-small scrollable">
+            <div class="row-fluid">
+              <div class="span10 offset1 center empty-wrapper">
+                <i class="fa fa-frown-o"></i>
+                <h1>${_('The server returned no results.')}</h1>
+                <br />
+              </div>
             </div>
           </div>
         </div>
-      </div>
 
-      <div data-bind="css: {'hide': !isExecuting()}" class="hide">
-        <div class="card card-small scrollable">
-          <div class="row-fluid">
-            <div class="span10 offset1 center" style="padding: 30px">
-              <!--[if !IE]><!--><i class="fa fa-spinner fa-spin" style="font-size: 60px; color: #DDD"></i><!--<![endif]-->
-              <!--[if IE]><img src="/static/art/spinner.gif" /><![endif]-->
+        <div data-bind="css: {'hide': !isExecuting()}" class="hide">
+          <div class="card card-small scrollable">
+            <div class="row-fluid">
+              <div class="span10 offset1 center" style="padding: 30px">
+                <!--[if !IE]><!--><i class="fa fa-spinner fa-spin" style="font-size: 60px; color: #DDD"></i><!--<![endif]-->
+                <!--[if IE]><img src="/static/art/spinner.gif" /><![endif]-->
+              </div>
             </div>
           </div>
         </div>
       </div>
-    </div>
 
+    </div>
   </div>
-</div>
 
 
-<div id="saveAsQueryModal" class="modal hide fade">
-  <div class="modal-header">
-    <a href="#" class="close" data-dismiss="modal">&times;</a>
-    <h3>${_('Save your query')}</h3>
-  </div>
-  <div class="modal-body">
-    <form class="form-horizontal">
-      <div class="control-group" id="saveas-query-name">
-        <label class="control-label">${_('Name')}</label>
-        <div class="controls">
-          <input data-bind="value: $root.query.name" type="text" class="input-xlarge">
+  <div id="saveAsQueryModal" class="modal hide fade">
+    <div class="modal-header">
+      <a href="#" class="close" data-dismiss="modal">&times;</a>
+      <h3>${_('Save your query')}</h3>
+    </div>
+    <div class="modal-body">
+      <form class="form-horizontal">
+        <div class="control-group" id="saveas-query-name">
+          <label class="control-label">${_('Name')}</label>
+          <div class="controls">
+            <input data-bind="value: $root.query.name" type="text" class="input-xlarge">
+          </div>
         </div>
-      </div>
-      <div class="control-group">
-        <label class="control-label">${_('Description')}</label>
-        <div class="controls">
-          <input data-bind="value: $root.query.description" type="text" class="input-xlarge">
+        <div class="control-group">
+          <label class="control-label">${_('Description')}</label>
+          <div class="controls">
+            <input data-bind="value: $root.query.description" type="text" class="input-xlarge">
+          </div>
         </div>
-      </div>
-    </form>
-  </div>
-  <div class="modal-footer">
-    <button class="btn" data-dismiss="modal">${_('Cancel')}</button>
-    <button data-bind="click: modalSaveAsQuery" class="btn btn-primary">${_('Save')}</button>
+      </form>
+    </div>
+    <div class="modal-footer">
+      <button class="btn" data-dismiss="modal">${_('Cancel')}</button>
+      <button data-bind="click: modalSaveAsQuery" class="btn btn-primary">${_('Save')}</button>
+    </div>
   </div>
 </div>
 
+${ commonshare() | n,unicode }
+
+
 
 <style type="text/css">
   h1 {
@@ -323,6 +328,7 @@ ${ commonheader(_('Query'), app_name, user) | n,unicode }
 <script src="/static/ext/js/knockout-min.js" type="text/javascript" charset="utf-8"></script>
 <script src="/static/ext/js/knockout.mapping-2.3.2.js" type="text/javascript" charset="utf-8"></script>
 <script src="/rdbms/static/js/rdbms.vm.js"></script>
+<script src="/static/js/share.vm.js"></script>
 <script src="/static/ext/js/codemirror-3.11.js"></script>
 <link rel="stylesheet" href="/static/ext/css/codemirror.css">
 <script src="/static/ext/js/codemirror-sql.js"></script>
@@ -666,6 +672,9 @@ ${ commonheader(_('Query'), app_name, user) | n,unicode }
 
   // Knockout
   viewModel = new RdbmsViewModel();
+  shareViewModel = setupSharing("#documentShareModal");
+  shareViewModel.setDocId(${doc_id});
+
   viewModel.fetchServers();
   viewModel.database.subscribe((function() {
     // First call skipped to avoid reset of hueRdbmsLastDatabase
@@ -697,7 +706,7 @@ ${ commonheader(_('Query'), app_name, user) | n,unicode }
 
     $("#executeQuery").button("reset");
   }
-  ko.applyBindings(viewModel);
+  ko.applyBindings(viewModel, $("#rdbms-query-editor")[0]);
 
   function resetNavigator() {
     renderNavigator();
diff --git a/apps/rdbms/src/rdbms/views.py b/apps/rdbms/src/rdbms/views.py
index 5308889..9d2408e 100644
--- a/apps/rdbms/src/rdbms/views.py
+++ b/apps/rdbms/src/rdbms/views.py
@@ -70,6 +70,7 @@ def execute_query(request, design_id=None, query_history_id=None):
 
   return render('execute.mako', request, {
     'action': action,
+    'doc_id': design.id and design.doc.get().id,
     'design': design,
     'autocomplete_base_url': reverse('rdbms:api_autocomplete_databases', kwargs={}),
     'can_edit_name': design.id and not design.is_auto,
diff --git a/desktop/core/src/desktop/api.py b/desktop/core/src/desktop/api.py
index 2a91e39..ca64353 100644
--- a/desktop/core/src/desktop/api.py
+++ b/desktop/core/src/desktop/api.py
@@ -124,6 +124,29 @@ def massaged_tags(tag, tag_doc_mapping):
     'docs': [doc.id for doc in tag_doc_mapping[tag]] # Could get with one request groupy
   }
 
+def massage_permissions(document):
+  """
+  Returns the permissions for a given document as a dictionary
+  """
+  read_perms = document.list_permissions(perm='read')
+  write_perms = document.list_permissions(perm='write')
+  return {
+    'perms': {
+        'read': {
+          'users': [{'id': perm_user.id, 'username': perm_user.username} \
+                     for perm_user in read_perms.users.all()],
+          'groups': [{'id': perm_group.id, 'name': perm_group.name} \
+                     for perm_group in read_perms.groups.all()]
+        },
+        'write': {
+          'users': [{'id': perm_user.id, 'username': perm_user.username} \
+                     for perm_user in write_perms.users.all()],
+          'groups': [{'id': perm_group.id, 'name': perm_group.name} \
+                     for perm_group in write_perms.groups.all()]
+        }
+      }
+    }
+
 def massaged_documents_for_json(documents, user):
   """
   var DOCUMENTS_DEFAULTS = {
@@ -162,65 +185,40 @@ def massaged_documents_for_json(documents, user):
     except:
       # If app of document is disabled
       url = ''
-    read_perms = document.list_permissions(perm='read')
-    write_perms = document.list_permissions(perm='write')
-    docs[document.id] = {
-      'id': document.id,
-      'contentType': html.conditional_escape(document.content_type.name),
-      'icon': document.icon,
-      'name': html.conditional_escape(document.name),
-      'url': html.conditional_escape(url),
-      'description': html.conditional_escape(document.description),
-      'tags': [{'id': tag.id, 'name': html.conditional_escape(tag.tag)} \
-               for tag in document.tags.all()],
-      'perms': {
-        'read': {
-          'users': [{'id': perm_user.id, 'username': perm_user.username} \
-                    for perm_user in read_perms.users.all().only('id', 'username')],
-          'groups': [{'id': perm_group.id, 'name': perm_group.name} \
-                     for perm_group in read_perms.groups.all().only('id', 'name')]
-        },
-        'write': {
-          'users': [{'id': perm_user.id, 'username': perm_user.username} for perm_user in write_perms.users.all()],
-          'groups': [{'id': perm_group.id, 'name': perm_group.name} for perm_group in write_perms.groups.all()]
-        }
-      },
-      'owner': document.owner.username,
-      'isMine': document.owner == user,
-      'lastModified': document.last_modified.strftime("%x %X"),
-      'lastModifiedInMillis': time.mktime(document.last_modified.timetuple())
-    }
+    docs[document.id] = massage_doc_for_json(document, user, url)
 
   return docs
 
+def get_document(request):
+  if request.method == 'POST':
+    return Http404()
+  elif request.method == 'GET':
+    doc_id = request.GET['id']
+    doc = Document.objects.get(id=doc_id)
+    response = massage_doc_for_json(doc, request.user)
+    return HttpResponse(json.dumps(response), mimetype="application/json")
+
+def massage_doc_for_json(document, user, url=''):
+  read_perms = document.list_permissions(perm='read')
+  write_perms = document.list_permissions(perm='write')
+  massaged_doc = {
+    'id': document.id,
+    'contentType': html.conditional_escape(document.content_type.name),
+    'icon': document.icon,
+    'name': html.conditional_escape(document.name),
+    'url': html.conditional_escape(url),
+    'description': html.conditional_escape(document.description),
+    'tags': [{'id': tag.id, 'name': html.conditional_escape(tag.tag)} \
+             for tag in document.tags.all()],
+    'owner': document.owner.username,
+    'isMine': document.owner == user,
+    'lastModified': document.last_modified.strftime("%x %X"),
+    'lastModifiedInMillis': time.mktime(document.last_modified.timetuple())
+  }
 
-def massage_doc_for_json(doc, user):
-  read_perms = doc.list_permissions(perm='read')
-  write_perms = doc.list_permissions(perm='write')
-  return {
-      'id': doc.id,
-      'contentType': doc.content_type.name,
-      'icon': doc.icon,
-      'name': html.conditional_escape(doc.name),
-      'url': html.conditional_escape(doc.content_object.get_absolute_url()),
-      'description': html.conditional_escape(doc.description),
-      'tags': [{'id': tag.id, 'name': html.conditional_escape(tag.tag)} \
-               for tag in doc.tags.all()],
-      'perms': {
-        'read': {
-          'users': [{'id': perm_user.id, 'username': perm_user.username} for perm_user in read_perms.users.all()],
-          'groups': [{'id': perm_group.id, 'name': perm_group.name} for perm_group in read_perms.groups.all()]
-        },
-        'write': {
-          'users': [{'id': perm_user.id, 'username': perm_user.username} for perm_user in write_perms.users.all()],
-          'groups': [{'id': perm_group.id, 'name': perm_group.name} for perm_group in write_perms.groups.all()]
-        }
-      },
-      'owner': doc.owner.username,
-      'isMine': doc.owner.username == user.username,
-      'lastModified': doc.last_modified.strftime("%x %X"),
-      'lastModifiedInMillis': time.mktime(doc.last_modified.timetuple())
-    }
+  permissions = massage_permissions(document)
+  massaged_doc.update(permissions)
+  return massaged_doc
 
 
 def add_tag(request):
diff --git a/desktop/core/src/desktop/templates/common_header.mako b/desktop/core/src/desktop/templates/common_header.mako
index 037ed29..d1c0eee 100644
--- a/desktop/core/src/desktop/templates/common_header.mako
+++ b/desktop/core/src/desktop/templates/common_header.mako
@@ -355,7 +355,7 @@ from django.utils.translation import ugettext as _
     <a class="brand nav-tooltip pull-left" title="${_('About Hue')}" rel="navigator-tooltip" href="/about"><img src="/static/art/hue-logo-mini-white.png" data-orig="/static/art/hue-logo-mini-white.png" data-hover="/static/art/hue-logo-mini-white-hover.png" /></a>
     % if user.is_authenticated() and section != 'login':
      <ul class="nav nav-pills pull-left">
-       <li><a title="${_('My documents')}" rel="navigator-tooltip" href="${ url('desktop.views.home') }" style="padding-bottom:2px!important"><i class="fa fa-home" style="font-size: 19px"></i></a></li>        
+       <li><a title="${_('My documents')}" rel="navigator-tooltip" href="${ url('desktop.views.home') }" style="padding-bottom:2px!important"><i class="fa fa-home" style="font-size: 19px"></i></a></li>
        <%
          query_apps = count_apps(apps, ['beeswax', 'impala', 'rdbms', 'pig', 'jobsub', 'spark']);
        %>
diff --git a/desktop/core/src/desktop/templates/common_share.mako b/desktop/core/src/desktop/templates/common_share.mako
index 4c899a4..bf3891b 100644
--- a/desktop/core/src/desktop/templates/common_share.mako
+++ b/desktop/core/src/desktop/templates/common_share.mako
@@ -51,7 +51,7 @@ from django.utils.translation import ugettext as _
       <div class="clearfix"></div>
       <div style="margin-top: 20px">
         <div class="input-append">
-          <input id="documentShareTypeahead" type="text" style="width: 460px" placeholder="${_('Type a username, a group, or "Everyone"')}">
+          <input id="documentShareTypeahead" type="text" style="width: 460px" placeholder="${_('Type a username or a group name')}">
           <div class="btn-group">
             <a id="documentShareAddBtn" class="btn"><i class="fa fa-plus-circle"></i> <span data-bind="text: selectedPermLabel"></span></a>
             <a class="btn dropdown-toggle" data-toggle="dropdown">
diff --git a/desktop/core/src/desktop/templates/home.mako b/desktop/core/src/desktop/templates/home.mako
index 79008ec..658d51c 100644
--- a/desktop/core/src/desktop/templates/home.mako
+++ b/desktop/core/src/desktop/templates/home.mako
@@ -67,10 +67,6 @@ ${ commonheader(_('Welcome Home'), "home", user) | n,unicode }
     margin-bottom: 6px;
   }
 
-  .trash-share, .share-link {
-    cursor: pointer;
-  }
-
   .white {
     padding: 9px 18px;
     margin-top: 1px;
@@ -81,17 +77,6 @@ ${ commonheader(_('Welcome Home'), "home", user) | n,unicode }
     text-overflow: ellipsis;
   }
 
-  .baseShared {
-    color: #999;
-  }
-
-  .isShared {
-    color: #338bb8!important;
-  }
-
-  #documentShareModal .modal-body {
-    overflow-y: initial;
-  }
 
 </style>
 
@@ -347,7 +332,7 @@ ${ commonshare() | n,unicode }
     viewModel = new HomeViewModel(JSON_TAGS, JSON_DOCS);
     ko.applyBindings(viewModel, $('#documentList')[0]);
 
-    shareViewModel = setupSharing(viewModel.updateDoc, "#documentShareModal");
+    shareViewModel = setupSharing("#documentShareModal", viewModel.updateDoc);
 
     var selectedUserOrGroup, map, dropdown = null;
 
diff --git a/desktop/core/src/desktop/urls.py b/desktop/core/src/desktop/urls.py
index 32d9bd4..65ff9d2 100644
--- a/desktop/core/src/desktop/urls.py
+++ b/desktop/core/src/desktop/urls.py
@@ -85,6 +85,7 @@ dynamic_patterns += patterns('desktop.api',
   (r'^desktop/api/tag/remove_tag$', 'remove_tag'),
   (r'^desktop/api/doc/tag$', 'tag'),
   (r'^desktop/api/doc/update_tags$', 'update_tags'),
+  (r'^desktop/api/doc/get$', 'get_document'),
 
   # Permissions
   (r'^desktop/api/doc/update_permissions', 'update_permissions'),
diff --git a/desktop/core/static/css/hue3.css b/desktop/core/static/css/hue3.css
index 24bdbe5..a5c5ca9 100644
--- a/desktop/core/static/css/hue3.css
+++ b/desktop/core/static/css/hue3.css
@@ -1684,6 +1684,29 @@ border-bottom-left-radius: 0px;
 
 /*********************************************************
  *
+ * Sharing styles
+ *
+ ********************************************************/
+
+.baseShared {
+  color: #999;
+}
+
+.isShared {
+  color: #338bb8!important;
+}
+
+#documentShareModal .modal-body {
+  overflow-y: initial;
+}
+
+.trash-share, .share-link {
+  cursor: pointer;
+}
+
+
+/*********************************************************
+ *
  * Misc styles that can be reused as needed
  * - from admin_collections.mako template
  *
diff --git a/desktop/core/static/js/share.vm.js b/desktop/core/static/js/share.vm.js
index e5accf0..053c69f 100644
--- a/desktop/core/static/js/share.vm.js
+++ b/desktop/core/static/js/share.vm.js
@@ -1,3 +1,5 @@
+var shareViewModel;
+
 function ShareViewModel(updateDocF) {
   var self = this;
 
@@ -24,6 +26,25 @@ function ShareViewModel(updateDocF) {
   }))
 
   self.updateDoc = updateDocF
+
+  self.setDocId = function(docId) {
+    if (docId == -1) { return false; }
+    $.get('/desktop/api/doc/get', { id : docId },
+      function (data) {
+        shareViewModel.selectedDoc(data)
+    });
+  }
+}
+
+
+function openShareModal() {
+  $("#documentShareModal").modal("show");
+}
+
+function isShared() {
+  if (!shareViewModel) { return false; }
+  read = shareViewModel.selectedDoc().perms.read;
+  return read.users.length + read.groups.length > 0
 }
 
 function prettifyUsername(userId) {
@@ -39,7 +60,10 @@ function prettifyUsername(userId) {
   return "";
 }
 
-function setupSharing(updateFunc, id) {
+function setupSharing(id, updateFunc) {
+  if(!updateFunc) {
+    updateFunc = function () {}
+  }
   shareViewModel = new ShareViewModel(updateFunc);
   ko.applyBindings(shareViewModel, $(id)[0]);
 
@@ -104,45 +128,30 @@ function setupSharing(updateFunc, id) {
   return shareViewModel;
 }
 
-
-function removeUserReadShare(user) {
-  $(shareViewModel.selectedDoc().perms.read.users).each(function (cnt, item) {
+function updateSharePerm(perms, user) {
+  $(perms).each(function (cnt, item) {
     if (item.id == user.id) {
-      shareViewModel.selectedDoc().perms.read.users.splice(cnt, 1);
+      perms.splice(cnt, 1);
     }
   });
   shareViewModel.selectedDoc.valueHasMutated();
   shareDocFinal();
 }
 
+function removeUserReadShare(user) {
+  updateSharePerm(shareViewModel.selectedDoc().perms.read.users, user);
+}
+
 function removeUserWriteShare(user) {
-  $(shareViewModel.selectedDoc().perms.write.users).each(function (cnt, item) {
-    if (item.id == user.id) {
-      shareViewModel.selectedDoc().perms.write.users.splice(cnt, 1);
-    }
-  });
-  shareViewModel.selectedDoc.valueHasMutated();
-  shareDocFinal();
+  updateSharePerm(shareViewModel.selectedDoc().perms.write.users, user);
 }
 
 function removeGroupReadShare(group) {
-  $(shareViewModel.selectedDoc().perms.read.groups).each(function (cnt, item) {
-    if (item.id == group.id) {
-      shareViewModel.selectedDoc().perms.read.groups.splice(cnt, 1);
-    }
-  });
-  shareViewModel.selectedDoc.valueHasMutated();
-  shareDocFinal();
+  updateSharePerm(shareViewModel.selectedDoc().perms.read.groups, group);
 }
 
 function removeGroupWriteShare(group) {
-  $(shareViewModel.selectedDoc().perms.write.groups).each(function (cnt, item) {
-    if (item.id == group.id) {
-      shareViewModel.selectedDoc().perms.write.groups.splice(cnt, 1);
-    }
-  });
-  shareViewModel.selectedDoc.valueHasMutated();
-  shareDocFinal();
+  updateSharePerm(shareViewModel.selectedDoc().perms.write.groups, group);
 }
 
 function changeDocumentSharePerm(perm) {
-- 
1.7.9.5

