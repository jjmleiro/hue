From ece7f51fdf464a8a043e94db50e15a1e90020085 Mon Sep 17 00:00:00 2001
From: Romain Rigaux <romain@cloudera.com>
Date: Tue, 20 Jan 2015 17:00:26 -0800
Subject: [PATCH 0477/1173] [oozie] Simpler naming for the cron tab

---
 .../oozie/templates/editor/coordinator_editor.mako |   85 +++++++++++---------
 .../oozie/templates/editor/submit_job_popup.mako   |    2 +-
 apps/oozie/src/oozie/views/dashboard.py            |    1 +
 apps/oozie/src/oozie/views/editor.py               |    3 -
 4 files changed, 48 insertions(+), 43 deletions(-)

diff --git a/apps/oozie/src/oozie/templates/editor/coordinator_editor.mako b/apps/oozie/src/oozie/templates/editor/coordinator_editor.mako
index eaaedd8..02366a3 100644
--- a/apps/oozie/src/oozie/templates/editor/coordinator_editor.mako
+++ b/apps/oozie/src/oozie/templates/editor/coordinator_editor.mako
@@ -43,27 +43,27 @@ ${ commonheader(_("Coordinator Editor"), "Oozie", user) | n,unicode }
     <a title="${ _('Edit') }" rel="tooltip" data-placement="bottom" data-bind="click: toggleEditing, css: {'btn': true, 'btn-inverse': isEditing}, visible: canEdit">
       <i class="fa fa-pencil"></i>
     </a>
-    
+
     &nbsp;&nbsp;&nbsp;
 
     <button type="button" title="${ _('Settings') }" rel="tooltip" data-placement="bottom" data-toggle="modal" data-target="#settingsModal" data-bind="css: {'btn': true}, visible: canEdit">
       <i class="fa fa-cog"></i>
     </button>
-    
+
     &nbsp;&nbsp;&nbsp;
 
-    <button type="button" title="${ _('Save') }" rel="tooltip" data-placement="bottom" data-loading-text="${ _("Saving...") }" 
+    <button type="button" title="${ _('Save') }" rel="tooltip" data-placement="bottom" data-loading-text="${ _("Saving...") }"
         data-bind="click: $root.save, css: {'btn': true}, visible: coordinator.properties.workflow() && canEdit">
       <i class="fa fa-save"></i>
     </button>
-    
+
     <a class="share-link btn" rel="tooltip" data-placement="bottom" data-bind="click: openShareModal,
         attr: {'data-original-title': '${ _("Share") } ' + name},
         css: {'isShared': isShared(), 'btn': true},
         visible: coordinator.id() != null && canEdit()">
       <i class="fa fa-users"></i>
-    </a>    
-    
+    </a>
+
     &nbsp;&nbsp;&nbsp;
 
     <a class="btn" href="${ url('oozie:new_coordinator') }" title="${ _('New') }" rel="tooltip" data-placement="bottom" data-bind="css: {'btn': true}">
@@ -93,17 +93,17 @@ ${ commonheader(_("Coordinator Editor"), "Oozie", user) | n,unicode }
         <div class="card-body">
           <a class="pointer" data-bind="visible: ! coordinator.properties.workflow(), click: showChooseWorkflow">${ _('Choose a workflow...') }</a>
           <!-- ko if: coordinator.properties.workflow -->
-            <!-- ko if: isEditing -->            
+            <!-- ko if: isEditing -->
             <a class="pointer" data-bind="click: showChooseWorkflow, text: getWorkflowById(coordinator.properties.workflow()).name"></a>
-            
+
             <a data-bind="attr: { href: '${ url('oozie:edit_workflow') }?workflow=' + coordinator.properties.workflow() }" target="_blank" title="${ _('Open') }">
              <i class="fa fa-external-link-square"></i>
             </a>
             <!-- /ko -->
             <!-- ko ifnot: isEditing -->
-            <a data-bind="attr: { href: '${ url('oozie:edit_workflow') }?workflow=' + coordinator.properties.workflow() }, text: getWorkflowById(coordinator.properties.workflow()).name" target="_blank" title="${ _('Open') }">              
-            </a>            
-            <!-- /ko -->            
+            <a data-bind="attr: { href: '${ url('oozie:edit_workflow') }?workflow=' + coordinator.properties.workflow() }, text: getWorkflowById(coordinator.properties.workflow()).name" target="_blank" title="${ _('Open') }">
+            </a>
+            <!-- /ko -->
           <!-- /ko -->
         </div>
       </div>
@@ -117,19 +117,14 @@ ${ commonheader(_("Coordinator Editor"), "Oozie", user) | n,unicode }
           <div class="control-group" data-bind="visible: ! coordinator.properties.cron_advanced()">
             <div class="controls" id="jqCron-container">
               <div id="jqCron-instance" style="margin-top: 5px; display: inline-block"></div>
-              <label class="checkbox" style="display: inline-block; margin-top: 5px">
-                <input type="checkbox" name="coordinator.properties.cron_advanced" data-bind="checked: coordinator.properties.cron_advanced" /> ${ _('Advanced syntax') }
-              </label>
             </div>
           </div>
           <div class="control-group" data-bind="visible: coordinator.properties.cron_advanced">
             <label class="control-label">${ _('Crontab') }</label>
             <div class="controls">
               <input id="coord-frequency" type="text" data-bind="value: coordinator.properties.cron_frequency" name="cron_frequency"/>
-              <span class="help-inline"><a data-bind="visible: coordinator.properties.cron_advanced" href="http://quartz-scheduler.org/api/2.0.0/org/quartz/CronExpression.html" target="_blank"><i class="fa fa-question-circle" title="${ _('Check syntax ?') }"></i></a>
-                <label class="checkbox" style="display: inline-block; margin-top: 5px; margin-left: 10px">
-                <input type="checkbox" name="coordinator.properties.cron_advanced" data-bind="checked: coordinator.properties.cron_advanced" /> ${ _('Advanced Cron syntax') }
-              </label>
+              <span class="help-inline"><a data-bind="visible: coordinator.properties.cron_advanced" href="http://quartz-scheduler.org/api/2.0.0/org/quartz/CronExpression.html" target="_blank">
+                <i class="fa fa-question-circle" title="${ _('Check syntax ?') }"></i></a>
               </span>
             </div>
           </div>
@@ -137,16 +132,25 @@ ${ commonheader(_("Coordinator Editor"), "Oozie", user) | n,unicode }
             <label class="control-label"></label>
             <div class="controls">
             <a href="#" data-bind="click: function() { $root.coordinator.showAdvancedFrequencyUI(! $root.coordinator.showAdvancedFrequencyUI()) }">
-              <i class="fa fa-sliders"></i> <span data-bind="visible: ! coordinator.showAdvancedFrequencyUI()">${ _('Show advanced options') }</span><span data-bind="visible: coordinator.showAdvancedFrequencyUI">${ _('Hide advanced options') }</span>
-            </a>      
+              <i class="fa fa-sliders"></i> <span data-bind="visible: ! coordinator.showAdvancedFrequencyUI()">${ _('Options') }</span>
+              <span data-bind="visible: coordinator.showAdvancedFrequencyUI">${ _('Hide') }</span>
+            </a>
             </div>
           </div>
         </form>
-          
-        
+
 
           <div data-bind="visible: coordinator.showAdvancedFrequencyUI">
             <form class="form-horizontal">
+
+              <div class="control-group">
+                <div class="controls">
+                  <label class="checkbox" style="display: inline-block; margin-top: 5px">
+                    <input type="checkbox" name="coordinator.properties.cron_advanced" data-bind="checked: coordinator.properties.cron_advanced" /> ${ _('Advanced syntax') }
+                  </label>
+                </div>
+              </div>
+
               <div class="control-group">
                 <label class="control-label">${ _('Starts on') }</label>
                 <div class="controls">
@@ -178,12 +182,12 @@ ${ commonheader(_("Coordinator Editor"), "Oozie", user) | n,unicode }
                   <span class="help-inline"></span>
                 </div>
               </div>
-              
+
             </form>
-            
+
           </div>
-          
-          
+
+
         </div>
       </div>
 
@@ -194,7 +198,7 @@ ${ commonheader(_("Coordinator Editor"), "Oozie", user) | n,unicode }
         <div class="card-body">
           <ul data-bind="foreach: coordinator.variables" class="unstyled">
             <li style="margin-bottom: 10px">
-              <select data-bind="options: $parent.coordinator.workflowParameters, optionsText: 'name', optionsValue: 'name', select2: { placeholder: '${ _("Select a parameter") }', update: workflow_variable, type: 'parameter'}, visible: $root.isEditing" style="width: 120px"></select>
+              <select data-bind="options: $parent.coordinator.workflowParameters, optionsText: 'name', optionsValue: 'name', select2: { placeholder: '${ _("Select a parameter") }', update: workflow_variable, type: 'parameter'}, visible: $root.isEditing" style="width: 250px"></select>
 
               <span data-bind="text: workflow_variable, visible: ! $root.isEditing()"/></span>
 
@@ -231,11 +235,14 @@ ${ commonheader(_("Coordinator Editor"), "Oozie", user) | n,unicode }
                   <!-- /ko -->
                 </ul>
               </div>
-              <input type="text" data-bind="value: dataset_variable, filechooser: dataset_variable" style="margin-bottom:0; width: 270px" class="filechooser-input" />
-
-              <!-- ko if: dataset_type() == 'input_path' || dataset_type() == 'output_path' -->              
               
-            
+              &nbsp;&nbsp;
+              
+              <input type="text" data-bind="value: dataset_variable, filechooser: dataset_variable" style="margin-bottom:0; width: 300px" class="filechooser-input" />
+
+              <!-- ko if: dataset_type() == 'input_path' || dataset_type() == 'output_path' -->
+
+
             ## <div class="btn-group" data-toggle="buttons-radio">
             ##   <a class="btn pointer" data-bind="css: {'active': coordinator.properties.frequency_unit() == 'hours'}, click: function(){ coordinator.properties.frequency_unit('hours') }">${ _('Hourly') }</a>
             ##   <a class="btn pointer" data-bind="css: {'active': coordinator.properties.frequency_unit() == 'days'}, click: function(){ coordinator.properties.frequency_unit('days') }">${ _('Daily') }</a>
@@ -319,7 +326,7 @@ ${ commonheader(_("Coordinator Editor"), "Oozie", user) | n,unicode }
                     </div>
                   </div>
                 </form>
-                
+
               </div>
               <!-- /ko -->
             </li>
@@ -330,15 +337,15 @@ ${ commonheader(_("Coordinator Editor"), "Oozie", user) | n,unicode }
           </a>
 
         </div>
-        
+
       </div>
 
       <div class="card card-home" data-bind="visible: coordinator.id() == null && coordinator.properties.workflow()">
         <div class="card-body">
-          <a href type="button" title="${ _('Save') }" rel="tooltip" data-placement="bottom" data-loading-text="${ _("Saving...") }" 
+          <a href type="button" title="${ _('Save') }" rel="tooltip" data-placement="bottom" data-loading-text="${ _("Saving...") }"
             data-bind="click: $root.save, css: {'btn': true}">
             ${ _('Save') }
-          </a>        
+          </a>
         </div>
       </div>
 
@@ -362,7 +369,7 @@ ${ commonheader(_("Coordinator Editor"), "Oozie", user) | n,unicode }
           <a data-bind="attr: { href: '${ url('oozie:edit_workflow') }?workflow=' + uuid() }" target="_blank" title="${ _('Open') }">
             <i class="fa fa-external-link-square"></i>
           </a>
-        </li>        
+        </li>
       </ul>
       <div class="alert alert-info inline" data-bind="visible: $root.filteredModalWorkflows().length == 0" style="margin-left: 250px;margin-right: 50px; height: 42px;line-height: 42px">
         ${_('There are no workflows matching your search term.')}
@@ -396,7 +403,7 @@ ${ commonheader(_("Coordinator Editor"), "Oozie", user) | n,unicode }
 
       <h4>${ _('Concurrency') }</h4>
       <input data-bind="value: coordinator.properties.concurrency"/>
-      
+
       <h4>${ _('Execution') }</h4>
       <input data-bind="value: coordinator.properties.execution"/>
 
@@ -463,7 +470,7 @@ ${ dashboard.import_bindings() }
   ${ utils.slaGlobal() }
 
   ${ utils.cron_js() }
-  
+
   var coordCron =
     $('#coord-frequency')
       .jqCron({
@@ -502,7 +509,7 @@ ${ dashboard.import_bindings() }
     viewModel.coordinator.properties.workflow(wf.uuid());
     $("#chooseWorkflowDemiModal").modal("hide");
   }
-  
+
   $(document).on("showSubmitPopup", function(event, data){
     $('#submit-coord-modal').html(data);
     $('#submit-coord-modal').modal('show');
diff --git a/apps/oozie/src/oozie/templates/editor/submit_job_popup.mako b/apps/oozie/src/oozie/templates/editor/submit_job_popup.mako
index aeab29c..987a074 100644
--- a/apps/oozie/src/oozie/templates/editor/submit_job_popup.mako
+++ b/apps/oozie/src/oozie/templates/editor/submit_job_popup.mako
@@ -25,7 +25,7 @@
   ${ csrf_token(request) | n,unicode }
   <div class="modal-header">
     <a href="#" class="close" data-dismiss="modal">&times;</a>
-    <h3>${ _('Submit %(job)s?') % {'job': name} }</h3>
+    <h3>${ _('Submit this job?') }</h3>
   </div>
   <div class="modal-body">
     <fieldset>
diff --git a/apps/oozie/src/oozie/views/dashboard.py b/apps/oozie/src/oozie/views/dashboard.py
index b725d4f..f25dd27 100644
--- a/apps/oozie/src/oozie/views/dashboard.py
+++ b/apps/oozie/src/oozie/views/dashboard.py
@@ -678,6 +678,7 @@ def submit_external_job(request, application_path):
 
   popup = render('editor/submit_job_popup.mako', request, {
                    'params_form': params_form,
+                   'name': _('Job'),
                    'action': reverse('oozie:submit_external_job', kwargs={'application_path': application_path})
                  }, force_template=True).content
   return HttpResponse(json.dumps(popup), mimetype="application/json")
diff --git a/apps/oozie/src/oozie/views/editor.py b/apps/oozie/src/oozie/views/editor.py
index 8b1d428..86d4c0e 100644
--- a/apps/oozie/src/oozie/views/editor.py
+++ b/apps/oozie/src/oozie/views/editor.py
@@ -355,7 +355,6 @@ def submit_workflow(request, workflow):
 
   popup = render('editor/submit_job_popup.mako', request, {
                    'params_form': params_form,
-                   'name': workflow.name,
                    'action': reverse('oozie:submit_workflow', kwargs={'workflow': workflow.id})
                  }, force_template=True).content
   return HttpResponse(json.dumps(popup), mimetype="application/json")
@@ -654,7 +653,6 @@ def submit_coordinator(request, coordinator):
 
   popup = render('editor/submit_job_popup.mako', request, {
                  'params_form': params_form,
-                 'name': coordinator.name,
                  'action': reverse('oozie:submit_coordinator',  kwargs={'coordinator': coordinator.id})
                 }, force_template=True).content
   return HttpResponse(json.dumps(popup), mimetype="application/json")
@@ -864,7 +862,6 @@ def submit_bundle(request, bundle):
 
   popup = render('editor/submit_job_popup.mako', request, {
                  'params_form': params_form,
-                 'name': bundle.name,
                  'action': reverse('oozie:submit_bundle',  kwargs={'bundle': bundle.id})
                 }, force_template=True).content
   return HttpResponse(json.dumps(popup), mimetype="application/json")
-- 
1.7.9.5

