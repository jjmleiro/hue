From cec16c9a33a2c4d1ff6f51b7f91fa19e92f21eae Mon Sep 17 00:00:00 2001
From: Enrico Berti <hello@enricoberti.com>
Date: Mon, 24 Nov 2014 23:58:07 +0100
Subject: [PATCH 0314/1173] [oozie] Better helper for clone and move

---
 .../oozie/templates/editor/workflow_editor.mako    |   19 +++++++++++++------
 apps/oozie/static/css/workflow-editor.css          |    6 +++---
 2 files changed, 16 insertions(+), 9 deletions(-)

diff --git a/apps/oozie/src/oozie/templates/editor/workflow_editor.mako b/apps/oozie/src/oozie/templates/editor/workflow_editor.mako
index bd825e1..097f2ac 100644
--- a/apps/oozie/src/oozie/templates/editor/workflow_editor.mako
+++ b/apps/oozie/src/oozie/templates/editor/workflow_editor.mako
@@ -315,7 +315,7 @@ ${ commonheader(_("Workflow Editor"), "Oozie", user) | n,unicode }
 </script>
 
 <script type="text/html" id="widget-template">
-  <div data-bind="attr: {'id': 'wdg_'+ id(),}, css: klass() + (oozieExpanded()?' expanded-widget':''), draggable: {data: $data, isEnabled: true, options: {'handle': '.move-widget', 'opacity': 0.7, 'refreshPositions': true, 'start': function(event, ui){ $root.setCurrentlyDraggedWidget($data, event.toElement); }, 'stop': function(event, ui){ $root.enableSideDrop($data); }, 'helper': function(event){lastWindowScrollPosition = $(window).scrollTop();  var _par = $('<div>');_par.addClass('card card-widget');var _title = $('<h2>');_title.addClass('card-heading simple');_title.text($(event.toElement).text());_title.appendTo(_par);_par.height(80);_par.width(180);return _par;}}}">
+  <div data-bind="attr: {'id': 'wdg_'+ id(),}, css: klass() + (oozieExpanded()?' expanded-widget':''), draggable: {data: $data, isEnabled: true, options: {'handle': '.move-widget', 'opacity': 0.7, 'refreshPositions': true, 'start': function(event, ui){ $root.setCurrentlyDraggedWidget($data, event.toElement); }, 'stop': function(event, ui){ $root.enableSideDrop($data); }, 'helper': function(event){lastWindowScrollPosition = $(window).scrollTop();  var _par = $('<div>');_par.addClass('card card-widget');var _title = $('<h2>');_title.addClass('card-heading simple');_title.text($(event.currentTarget).find('h2').text());_title.appendTo(_par);_par.css('minHeight', '10px');_par.width(120);return _par;}}}">
     <h2 class="card-heading simple">
       <span data-bind="visible: $root.isEditing() && oozieMovable() && ! oozieExpanded()">
         <a href="javascript:void(0)" class="move-widget"><i class="fa fa-arrows"></i></a>
@@ -1549,13 +1549,20 @@ ${ dashboard.import_bindings() }
 
     $("#exposeOverlay").on("click", function (e) {
       if (lastExpandedWidget) {
+        var _el = $("#wdg_" + lastExpandedWidget.id());
+        _el.css("position", "initial");
+        _el.find(".prop-editor").hide();
+        _el.css({
+          "top": "",
+          "left": "",
+          "width": "",
+          "margin-top": "",
+          "margin-left": "",
+          "height": ""
+        });
         lastExpandedWidget.oozieExpanded(false);
       }
-      $(".prop-editor").hide();
-      $(".card-widget").css("position", "initial");
-      $("#exposeOverlay").fadeOut(300, function () {
-        $(".card-widget").css("z-index", "1");
-      });
+      $("#exposeOverlay").fadeOut(300);
     });
 
     $(document).keyup(function(e) {
diff --git a/apps/oozie/static/css/workflow-editor.css b/apps/oozie/static/css/workflow-editor.css
index c13a66f..148b273 100644
--- a/apps/oozie/static/css/workflow-editor.css
+++ b/apps/oozie/static/css/workflow-editor.css
@@ -296,18 +296,18 @@ em {
 
 .drop-target {
   background-color: #F6F6F6;
-  min-height: 36px;
+  min-height: 20px;
   border: 2px dashed #DDD;
   text-align: center;
   padding: 4px;
 }
 
 .ui-sortable.drop-target {
-  min-height: 36px;
+  min-height: 20px;
 }
 
 .drop-target-highlight {
-  min-height: 36px;
+  min-height: 20px;
   background-color: #CCC;
 }
 
-- 
1.7.9.5

