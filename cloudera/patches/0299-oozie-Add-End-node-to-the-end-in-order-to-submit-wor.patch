From c7e8b31a6f311820b75cda15a8bd9d3c66ba29b7 Mon Sep 17 00:00:00 2001
From: Romain Rigaux <romain@cloudera.com>
Date: Wed, 19 Nov 2014 16:49:05 -0800
Subject: [PATCH 0299/1173] [oozie] Add End node to the end in order to submit
 workflow

---
 apps/oozie/src/oozie/models2.py                    |    2 ++
 .../oozie/templates/editor/workflow_editor.mako    |    4 ++--
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/apps/oozie/src/oozie/models2.py b/apps/oozie/src/oozie/models2.py
index df89310..83c4a7a 100644
--- a/apps/oozie/src/oozie/models2.py
+++ b/apps/oozie/src/oozie/models2.py
@@ -153,6 +153,8 @@ class Workflow():
 
     data = self.get_data()
     nodes = [Node(node) for node in data['workflow']['nodes']]
+    end = nodes.pop(1)
+    nodes.append(end) # End at the end 
     node_mapping = dict([(node.id, node) for node in nodes])
     
     sub_wfs_ids = [node.data['properties']['workflow'] for node in nodes if node.data['type'] == 'subworkflow']
diff --git a/apps/oozie/src/oozie/templates/editor/workflow_editor.mako b/apps/oozie/src/oozie/templates/editor/workflow_editor.mako
index ff0a88d..6c47925 100644
--- a/apps/oozie/src/oozie/templates/editor/workflow_editor.mako
+++ b/apps/oozie/src/oozie/templates/editor/workflow_editor.mako
@@ -375,7 +375,7 @@ ${ commonheader(_("Workflow Editor"), "Oozie", user) | n,unicode }
       <input type="text" data-bind="value: name" />
     </div>
     
-    <div>
+    <div data-bind="visible: $root.isEditing">
       To:
       <span data-bind="foreach: children">
         <select data-bind="options: $root.workflow.nodeIds,
@@ -416,7 +416,7 @@ ${ commonheader(_("Workflow Editor"), "Oozie", user) | n,unicode }
       <input type="text" data-bind="value: name" />
     </div>
 
-    <div>
+    <div data-bind="visible: $root.isEditing">
       <!-- ko if: children().length == 1 -->
       Start --> <input type="text" data-bind="value: children()[0]['to']" />
       <!-- /ko -->
-- 
1.7.9.5

