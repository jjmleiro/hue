From 1601ed04e51c7c2fda1fc8358b2e4a7c536135c9 Mon Sep 17 00:00:00 2001
From: Enrico Berti <hello@enricoberti.com>
Date: Thu, 8 Jan 2015 15:03:38 +0100
Subject: [PATCH 0414/1173] [oozie] Disable page scroll on Filechooser modal

---
 desktop/core/static/css/hue3.css             |    5 +++++
 desktop/core/static/js/jquery.filechooser.js |    2 +-
 desktop/core/static/js/ko.hue-bindings.js    |    4 ++++
 3 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/desktop/core/static/css/hue3.css b/desktop/core/static/css/hue3.css
index 7bdb157..1aebeef 100644
--- a/desktop/core/static/css/hue3.css
+++ b/desktop/core/static/css/hue3.css
@@ -1608,6 +1608,11 @@ body.modal-open {
   overflow: hidden;
 }
 
+html.modal-open {
+  overflow: hidden;
+}
+
+
 .demi-modal {
   position: fixed;
   top: 0;
diff --git a/desktop/core/static/js/jquery.filechooser.js b/desktop/core/static/js/jquery.filechooser.js
index 42e2240..14c8b3c 100644
--- a/desktop/core/static/js/jquery.filechooser.js
+++ b/desktop/core/static/js/jquery.filechooser.js
@@ -175,7 +175,7 @@
                     var _addFile = true;
                     if (_parent.options.filterExtensions != "" && file.type == "file"){
                         var _allowedExtensions = _parent.options.filterExtensions.split(",");
-                        var _fileExtension = file.name.split(".").pop();
+                        var _fileExtension = file.name.split(".").pop().toLowerCase();
                         _addFile = _allowedExtensions.indexOf(_fileExtension) > -1;
                     }
                     if (_addFile){
diff --git a/desktop/core/static/js/ko.hue-bindings.js b/desktop/core/static/js/ko.hue-bindings.js
index cc7087a..51a8b04 100644
--- a/desktop/core/static/js/ko.hue-bindings.js
+++ b/desktop/core/static/js/ko.hue-bindings.js
@@ -1038,6 +1038,7 @@ ko.bindingHandlers.filechooser = {
 function getFileBrowseButton(inputElement, selectFolder, valueAccessor, stripHdfsPrefix, allBindingsAccessor) {
   var _btn = $("<button>").addClass("btn").addClass("fileChooserBtn").text("..").click(function (e) {
     e.preventDefault();
+    $("html").addClass("modal-open");
     // check if it's a relative path
     callFileChooser();
 
@@ -1075,6 +1076,9 @@ function getFileBrowseButton(inputElement, selectFolder, valueAccessor, stripHdf
         filterExtensions: allBindingsAccessor().filechooserFilter ? allBindingsAccessor().filechooserFilter : ""
       });
       $("#chooseFile").modal("show");
+      $("#chooseFile").on("hidden", function(){
+        $("html").removeClass("modal-open");
+      });
     }
 
     function handleChoice(filePath, stripHdfsPrefix) {
-- 
1.7.9.5

