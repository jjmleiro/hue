From cf9c27d2d4dbf41cdcce476f38b1316ab70fea91 Mon Sep 17 00:00:00 2001
From: Enrico Berti <hello@enricoberti.com>
Date: Wed, 3 Dec 2014 17:38:46 +0100
Subject: [PATCH 0542/1173] [spark] Scroll to column

---
 apps/spark/src/spark/templates/editor.mako |   25 ++++++++++++++++++++++---
 apps/spark/static/css/spark.css            |    4 ++++
 2 files changed, 26 insertions(+), 3 deletions(-)

diff --git a/apps/spark/src/spark/templates/editor.mako b/apps/spark/src/spark/templates/editor.mako
index e8aecc9..d21c24a 100644
--- a/apps/spark/src/spark/templates/editor.mako
+++ b/apps/spark/src/spark/templates/editor.mako
@@ -215,10 +215,13 @@ ${ commonheader(_('Query'), app_name, user, "68px") | n,unicode }
         <span data-bind="text: result.logs"></span>
       </div>
 
-      <div class="row-fluid">
+      <div class="row-fluid" data-bind="visible: result.meta().length > 0">
         <div class="span2">
+          <ul class="nav nav-list" style="border: none; background-color: #FFF">
+            <li class="nav-header">${_('columns')}</li>
+          </ul>
           <ul class="unstyled" data-bind="foreach: result.meta">
-            <li><a class="pointer" data-bind="text: $data.name, click: function(){ toggleColumn($element, $index()); }"></a></li>
+            <li><input type="checkbox" checked="checked" data-bind="event: { change: function(){toggleColumn($element, $index());}}" /> <a class="pointer" data-bind="text: $data.name, click: function(){ scrollToColumn($element, $index()); }"></a></li>
           </ul>
         </div>
         <div class="span10">
@@ -231,7 +234,7 @@ ${ commonheader(_('Query'), app_name, user, "68px") | n,unicode }
               </thead>
               <tbody data-bind="foreach: {data: result.data, afterAdd: waitForDatatable}">
                 <tr data-bind="foreach: $data">
-                  <td data-bind="text: $data"></td>
+                  <td data-bind="text: $data" class="nowrap"></td>
                 </tr>
               </tbody>
             </table>
@@ -882,6 +885,22 @@ function sinAndCos() {
     _dt.fnSetColumnVis( index, !_dt.fnSettings().aoColumns[index].bVisible);
   }
 
+  function scrollToColumn(linkElement) {
+    var _t = $(linkElement).parents(".snippet").find("table:eq(1)");
+    var _text = $.trim($(linkElement).text().split("(")[0]);
+    var _col = _t.find("th").filter(function () {
+      return $.trim($(this).text()) == _text;
+    });
+    _t.find(".columnSelected").removeClass("columnSelected");
+    var _colSel = _t.find("tr td:nth-child(" + (_col.index() + 1) + ")");
+    if (_colSel.length > 0) {
+      _colSel.addClass("columnSelected");
+      _t.parent().animate({
+        scrollLeft: _colSel.position().left + _t.parent().scrollLeft() - _t.parent().offset().left - 30
+      }, 300);
+    }
+  }
+
 </script>
 
 ${ commonfooter(messages) | n,unicode }
diff --git a/apps/spark/static/css/spark.css b/apps/spark/static/css/spark.css
index 9245778..3927b47 100644
--- a/apps/spark/static/css/spark.css
+++ b/apps/spark/static/css/spark.css
@@ -55,6 +55,10 @@
   line-height: 20px !important;
 }
 
+.nav-list > li > a, .nav-list .nav-header {
+  padding-left: 0;
+}
+
 .dropdown-menu li {
   font-size: 14px;
 }
-- 
1.7.9.5

