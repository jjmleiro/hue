From e5ce3c14e139c2b660b324284818b5e29bd989a5 Mon Sep 17 00:00:00 2001
From: Erick Tryzelaar <erickt@cloudera.com>
Date: Tue, 3 Feb 2015 10:43:00 -0800
Subject: [PATCH 0749/1173] [livy] Change the name of the submitted yarn
 applications

---
 .../hue/livy/server/sessions/YarnSession.scala     |    1 +
 .../scala/com/cloudera/hue/livy/yarn/Client.scala  |    5 +++--
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/apps/spark/java/livy-server/src/main/scala/com/cloudera/hue/livy/server/sessions/YarnSession.scala b/apps/spark/java/livy-server/src/main/scala/com/cloudera/hue/livy/server/sessions/YarnSession.scala
index fd5127d..4f1fc50 100644
--- a/apps/spark/java/livy-server/src/main/scala/com/cloudera/hue/livy/server/sessions/YarnSession.scala
+++ b/apps/spark/java/livy-server/src/main/scala/com/cloudera/hue/livy/server/sessions/YarnSession.scala
@@ -15,6 +15,7 @@ object YarnSession {
     val packagePath = new Path(LIVY_YARN_PACKAGE)
 
     val job = client.submitApplication(
+      "livy " + lang,
       packagePath,
       List(
         "__package/bin/run-am.sh %s 1>%s/stdout 2>%s/stderr" format (
diff --git a/apps/spark/java/livy-yarn/src/main/scala/com/cloudera/hue/livy/yarn/Client.scala b/apps/spark/java/livy-yarn/src/main/scala/com/cloudera/hue/livy/yarn/Client.scala
index 04cf15f..17fbb56 100644
--- a/apps/spark/java/livy-yarn/src/main/scala/com/cloudera/hue/livy/yarn/Client.scala
+++ b/apps/spark/java/livy-yarn/src/main/scala/com/cloudera/hue/livy/yarn/Client.scala
@@ -23,6 +23,7 @@ object Client extends Logging {
 
     try {
       val job = client.submitApplication(
+        "livy " + lang,
         packagePath,
         List(
           "__package/bin/run-am.sh %s 1>%s/stdout 2>%s/stderr" format (
@@ -61,7 +62,7 @@ class Client(yarnConf: YarnConfiguration) {
   yarnClient.init(yarnConf)
   yarnClient.start()
 
-  def submitApplication(packagePath: Path, cmds: List[String]): Job = {
+  def submitApplication(name: String, packagePath: Path, cmds: List[String]): Job = {
     val app = yarnClient.createApplication()
     val newAppResponse = app.getNewApplicationResponse
 
@@ -70,7 +71,7 @@ class Client(yarnConf: YarnConfiguration) {
     info("preparing to submit %s" format appId)
 
     val appContext = app.getApplicationSubmissionContext
-    appContext.setApplicationName(appId.toString)
+    appContext.setApplicationName(name)
 
     val containerCtx = Records.newRecord(classOf[ContainerLaunchContext])
     val resource = Records.newRecord(classOf[Resource])
-- 
1.7.9.5

