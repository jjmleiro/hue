From e9dbc2560808931230b9cf71735fbb55e76c4ba8 Mon Sep 17 00:00:00 2001
From: Romain Rigaux <romain@cloudera.com>
Date: Thu, 5 Mar 2015 13:25:59 -0800
Subject: [PATCH 0993/1173] [oozie] Updating Oozie tests with credentials

---
 desktop/core/src/desktop/tests.py                 |    2 +-
 desktop/libs/liboozie/src/liboozie/credentials.py |    3 ++-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/desktop/core/src/desktop/tests.py b/desktop/core/src/desktop/tests.py
index 4443a4a..d68ece6 100644
--- a/desktop/core/src/desktop/tests.py
+++ b/desktop/core/src/desktop/tests.py
@@ -127,7 +127,7 @@ def test_home():
   tags = json.loads(response.context['json_tags'])
   assert_equal([], tags['mine'][0]['docs'], tags)
   assert_equal([], tags['trash']['docs'], tags)
-  assert_equal([doc.id], tags['history']['docs'], tags)
+  assert_equal([], tags['history']['docs'], tags) # We currently don't fetch [doc.id]
 
 
 def test_skip_wizard():
diff --git a/desktop/libs/liboozie/src/liboozie/credentials.py b/desktop/libs/liboozie/src/liboozie/credentials.py
index 63029cf..c823fc6 100644
--- a/desktop/libs/liboozie/src/liboozie/credentials.py
+++ b/desktop/libs/liboozie/src/liboozie/credentials.py
@@ -53,7 +53,8 @@ class Credentials(object):
 
     if hive_properties is None:
       hive_properties = hive_site.get_metastore()
-      hive_properties['hive2.server.principal'] = hive_site.get_hiveserver2_kerberos_principal(conf.HIVE_SERVER_HOST.get())
+      if hive_properties:
+        hive_properties['hive2.server.principal'] = hive_site.get_hiveserver2_kerberos_principal(conf.HIVE_SERVER_HOST.get())
 
     if not hive_properties:
       hive_properties = {}
-- 
1.7.9.5

