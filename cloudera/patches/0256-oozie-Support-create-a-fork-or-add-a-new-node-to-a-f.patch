From b9d343d9497fd3fb0d4b8df69121f12b88ea6686 Mon Sep 17 00:00:00 2001
From: Romain Rigaux <romain@cloudera.com>
Date: Wed, 5 Nov 2014 19:54:40 +0000
Subject: [PATCH 0256/1173] [oozie] Support create a fork or add a new node to
 a fork

---
 apps/oozie/static/js/workflow-editor.ko.js |   11 ++++++++---
 1 file changed, 8 insertions(+), 3 deletions(-)

diff --git a/apps/oozie/static/js/workflow-editor.ko.js b/apps/oozie/static/js/workflow-editor.ko.js
index fed1772..41553ad 100644
--- a/apps/oozie/static/js/workflow-editor.ko.js
+++ b/apps/oozie/static/js/workflow-editor.ko.js
@@ -215,12 +215,17 @@ var Workflow = function (vm, workflow) {
 
         // Added to the side ?
         if (vm.currentlyCreatingFork) {
-          var parent = self.getNodeById('3f107997-04cc-8733-60a9-a4bb62cebffc');
+            var parentWidget = vm.getWidgetPredecessor(node.id()); alert(parentWidget.id());
 
-          if (parent.type() != 'fork-widget') {          
+          if (self.getNodeById(parentWidget.id()) == null) { // New fork
+        	
+        	  
             var fork = new Node(vm.currentlyCreatedFork);
             var join = new Node(vm.currentlyCreatedJoin);
             
+            //var parent = self.getNodeById(parentWidget.id());
+            var parent = self.getNodeById(vm.getWidgetPredecessor(parentWidget.id()).id());
+            
             // Start node
             var afterStartId = ko.mapping.toJS(parent.get_link('to')).to;
             var afterStart = self.getNodeById(afterStartId);
@@ -256,7 +261,7 @@ var Workflow = function (vm, workflow) {
 	        // Link to end
 	        node.set_link('to', '33430f0f-ebfa-c3ec-f237-3e77efa03d0a');
 	        node.set_link('error', '17c9c895-5a16-7443-bb81-f34b30b21548');
-          } else if (parentWidget.widgetType() == 'pig-widget') {
+          } else {
             // Parent regular node        	
   	        node.set_link('to', parent.get_link('to')['to']);
   	        node.set_link('error', '17c9c895-5a16-7443-bb81-f34b30b21548');
-- 
1.7.9.5

